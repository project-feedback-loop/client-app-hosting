"use strict";(self.webpackChunkfeedback_loop_client=self.webpackChunkfeedback_loop_client||[]).push([[171],{5499:(be,ue,P)=>{P.d(ue,{T:()=>v});var d=P(5e3),q=P(2626),ne=P(9352),V=P(9808),w=P(4342);function H(I,ee){if(1&I){const j=d.EpF();d.TgZ(0,"div",3),d.NdJ("click",function(){return d.CHM(j),d.oxw().openmilestone()}),d.TgZ(1,"div",4),d._UZ(2,"nz-progress",5),d.TgZ(3,"div",6)(4,"div",7)(5,"span"),d._uU(6),d.qZA()(),d.TgZ(7,"div",8)(8,"span")(9,"span",9),d._uU(10),d.qZA(),d._uU(11),d.ALo(12,"date"),d.qZA()()(),d.TgZ(13,"div",10)(14,"div",11),d._uU(15),d.qZA(),d.TgZ(16,"span",12),d._uU(17,"more_vert"),d.qZA()()()()}if(2&I){const j=d.oxw();d.xp6(2),d.Q6J("nzPercent",null==j.milestone?null:j.milestone.percentage)("nzWidth",50),d.xp6(4),d.Oqu(null==j.milestone?null:j.milestone.title),d.xp6(4),d.Oqu(null==j.milestone?null:j.milestone.status),d.xp6(1),d.hij(" . ",d.lcZ(12,6,null==j.milestone?null:j.milestone.createdAt),""),d.xp6(4),d.Oqu(null==j.milestone?null:j.milestone.taskCount)}}function F(I,ee){if(1&I&&(d.TgZ(0,"div",13)(1,"div",14),d._UZ(2,"nz-progress",5),d.TgZ(3,"div")(4,"span",15),d._uU(5),d.qZA(),d.TgZ(6,"span",16),d._uU(7),d.ALo(8,"date"),d.qZA()()()()),2&I){const j=d.oxw();d.xp6(2),d.Q6J("nzPercent",null==j.milestone?null:j.milestone.percentage)("nzWidth",50),d.xp6(3),d.Oqu(null==j.milestone?null:j.milestone.title),d.xp6(2),d.Oqu(d.lcZ(8,4,null==j.milestone?null:j.milestone.createdAt))}}let v=(()=>{class I{constructor(j){this.route=j}ngOnInit(){this.milestone=this.flMilestone}openmilestone(){this.milestone&&this.route.navigate([`/milestone/view/${this.milestone.id}`])}}return I.\u0275fac=function(j){return new(j||I)(d.Y36(q.F0))},I.\u0275cmp=d.Xpm({type:I,selectors:[["app-milestone-card"]],inputs:{milestone:"milestone",flMilestone:"flMilestone",size:"size"},decls:3,vars:3,consts:[[3,"size"],["class","card-body",3,"click",4,"ngIf"],["class","rlth-minsize",4,"ngIf"],[1,"card-body",3,"click"],[1,"header"],["nzType","circle",1,"rlth-time-icon","progress-icon",3,"nzPercent","nzWidth"],[1,"title-container"],[1,"title-div"],[1,"status-time-div"],[1,"status"],[1,"task-div"],[1,"task"],[1,"material-symbols-rounded"],[1,"rlth-minsize"],[1,"milestone-content"],[1,"rlth-title"],[1,"rlth-date"]],template:function(j,W){1&j&&(d._UZ(0,"WhiteSpace",0),d.YNc(1,H,18,8,"div",1),d.YNc(2,F,9,6,"div",2)),2&j&&(d.Q6J("size","md"),d.xp6(1),d.Q6J("ngIf",!W.size),d.xp6(1),d.Q6J("ngIf",W.size))},directives:[ne.yG,V.O5,w.M],pipes:[V.uU],styles:[".card-body[_ngcontent-%COMP%]{width:100%;font-size:1rem}.header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:flex-start}.title-container[_ngcontent-%COMP%]{flex:1;overflow:hidden}.title-div[_ngcontent-%COMP%], .status[_ngcontent-%COMP%]{font-weight:500;text-transform:capitalize;overflow:hidden;text-overflow:ellipsis}.status-time-div[_ngcontent-%COMP%]{font-size:.8rem}.task-div[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.task[_ngcontent-%COMP%]{background-color:var(--dim-bg-color);padding:2px 10px;border-radius:25px}.progress-icon[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:50%;margin-right:8px;text-align:center}"]}),I})()},5864:(be,ue,P)=>{P.d(ue,{U:()=>J});var d=P(5e3),q=P(7465),ne=P(2626),V=P(6819),w=P(9808),H=P(9051),F=P(4112),v=P(9830);let I=(()=>{class re{transform(Z){return Z==v.MM.Feedback?"assets/feedback.png":Z==v.MM.FeatureRequest?"assets/feature.png":"assets/warning-sign.png"}}return re.\u0275fac=function(Z){return new(Z||re)},re.\u0275pipe=d.Yjl({name:"categoryImgPath",type:re,pure:!0}),re})();const ee=["content"];function j(re,ae){if(1&re&&(d._UZ(0,"img",14),d.ALo(1,"categoryImgPath")),2&re){const Z=d.oxw(2);d.Q6J("src",d.lcZ(1,1,Z.request.category),d.LSH)}}function W(re,ae){if(1&re&&d._UZ(0,"app-status-tag",15),2&re){const Z=d.oxw(2);d.Q6J("status",Z.request.status)}}function oe(re,ae){if(1&re){const Z=d.EpF();d.TgZ(0,"div",2),d.NdJ("click",function(){return d.CHM(Z),d.oxw().openRequest()}),d.TgZ(1,"header",3)(2,"div",4)(3,"span",5),d.YNc(4,j,2,3,"img",6),d.qZA(),d.TgZ(5,"div",7)(6,"span",8),d._uU(7),d.TgZ(8,"span",9),d._uU(9),d.ALo(10,"date"),d.qZA()(),d.TgZ(11,"span",10)(12,"span"),d._uU(13),d.qZA()()()(),d.TgZ(14,"div",11),d.YNc(15,W,1,1,"app-status-tag",12),d.qZA()(),d._UZ(16,"div",13),d.qZA()}if(2&re){const Z=d.oxw();d.xp6(4),d.Q6J("ngIf",Z.request.category),d.xp6(3),d.hij(" ",Z.request.category," . "),d.xp6(2),d.Oqu(d.lcZ(10,6,Z.request.createdAt)),d.xp6(4),d.Oqu(Z.req.userEmail),d.xp6(2),d.Q6J("ngIf",Z.request.status),d.xp6(1),d.Q6J("MarkdownContentParser",Z.request.content)}}function Y(re,ae){if(1&re&&(d._UZ(0,"img",14),d.ALo(1,"categoryImgPath")),2&re){const Z=d.oxw(2);d.Q6J("src",d.lcZ(1,1,Z.request.category),d.LSH)}}function le(re,ae){if(1&re&&(d.TgZ(0,"div",16)(1,"div",17)(2,"span",18),d.YNc(3,Y,2,3,"img",6),d.qZA(),d.TgZ(4,"div"),d._UZ(5,"span",19),d.TgZ(6,"span",20),d._uU(7),d.ALo(8,"date"),d.qZA()()()()),2&re){const Z=d.oxw();d.xp6(3),d.Q6J("ngIf",Z.request.category),d.xp6(2),d.Q6J("MarkdownContentParser",Z.request.content),d.xp6(2),d.Oqu(d.lcZ(8,3,Z.request.createdAt))}}let J=(()=>{class re{constructor(Z,fe,xe){this.global=Z,this.router=fe,this.userQuery=xe,this.req={},this.disabled=!0}ngOnInit(){this.request=this.req}ngAfterViewInit(){}openRequest(){this.request&&!this.disabled&&this.router.navigate([`/request/view/${this.request.id}`])}}return re.\u0275fac=function(Z){return new(Z||re)(d.Y36(q.U),d.Y36(ne.F0),d.Y36(V.o))},re.\u0275cmp=d.Xpm({type:re,selectors:[["app-req-list-item"]],viewQuery:function(Z,fe){if(1&Z&&d.Gf(ee,5),2&Z){let xe;d.iGM(xe=d.CRH())&&(fe.content=xe.first)}},inputs:{request:"request",req:"req",disabled:"disabled",size:"size"},decls:2,vars:2,consts:[["class","req-list-item-body",3,"click",4,"ngIf"],["class","rlth-minsize",4,"ngIf"],[1,"req-list-item-body",3,"click"],[1,"req-list-item-header"],[1,"rlth-time"],[1,"material-symbols-rounded","rlth-time-icon"],["alt","",3,"src",4,"ngIf"],[1,"rlth-time-div"],[1,"rlth-time-text"],[1,"rlth-time-value"],[1,"rlth-time-user"],[1,"rlth-status"],[3,"status",4,"ngIf"],[1,"req-list-item-container",3,"MarkdownContentParser"],["alt","",3,"src"],[3,"status"],[1,"rlth-minsize"],[1,"milestone-content"],[1,"material-symbols-rounded","rlth-time-iconlist"],[1,"rlth-title",3,"MarkdownContentParser"],[1,"rlth-date"]],template:function(Z,fe){1&Z&&(d.YNc(0,oe,17,8,"div",0),d.YNc(1,le,9,5,"div",1)),2&Z&&(d.Q6J("ngIf",!fe.size),d.xp6(1),d.Q6J("ngIf",fe.size))},directives:[w.O5,H.G,F.J],pipes:[I,w.uU],styles:[".req-list-item-body[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;display:flex;flex-direction:column;padding-bottom:6px}.req-list-item-header[_ngcontent-%COMP%]{flex:1;display:flex}.req-list-item-container[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;white-space:break-spaces;font-size:1rem;padding-top:12px}.req-list-item-footer[_ngcontent-%COMP%]{max-height:50px;min-height:50px;flex:1;background-color:#f5f5f5;display:flex}.rlth-time[_ngcontent-%COMP%]{display:flex;flex:3;align-items:flex-start;height:100%}.rlth-time-icon[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#f5f5f5;border-radius:50%;font-size:2rem;margin-right:6px;text-align:center;display:flex;justify-content:center;align-items:center}.rlth-time-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:28px;height:28px;margin:auto}.rlth-time-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;max-width:100%;font-size:1rem}.rlth-time-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1}.rlth-time-text[_ngcontent-%COMP%]{font-weight:500;font-size:1rem;text-transform:capitalize}.rlth-time-user[_ngcontent-%COMP%]{font-size:.8rem;color:var(--dim-text-color);overflow:hidden;text-overflow:ellipsis;max-width:calc(90vw - 120px)}.rlth-time-value[_ngcontent-%COMP%]{font-size:.8rem;color:var(--dim-text-color)}.rlth-status[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;justify-content:flex-end;align-items:flex-start;max-width:50%}.rlth-status-span[_ngcontent-%COMP%]{font-size:1rem;background-color:#efd0dd;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;border-radius:25px;color:#ad1457}.rlth-options-span[_ngcontent-%COMP%]{cursor:pointer}.rli-start[_ngcontent-%COMP%], .rli-end[_ngcontent-%COMP%]{display:flex;flex:1}.rli-start[_ngcontent-%COMP%]{justify-content:flex-start}.rli-end[_ngcontent-%COMP%]{justify-content:flex-end}.rli-end[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{justify-content:flex-end}.rlth-time-iconlist[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#f5f5f5;border-radius:50%;text-align:center;display:flex;justify-content:center;align-items:center}.rlth-time-iconlist[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px;height:18px;margin:auto}.rlth-details-gap[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center}.rlth-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;font-size:.9rem}.rlth-date[_ngcontent-%COMP%]{font-size:.8rem}"]}),re})()},9051:(be,ue,P)=>{P.d(ue,{G:()=>q});var d=P(5e3);let q=(()=>{class ne{constructor(){this.status=""}ngOnInit(){}}return ne.\u0275fac=function(w){return new(w||ne)},ne.\u0275cmp=d.Xpm({type:ne,selectors:[["app-status-tag"]],inputs:{status:"status"},decls:2,vars:1,consts:[[1,"rlth-status-span"]],template:function(w,H){1&w&&(d.TgZ(0,"span",0),d._uU(1),d.qZA()),2&w&&(d.xp6(1),d.Oqu(H.status))},styles:["span[_ngcontent-%COMP%]{font-size:1rem;background-color:var(--dim-bg-color);width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:2px 10px;border-radius:25px}"]}),ne})()},7410:(be,ue,P)=>{P.d(ue,{T:()=>oe});var d=P(5e3),q=P(2626),ne=P(6819),V=P(9352),w=P(9808),H=P(4342),F=P(9051),v=P(4112);function I(Y,le){if(1&Y&&d._UZ(0,"div",14),2&Y){const J=d.oxw(2);d.Q6J("MarkdownContentParser",J.task.content)}}function ee(Y,le){if(1&Y){const J=d.EpF();d.TgZ(0,"div",3),d.NdJ("click",function(){return d.CHM(J),d.oxw().openTask()}),d.TgZ(1,"header",4)(2,"div",5),d._UZ(3,"nz-progress",6),d.TgZ(4,"div",7)(5,"span",8),d._uU(6),d.TgZ(7,"span",9),d._uU(8),d.ALo(9,"date"),d.qZA()(),d.TgZ(10,"span",9),d._uU(11),d.qZA()()(),d.TgZ(12,"div",10),d._UZ(13,"app-status-tag",11),d.TgZ(14,"span",12),d._uU(15," more_vert "),d.qZA()()(),d.YNc(16,I,1,1,"div",13),d.qZA()}if(2&Y){const J=d.oxw();d.xp6(3),d.Q6J("nzPercent",J.task.percentage)("nzWidth",50),d.xp6(3),d.hij(" ",J.task.status,""),d.xp6(2),d.hij(" . ",d.lcZ(9,7,J.task.createdAt),""),d.xp6(3),d.hij(" ",J.flTask.userEmail," "),d.xp6(2),d.Q6J("status",J.task.requestCount?J.task.requestCount.toString():"0"),d.xp6(3),d.Q6J("ngIf",J.task.content)}}function j(Y,le){if(1&Y&&d._UZ(0,"span",19),2&Y){const J=d.oxw(2);d.Q6J("MarkdownContentParser",J.task.content)}}function W(Y,le){if(1&Y&&(d.TgZ(0,"div",15)(1,"div",16),d._UZ(2,"nz-progress",6),d.TgZ(3,"div"),d.YNc(4,j,1,1,"span",17),d.TgZ(5,"span",18),d._uU(6),d.ALo(7,"date"),d.qZA()()()()),2&Y){const J=d.oxw();d.xp6(2),d.Q6J("nzPercent",J.task.percentage)("nzWidth",50),d.xp6(2),d.Q6J("ngIf",J.task.content),d.xp6(2),d.Oqu(d.lcZ(7,4,J.task.createdAt))}}let oe=(()=>{class Y{constructor(J,re){this.router=J,this.userQuery=re,this.flTask={},this.disabled=!0}ngOnInit(){this.task=this.flTask}openTask(){this.task&&!this.disabled&&this.router.navigate([`/task/view/${this.task.id}`])}}return Y.\u0275fac=function(J){return new(J||Y)(d.Y36(q.F0),d.Y36(ne.o))},Y.\u0275cmp=d.Xpm({type:Y,selectors:[["app-task-list-item"]],inputs:{task:"task",flTask:"flTask",disabled:"disabled",size:"size"},decls:3,vars:3,consts:[[3,"size"],["class","req-list-item-body",3,"click",4,"ngIf"],["class","rlth-minsize",4,"ngIf"],[1,"req-list-item-body",3,"click"],[1,"req-list-item-header"],[1,"rlth-time"],["nzType","circle",1,"rlth-time-icon",3,"nzPercent","nzWidth"],[1,"rlth-time-div"],[1,"rlth-time-text"],[1,"rlth-time-user"],[1,"rlth-status"],[3,"status"],[1,"material-symbols-rounded","rlth-options-span"],["class","req-list-item-container",3,"MarkdownContentParser",4,"ngIf"],[1,"req-list-item-container",3,"MarkdownContentParser"],[1,"rlth-minsize"],[1,"milestone-content"],["class","rlth-title",3,"MarkdownContentParser",4,"ngIf"],[1,"rlth-date"],[1,"rlth-title",3,"MarkdownContentParser"]],template:function(J,re){1&J&&(d._UZ(0,"WhiteSpace",0),d.YNc(1,ee,17,9,"div",1),d.YNc(2,W,8,6,"div",2)),2&J&&(d.Q6J("size","md"),d.xp6(1),d.Q6J("ngIf",!re.size),d.xp6(1),d.Q6J("ngIf",re.size))},directives:[V.yG,w.O5,H.M,F.G,v.J],pipes:[w.uU],styles:[".req-list-item-body[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;font-size:1rem}.req-list-item-header[_ngcontent-%COMP%]{flex:1;display:flex}.req-list-item-container[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;white-space:break-spaces;font-size:1rem;padding:12px 0 6px}.req-list-item-footer[_ngcontent-%COMP%]{max-height:60px;flex:1;background-color:#f5f5f5;display:flex}.rlth-time[_ngcontent-%COMP%]{display:flex;flex:3;align-items:flex-start;height:100%}.rlth-time-icon[_ngcontent-%COMP%]{max-width:40px;max-height:40px;background-color:#f5f5f5;border-radius:50%;margin-right:8px;text-align:center;display:flex;justify-content:center;align-items:center}.rlth-time-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:28px;height:28px;margin:auto}.rlth-time-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-self:center;max-width:100%;font-size:1rem}.rlth-time-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;align-self:flex-start}.rlth-time-text[_ngcontent-%COMP%]{font-weight:500;font-size:1rem;text-transform:capitalize}.rlth-time-user[_ngcontent-%COMP%]{font-size:.8rem;color:var(--dim-text-color);overflow:hidden;text-overflow:ellipsis;max-width:calc(90vw - 120px)}.rlth-time-value[_ngcontent-%COMP%]{font-size:.8rem;color:var(--dim-text-color)}.rlth-status[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;justify-content:flex-end;max-width:50%;column-gap:4px}.rlth-status-span[_ngcontent-%COMP%]{font-size:1rem;background-color:#efd0dd;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;border-radius:25px;color:#ad1457}.rli-start[_ngcontent-%COMP%], .rli-end[_ngcontent-%COMP%]{display:flex;flex:1}.rli-start[_ngcontent-%COMP%]{justify-content:flex-start}.rli-end[_ngcontent-%COMP%]{justify-content:flex-end}.rli-end[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{justify-content:flex-end}footer[_ngcontent-%COMP%]{margin-top:6px;display:flex;border-top:1px solid var(--dim-bg-color);font-size:.9rem;justify-content:flex-end;align-content:center;color:var(--dim-text-color)}button[_ngcontent-%COMP%]{border-radius:15px;padding:1px 8px;border:1px solid transparent;align-self:flex-start;position:relative;background-color:var(--dim-bg-color)}button[_ngcontent-%COMP%] > .dot[_ngcontent-%COMP%]{position:absolute;right:-4px;top:-9px;min-width:13px;max-width:25px;height:14px;border-radius:20px;background-color:#108ee9;padding:0 4%;color:#fff;font-size:10px}"]}),Y})()},3455:(be,ue,P)=>{P.d(ue,{l:()=>V});var d=P(1469),q=P(5e3),ne=P(7564);let V=(()=>{class w extends d.Gv{constructor(F){super(F),this.store=F,this.$milestones=this.selectAll(),this.$milestoneCount=this.selectCount()}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(ne.w))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},6832:(be,ue,P)=>{P.d(ue,{Z:()=>V});var d=P(1469),q=P(5e3),ne=P(6580);let V=(()=>{class w extends d.Gv{constructor(F){super(F),this.store=F,this.$requests=this.selectAll(),this.$requestCount=this.selectCount()}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(ne.y))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},4419:(be,ue,P)=>{P.d(ue,{R:()=>V});var d=P(1469),q=P(5e3),ne=P(1790);let V=(()=>{class w extends d.Gv{constructor(F){super(F),this.store=F,this.$tasks=this.selectAll(),this.$taskCount=this.selectCount()}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(ne.N))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},6819:(be,ue,P)=>{P.d(ue,{o:()=>V});var d=P(1469),q=P(5e3),ne=P(3557);let V=(()=>{class w extends d.Gv{constructor(F){super(F),this.store=F}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(ne.X))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},4817:(be,ue,P)=>{P.d(ue,{z:()=>ne});var d=P(5e3),q=P(9565);let ne=(()=>{class V{constructor(H){this.navigation=H}onClick(){this.navigation.back()}}return V.\u0275fac=function(H){return new(H||V)(d.Y36(q.f))},V.\u0275dir=d.lG2({type:V,selectors:[["","appBackButton",""]],hostBindings:function(H,F){1&H&&d.NdJ("click",function(){return F.onClick()})}}),V})()},4112:(be,ue,P)=>{P.d(ue,{J:()=>j});var d=P(6956),q=P(412),ne=P(8197),V=P(3981),w=P(5e3),H=P(7465);P(8769);const I={group:"inline",inline:!0,atom:!0,attrs:{tag:{},type:{}},selectable:!1,draggable:!1,toDOM:W=>["a",{class:"tag",tag:W.attrs.tag},"#"+W.attrs.tag]},ee={group:"inline",inline:!0,atom:!0,attrs:{name:{},email:{},id:{}},selectable:!1,draggable:!1,toDOM:W=>["a",{class:"mention",mention:W.attrs.name},"@"+W.attrs.name]};let j=(()=>{class W{constructor(Y,le){this.element=Y,this.global=le,this.customSchema=new ne.V_({nodes:V.fK.spec.nodes.append({mention:ee,tag:I}),marks:V.fK.spec.marks})}ngAfterViewChecked(){this.editorView.updateState(d.yy.fromJSON({schema:this.customSchema},this.content))}ngAfterViewInit(){if(this.content&&(this.editorView=new q.tk(this.element.nativeElement,{state:d.yy.fromJSON({schema:this.customSchema},this.content),editable:()=>!1})),!this.editorView)return;let Y=this.editorView.dom.querySelectorAll(".tag"),le=this.editorView.dom.querySelectorAll(".mention");(Y.length>0||le.length>0)&&(Y.forEach(J=>{J.addEventListener("click",re=>{let ae=J.getAttribute("tag");re.stopPropagation(),this.global.navigatToSearch(ae)})}),le.forEach(J=>{J.addEventListener("click",re=>{let ae=J.getAttribute("mention");re.stopPropagation(),this.global.navigatToSearch(ae)})}))}}return W.\u0275fac=function(Y){return new(Y||W)(w.Y36(w.SBq),w.Y36(H.U))},W.\u0275dir=w.lG2({type:W,selectors:[["","MarkdownContentParser",""]],inputs:{content:["MarkdownContentParser","content"]}}),W})()},9830:(be,ue,P)=>{P.d(ue,{Fz:()=>d,Ly:()=>q,MM:()=>V,gE:()=>ne});var d=(()=>{return(w=d||(d={})).Grid="Grid",w.IDEClient="IDEClient",w.IDEServer="IDEServer",w.Explorer="Explorer",w.DataPanel="DataPanel",w.StylePanel="StylePanel",d;var w})(),q=(()=>{return(w=q||(q={})).ShowStopper="ShowStopper",w.Critical="Critical",w.Major="Major",w.Minor="Minor",q;var w})(),ne=(()=>{return(w=ne||(ne={})).Open="Open",w.Close="Close",ne;var w})(),V=(()=>{return(w=V||(V={})).Issue="Issue",w.FeatureRequest="Feature",w.Feedback="Feedback",V;var w})()},7465:(be,ue,P)=>{P.d(ue,{U:()=>W});var d=P(2626),q=P(8197),ne=P(3981),V=P(5e3),w=P(9854),H=P(6138),F=P(8964);const v=P(8769),{addMentionNodes:ee}=v;let W=(()=>{class oe{constructor(le,J,re,ae){this.router=le,this.requestService=J,this.taskService=re,this.milestoneService=ae,this.selectedIndex=0,this.isSearching=!1,this.url="",this.showMenu=!1,this.requestSubFilterList=["All","Open","Close"],this.taskSubFilterList=["All","Yet To Start","In Progress","Completed"],this.searchFilterList=["Requests","Tasks","Milestones"],this.milestoneSubFilterList=["All","Yet To Start","In Progress","Completed"],this.customSchema=new q.V_({nodes:ee(ee(ne.fK.spec.nodes)),marks:ne.fK.spec.marks}),this.mentionArray=[{name:"IlayaSelvaGanesh",id:"101",email:"ilaya@gmail.com"},{name:"SanthoshBalaji",id:"102",email:"santhosh@gmail.com"},{name:"Dhivya",id:"103",email:"dhivya@gmail.com"},{name:"Ramya",id:"104",email:"ramya@gmail.com"},{name:"Sathya",id:"104",email:"sathya@gmail.com"},{name:"Murali",id:"105",email:"murali@gmail.com"}],this.tagArray=[{tag:"ShowStopper",type:"Severity"},{tag:"Critical",type:"Severity"},{tag:"Major",type:"Severity"},{tag:"Minor",type:"Severity"},{tag:"Grid",type:"Module"},{tag:"Issue",type:"Category"},{tag:"Feature",type:"Category"},{tag:"Feedback",type:"Category"}],le.events.subscribe(Z=>{Z instanceof d.m2&&(this.url=Z.url)})}getFilterListFromEntity(le){switch(le){case"request":return this.requestSubFilterList;case"task":return this.taskSubFilterList;case"search":return this.searchFilterList;case"milestone":return this.milestoneSubFilterList;default:return[]}return[]}navigatToSearch(le){null==event||event.stopPropagation(),this.router.navigate([`/home/search/${le}`])}}return oe.\u0275fac=function(le){return new(le||oe)(V.LFG(d.F0),V.LFG(w.s),V.LFG(H.M),V.LFG(F.$))},oe.\u0275prov=V.Yz7({token:oe,factory:oe.\u0275fac,providedIn:"root"}),oe})()},6858:(be,ue,P)=>{P.d(ue,{O:()=>V});var d=P(2340),q=P(5e3),ne=P(520);let V=(()=>{class w{constructor(F){this.http=F,this.strapi_url=d.N.strapi_url,this.options={headers:{Authorization:`Bearer ${d.N.strapi_token}`}}}addNewRequest(F){return this.http.post(`${this.strapi_url}api/requests`,F,this.options)}getRequestList(){return this.http.get(`${this.strapi_url}api/requests/`,this.options)}getRequestById(F){return this.http.get(`${this.strapi_url}api/requests/${F}/`,this.options)}getAllDetailsRequestById(F){return this.http.get(`${this.strapi_url}api/requests/${F}/?populate=%2A`,this.options)}getUnlinkedRequestList(){return this.http.get(`${this.strapi_url}api/requests/?filters[associatedTask]`,this.options)}getFilteredRequestList(F){let v=`${this.strapi_url}api/requests/?`;return F.forEach(I=>{v+=`&filters[${I.fieldName}][${I.operator}]=${I.searchValue}`}),this.http.get(v,this.options)}updateRequestById(F,v){return this.http.put(`${this.strapi_url}api/requests/${F}`,v={data:{content:v.data.content,rawContent:v.data.rawContent,category:v.data.category,severity:v.data.severity,status:v.data.status,associatedTask:v.data.associatedTask}},this.options)}deleteRequestById(F){return this.http.delete(`${this.strapi_url}api/requests/${F}`,this.options)}addNewTask(F){return this.http.post(`${this.strapi_url}api/tasks`,F,this.options)}getTaskList(){return this.http.get(`${this.strapi_url}api/tasks/`,this.options)}getTaskById(F){return this.http.get(`${this.strapi_url}api/tasks/${F}/`,this.options)}getAllDetailsTaskById(F){return this.http.get(`${this.strapi_url}api/tasks/${F}/?populate=%2A`,this.options)}getUnlinkedTasks(){return this.http.get(`${this.strapi_url}api/tasks/?filters[associatedMilestone]`,this.options)}getFilteredTaskList(F){let v=`${this.strapi_url}api/tasks/?`;return F.forEach(I=>{v+=`&filters[${I.fieldName}][${I.operator}]=${I.searchValue}`}),console.log(v),this.http.get(v,this.options)}updateTaskById(F,v){return this.http.put(`${this.strapi_url}api/tasks/${F}`,v,this.options)}deleteTaskById(F){return this.http.delete(`${this.strapi_url}api/tasks/${F}`,this.options)}addNewMilestone(F){return this.http.post(`${this.strapi_url}api/milestones`,F,this.options)}getMilestoneList(){return this.http.get(`${this.strapi_url}api/milestones/`,this.options)}getMilestoneById(F){return this.http.get(`${this.strapi_url}api/milestones/${F}/`,this.options)}getAllDetailsMilestoneById(F){return this.http.get(`${this.strapi_url}api/milestones/${F}/?populate=%2A`,this.options)}getFilteredMilestoneList(F){let v=`${this.strapi_url}api/milestones/?`;return F.forEach(I=>{v+=`&filters[${I.fieldName}][${I.operator}]=${I.searchValue}`}),this.http.get(v,this.options)}updateMilestoneById(F,v){return this.http.put(`${this.strapi_url}api/milestones/${F}`,v,this.options)}deleteMilestoneById(F){return this.http.delete(`${this.strapi_url}api/milestones/${F}`,this.options)}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(ne.eN))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},8964:(be,ue,P)=>{P.d(ue,{$:()=>w});var d=P(5861),q=P(4464),ne=P(5e3),V=P(6858);let w=(()=>{class H{constructor(v){this.httpService=v,this.allMilestones=[]}addNewMilestone(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.addNewMilestone(v))})()}getMilestoneList(){var v=this;return(0,d.Z)(function*(){v.allMilestones=yield(0,q.n)(v.httpService.getMilestoneList())})()}getMilestoneById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getMilestoneById(v))})()}getAllDetailsMilestoneById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getAllDetailsMilestoneById(v))})()}getFilteredMilestoneList(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getFilteredMilestoneList(v))})()}updateMilestoneById(v,I){var ee=this;return(0,d.Z)(function*(){return yield(0,q.n)(ee.httpService.updateMilestoneById(v,I))})()}deleteMilestoneById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.deleteMilestoneById(v))})()}getCustomFilterList(v){return"All"===v?this.allMilestones:this.allMilestones.filter(I=>I.status==v)}}return H.\u0275fac=function(v){return new(v||H)(ne.LFG(V.O))},H.\u0275prov=ne.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"}),H})()},9565:(be,ue,P)=>{P.d(ue,{f:()=>V});var d=P(2626),q=P(5e3),ne=P(9808);let V=(()=>{class w{constructor(F,v){this.router=F,this.location=v,this.history=[],this.history.push(this.router.url),this.router.events.subscribe(I=>{I instanceof d.m2&&this.history.push(I.urlAfterRedirects)})}back(){this.history.pop(),this.history.length>0?this.location.back():this.router.navigateByUrl("/")}}return w.\u0275fac=function(F){return new(F||w)(q.LFG(d.F0),q.LFG(ne.Ye))},w.\u0275prov=q.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},9854:(be,ue,P)=>{P.d(ue,{s:()=>w});var d=P(5861),q=P(4464),ne=P(5e3),V=P(6858);let w=(()=>{class H{constructor(v){this.httpService=v,this.allRequests=[]}addNewRequest(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.addNewRequest({data:v}))})()}getAllRequestList(){var v=this;return(0,d.Z)(function*(){v.allRequests=yield(0,q.n)(v.httpService.getRequestList())})()}getRequestById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getRequestById(v))})()}getAllDetailsRequestById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getAllDetailsRequestById(v))})()}getUnlinkedRequestList(){var v=this;return(0,d.Z)(function*(){return yield(0,q.n)(v.httpService.getUnlinkedRequestList())})()}getFilteredRequestList(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getFilteredRequestList(v))})()}updateRequestById(v,I){var ee=this;return(0,d.Z)(function*(){return yield(0,q.n)(ee.httpService.updateRequestById(v,I))})()}deleteRequestById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.deleteRequestById(v))})()}getCustomFilterList(v){return"All"===v?this.allRequests:this.allRequests.filter(I=>I.status==v)}getRequest(v){let ee=v.data.attributes;return ee.id=v.data.id,console.log(ee),ee}}return H.\u0275fac=function(v){return new(v||H)(ne.LFG(V.O))},H.\u0275prov=ne.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"}),H})()},6138:(be,ue,P)=>{P.d(ue,{M:()=>w});var d=P(5861),q=P(4464),ne=P(5e3),V=P(6858);let w=(()=>{class H{constructor(v){this.httpService=v,this.allTasks=[]}addNewTask(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.addNewTask(v))})()}getTaskList(){var v=this;return(0,d.Z)(function*(){v.allTasks=yield(0,q.n)(v.httpService.getTaskList())})()}getTaskById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getTaskById(v))})()}getAllDetailsTaskById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getAllDetailsTaskById(v))})()}getUnlinkedTaskList(){var v=this;return(0,d.Z)(function*(){return yield(0,q.n)(v.httpService.getUnlinkedTasks())})()}getFilteredTaskList(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.getFilteredTaskList(v))})()}updateTaskById(v,I){var ee=this;return(0,d.Z)(function*(){return yield(0,q.n)(ee.httpService.updateTaskById(v,I))})()}deleteTaskById(v){var I=this;return(0,d.Z)(function*(){return yield(0,q.n)(I.httpService.deleteTaskById(v))})()}getCustomFilterList(v){return"All"===v?this.allTasks:this.allTasks.filter(I=>I.status==v)}}return H.\u0275fac=function(v){return new(v||H)(ne.LFG(V.O))},H.\u0275prov=ne.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"}),H})()},8769:(be,ue,P)=>{P.r(ue),P.d(ue,{addMentionNodes:()=>ee,addTagNodes:()=>j,getMentionsPlugin:()=>F,mentionNode:()=>v,tagNode:()=>I});var d=P(6956),q=P(412);const w=(W=null,function(oe,Y,le){return le=le||this,clearTimeout(W),W=setTimeout(function(){oe.apply(le,arguments)},Y),W});var W;function F(Y){Y=Object.assign({},{mentionTrigger:"@",hashtagTrigger:"#",allowSpace:!0,getSuggestions:(de,te,pe)=>{pe([])},getSuggestionsHTML:de=>'<div class="suggestion-item-list">'+de.map(te=>'<div class="suggestion-item">'+te.name+"</div>").join("")+"</div>",activeClass:"suggestion-item-active",suggestionTextClass:"prosemirror-suggestion",maxNoOfSuggestions:10,delay:500},Y);var le=null,J=document.createElement("div"),ae=function(){J.style.display="none"},Z=function(de,te){J.querySelector(".suggestion-item-list").childNodes[de].classList.remove(te)},fe=function(de,te){J.querySelector(".suggestion-item-list").childNodes[de].classList.add(te)},xe=function(de,te,pe){Z(te.index,pe.activeClass),te.index=de,fe(te.index,pe.activeClass)},Te=function(de,te,pe){var Me=te.suggestions[te.index],G=de.state.schema.nodes[te.type].create("mention"===te.type?{name:Me.name,id:Me.id,email:Me.email}:{tag:Me.tag}),M=de.state.tr.replaceWith(te.range.from,te.range.to,G);de.dispatch(M)};return new d.Sy({key:new d.H$("autosuggestions"),state:{init:()=>({active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0}),apply(de,te){var pe={active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0},Me=de.selection;if(Me.from!==Me.to)return pe;const G=function V(W,oe){var Y=W.before();const le=W.doc.textBetween(Y,W.pos,"\n","\0");var fe,J=function ne(W,oe,Y){return{mention:Y?new RegExp("(^|\\s)"+W+"([\\w-\\+]+\\s?[\\w-\\+]*)$"):new RegExp("(^|\\s)"+W+"([\\w-\\+]+)$"),tag:new RegExp("(^|\\s)"+oe+"([\\w-]+)$")}}(oe.mentionTrigger,oe.hashtagTrigger,oe.allowSpace),re=le.match(J.mention),ae=le.match(J.tag),Z=re||ae;if(re?fe="mention":ae&&(fe="tag"),Z){Z.index=Z[0].startsWith(" ")?Z.index+1:Z.index,Z[0]=Z[0].startsWith(" ")?Z[0].substring(1,Z[0].length):Z[0];var xe=W.start()+Z.index;return{range:{from:xe,to:xe+Z[0].length},queryText:Z[2],type:fe}}}(Me.$from,Y);return G&&(pe.active=!0,pe.range=G.range,pe.type=G.type,pe.text=G.queryText),pe}},props:{handleKeyDown(de,te){var Se,G,M,pe=this.getState(de.state);return!(!pe.active&&!pe.suggestions.length||(G=13===te.keyCode,Se=38===te.keyCode,M=27===te.keyCode,40===te.keyCode?(function(de,te,pe){Z(te.index,pe.activeClass),te.index++,te.index=te.index===te.suggestions.length?0:te.index,fe(te.index,pe.activeClass)}(0,pe,Y),0):Se?(function(de,te,pe){Z(te.index,pe.activeClass),te.index--,te.index=-1===te.index?te.suggestions.length-1:te.index,fe(te.index,pe.activeClass)}(0,pe,Y),0):G?(Te(de,pe),0):!M||(clearTimeout(le),ae(),this.state={active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0},0)))},decorations(de){const{active:te,range:pe}=this.getState(de);return te?q.EH.create(de.doc,[q.p.inline(pe.from,pe.to,{nodeName:"span",class:Y.suggestionTextClass})]):null}},view(){return{update:de=>{var te=this.key.getState(de.state);if(!te.text)return ae(),void clearTimeout(le);le=w(function(){Y.getSuggestions(te.type,te.text,function(pe){te.suggestions=pe,function(de,te,pe,Me){J.innerHTML=Me.getSuggestionsHTML(pe,te.type),J.querySelectorAll(".suggestion-item").forEach(function(K,X){K.addEventListener("click",function(){Te(de,te),de.focus()}),K.addEventListener("mouseover",function(){xe(X,te,Me)}),K.addEventListener("mouseout",function(){xe(X,te,Me)})}),fe(te.index,Me.activeClass);var M=de.domAtPos(de.state.selection.$from.pos).node.querySelector("."+Me.suggestionTextClass),D=M.getBoundingClientRect();document.body.appendChild(J),J.classList.add("suggestion-item-container"),J.style.position="fixed",J.style.left=D.left+"px",J.style.top=M.offsetHeight+D.top+"px",J.style.display="block",J.style.zIndex="999999"}(de,te,pe,Y)})},Y.delay,this)}}}})}const v={group:"inline",inline:!0,atom:!0,attrs:{id:"",name:"",email:""},selectable:!1,draggable:!1,toDOM:W=>["span",{"data-mention-id":W.attrs.id,"data-mention-name":W.attrs.name,"data-mention-email":W.attrs.email,class:"prosemirror-mention-node"},"@"+W.attrs.name||0],parseDOM:[{tag:"span[data-mention-id][data-mention-name][data-mention-email]",getAttrs:W=>({id:W.getAttribute("data-mention-id"),name:W.getAttribute("data-mention-name"),email:W.getAttribute("data-mention-email")})}]},I={group:"inline",inline:!0,atom:!0,attrs:{tag:""},selectable:!1,draggable:!1,toDOM:W=>["span",{"data-tag":W.attrs.tag,class:"prosemirror-tag-node"},"#"+W.attrs.tag],parseDOM:[{tag:"span[data-tag]",getAttrs:W=>({tag:W.getAttribute("data-tag")})}]};function ee(W){return W.append({mention:v})}function j(W){return W.append({tag:I})}},4464:(be,ue,P)=>{P.d(ue,{n:()=>q});var d=P(6805);function q(ne,V){const w="object"==typeof V;return new Promise((H,F)=>{let I,v=!1;ne.subscribe({next:ee=>{I=ee,v=!0},error:F,complete:()=>{v?H(I):w?H(V.defaultValue):F(new d.K)}})})}},8197:(be,ue,P)=>{function d(x){this.content=x}P.d(ue,{aw:()=>Le,PW:()=>Q,HY:()=>w,vc:()=>I,ZU:()=>Ne,NB:()=>G,Ts:()=>Me,e4:()=>ee,V_:()=>Mt,p2:()=>j}),d.prototype={constructor:d,find:function(x){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===x)return i;return-1},get:function(x){var i=this.find(x);return-1==i?void 0:this.content[i+1]},update:function(x,i,s){var a=s&&s!=x?this.remove(s):this,f=a.find(x),m=a.content.slice();return-1==f?m.push(s||x,i):(m[f+1]=i,s&&(m[f]=s)),new d(m)},remove:function(x){var i=this.find(x);if(-1==i)return this;var s=this.content.slice();return s.splice(i,2),new d(s)},addToStart:function(x,i){return new d([x,i].concat(this.remove(x).content))},addToEnd:function(x,i){var s=this.remove(x).content.slice();return s.push(x,i),new d(s)},addBefore:function(x,i,s){var a=this.remove(i),f=a.content.slice(),m=a.find(x);return f.splice(-1==m?f.length:m,0,i,s),new d(f)},forEach:function(x){for(var i=0;i<this.content.length;i+=2)x(this.content[i],this.content[i+1])},prepend:function(x){return(x=d.from(x)).size?new d(x.content.concat(this.subtract(x).content)):this},append:function(x){return(x=d.from(x)).size?new d(this.subtract(x).content.concat(x.content)):this},subtract:function(x){var i=this;x=d.from(x);for(var s=0;s<x.content.length;s+=2)i=i.remove(x.content[s]);return i},get size(){return this.content.length>>1}},d.from=function(x){if(x instanceof d)return x;var i=[];if(x)for(var s in x)i.push(s,x[s]);return new d(i)};const q=d;function ne(x,i,s){for(let a=0;;a++){if(a==x.childCount||a==i.childCount)return x.childCount==i.childCount?null:s;let f=x.child(a),m=i.child(a);if(f!=m){if(!f.sameMarkup(m))return s;if(f.isText&&f.text!=m.text){for(let C=0;f.text[C]==m.text[C];C++)s++;return s}if(f.content.size||m.content.size){let C=ne(f.content,m.content,s+1);if(null!=C)return C}s+=f.nodeSize}else s+=f.nodeSize}}function V(x,i,s,a){for(let f=x.childCount,m=i.childCount;;){if(0==f||0==m)return f==m?null:{a:s,b:a};let C=x.child(--f),E=i.child(--m),A=C.nodeSize;if(C!=E){if(!C.sameMarkup(E))return{a:s,b:a};if(C.isText&&C.text!=E.text){let se=0,he=Math.min(C.text.length,E.text.length);for(;se<he&&C.text[C.text.length-se-1]==E.text[E.text.length-se-1];)se++,s--,a--;return{a:s,b:a}}if(C.content.size||E.content.size){let se=V(C.content,E.content,s-1,a-1);if(se)return se}s-=A,a-=A}else s-=A,a-=A}}class w{constructor(i,s){if(this.content=i,this.size=s||0,null==s)for(let a=0;a<i.length;a++)this.size+=i[a].nodeSize}nodesBetween(i,s,a,f=0,m){for(let C=0,E=0;E<s;C++){let A=this.content[C],se=E+A.nodeSize;if(se>i&&!1!==a(A,f+E,m||null,C)&&A.content.size){let he=E+1;A.nodesBetween(Math.max(0,i-he),Math.min(A.content.size,s-he),a,f+he)}E=se}}descendants(i){this.nodesBetween(0,this.size,i)}textBetween(i,s,a,f){let m="",C=!0;return this.nodesBetween(i,s,(E,A)=>{E.isText?(m+=E.text.slice(Math.max(i,A)-A,s-A),C=!a):E.isLeaf?(f?m+="function"==typeof f?f(E):f:E.type.spec.leafText&&(m+=E.type.spec.leafText(E)),C=!a):!C&&E.isBlock&&(m+=a,C=!0)},0),m}append(i){if(!i.size)return this;if(!this.size)return i;let s=this.lastChild,a=i.firstChild,f=this.content.slice(),m=0;for(s.isText&&s.sameMarkup(a)&&(f[f.length-1]=s.withText(s.text+a.text),m=1);m<i.content.length;m++)f.push(i.content[m]);return new w(f,this.size+i.size)}cut(i,s=this.size){if(0==i&&s==this.size)return this;let a=[],f=0;if(s>i)for(let m=0,C=0;C<s;m++){let E=this.content[m],A=C+E.nodeSize;A>i&&((C<i||A>s)&&(E=E.isText?E.cut(Math.max(0,i-C),Math.min(E.text.length,s-C)):E.cut(Math.max(0,i-C-1),Math.min(E.content.size,s-C-1))),a.push(E),f+=E.nodeSize),C=A}return new w(a,f)}cutByIndex(i,s){return i==s?w.empty:0==i&&s==this.content.length?this:new w(this.content.slice(i,s))}replaceChild(i,s){let a=this.content[i];if(a==s)return this;let f=this.content.slice(),m=this.size+s.nodeSize-a.nodeSize;return f[i]=s,new w(f,m)}addToStart(i){return new w([i].concat(this.content),this.size+i.nodeSize)}addToEnd(i){return new w(this.content.concat(i),this.size+i.nodeSize)}eq(i){if(this.content.length!=i.content.length)return!1;for(let s=0;s<this.content.length;s++)if(!this.content[s].eq(i.content[s]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(i){let s=this.content[i];if(!s)throw new RangeError("Index "+i+" out of range for "+this);return s}maybeChild(i){return this.content[i]||null}forEach(i){for(let s=0,a=0;s<this.content.length;s++){let f=this.content[s];i(f,a,s),a+=f.nodeSize}}findDiffStart(i,s=0){return ne(this,i,s)}findDiffEnd(i,s=this.size,a=i.size){return V(this,i,s,a)}findIndex(i,s=-1){if(0==i)return F(0,i);if(i==this.size)return F(this.content.length,i);if(i>this.size||i<0)throw new RangeError(`Position ${i} outside of fragment (${this})`);for(let a=0,f=0;;a++){let C=f+this.child(a).nodeSize;if(C>=i)return C==i||s>0?F(a+1,C):F(a,f);f=C}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(i=>i.toJSON()):null}static fromJSON(i,s){if(!s)return w.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new w(s.map(i.nodeFromJSON))}static fromArray(i){if(!i.length)return w.empty;let s,a=0;for(let f=0;f<i.length;f++){let m=i[f];a+=m.nodeSize,f&&m.isText&&i[f-1].sameMarkup(m)?(s||(s=i.slice(0,f)),s[s.length-1]=m.withText(s[s.length-1].text+m.text)):s&&s.push(m)}return new w(s||i,a)}static from(i){if(!i)return w.empty;if(i instanceof w)return i;if(Array.isArray(i))return this.fromArray(i);if(i.attrs)return new w([i],i.nodeSize);throw new RangeError("Can not convert "+i+" to a Fragment"+(i.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}w.empty=new w([],0);const H={index:0,offset:0};function F(x,i){return H.index=x,H.offset=i,H}function v(x,i){if(x===i)return!0;if(!x||"object"!=typeof x||!i||"object"!=typeof i)return!1;let s=Array.isArray(x);if(Array.isArray(i)!=s)return!1;if(s){if(x.length!=i.length)return!1;for(let a=0;a<x.length;a++)if(!v(x[a],i[a]))return!1}else{for(let a in x)if(!(a in i)||!v(x[a],i[a]))return!1;for(let a in i)if(!(a in x))return!1}return!0}let I=(()=>{class x{constructor(s,a){this.type=s,this.attrs=a}addToSet(s){let a,f=!1;for(let m=0;m<s.length;m++){let C=s[m];if(this.eq(C))return s;if(this.type.excludes(C.type))a||(a=s.slice(0,m));else{if(C.type.excludes(this.type))return s;!f&&C.type.rank>this.type.rank&&(a||(a=s.slice(0,m)),a.push(this),f=!0),a&&a.push(C)}}return a||(a=s.slice()),f||a.push(this),a}removeFromSet(s){for(let a=0;a<s.length;a++)if(this.eq(s[a]))return s.slice(0,a).concat(s.slice(a+1));return s}isInSet(s){for(let a=0;a<s.length;a++)if(this.eq(s[a]))return!0;return!1}eq(s){return this==s||this.type==s.type&&v(this.attrs,s.attrs)}toJSON(){let s={type:this.type.name};for(let a in this.attrs){s.attrs=this.attrs;break}return s}static fromJSON(s,a){if(!a)throw new RangeError("Invalid input for Mark.fromJSON");let f=s.marks[a.type];if(!f)throw new RangeError(`There is no mark type ${a.type} in this schema`);return f.create(a.attrs)}static sameSet(s,a){if(s==a)return!0;if(s.length!=a.length)return!1;for(let f=0;f<s.length;f++)if(!s[f].eq(a[f]))return!1;return!0}static setFrom(s){if(!s||Array.isArray(s)&&0==s.length)return x.none;if(s instanceof x)return[s];let a=s.slice();return a.sort((f,m)=>f.type.rank-m.type.rank),a}}return x.none=[],x})();class ee extends Error{}class j{constructor(i,s,a){this.content=i,this.openStart=s,this.openEnd=a}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(i,s){let a=oe(this.content,i+this.openStart,s);return a&&new j(a,this.openStart,this.openEnd)}removeBetween(i,s){return new j(W(this.content,i+this.openStart,s+this.openStart),this.openStart,this.openEnd)}eq(i){return this.content.eq(i.content)&&this.openStart==i.openStart&&this.openEnd==i.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let i={content:this.content.toJSON()};return this.openStart>0&&(i.openStart=this.openStart),this.openEnd>0&&(i.openEnd=this.openEnd),i}static fromJSON(i,s){if(!s)return j.empty;let a=s.openStart||0,f=s.openEnd||0;if("number"!=typeof a||"number"!=typeof f)throw new RangeError("Invalid input for Slice.fromJSON");return new j(w.fromJSON(i,s.content),a,f)}static maxOpen(i,s=!0){let a=0,f=0;for(let m=i.firstChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.firstChild)a++;for(let m=i.lastChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.lastChild)f++;return new j(i,a,f)}}function W(x,i,s){let{index:a,offset:f}=x.findIndex(i),m=x.maybeChild(a),{index:C,offset:E}=x.findIndex(s);if(f==i||m.isText){if(E!=s&&!x.child(C).isText)throw new RangeError("Removing non-flat range");return x.cut(0,i).append(x.cut(s))}if(a!=C)throw new RangeError("Removing non-flat range");return x.replaceChild(a,m.copy(W(m.content,i-f-1,s-f-1)))}function oe(x,i,s,a){let{index:f,offset:m}=x.findIndex(i),C=x.maybeChild(f);if(m==i||C.isText)return a&&!a.canReplace(f,f,s)?null:x.cut(0,i).append(s).append(x.cut(i));let E=oe(C.content,i-m-1,s);return E&&x.replaceChild(f,C.copy(E))}function Y(x,i,s){if(s.openStart>x.depth)throw new ee("Inserted content deeper than insertion position");if(x.depth-s.openStart!=i.depth-s.openEnd)throw new ee("Inconsistent open depths");return le(x,i,s,0)}function le(x,i,s,a){let f=x.index(a),m=x.node(a);if(f==i.index(a)&&a<x.depth-s.openStart){let C=le(x,i,s,a+1);return m.copy(m.content.replaceChild(f,C))}if(s.content.size){if(s.openStart||s.openEnd||x.depth!=a||i.depth!=a){let{start:C,end:E}=function Ie(x,i){let s=i.depth-x.openStart,f=i.node(s).copy(x.content);for(let m=s-1;m>=0;m--)f=i.node(m).copy(w.from(f));return{start:f.resolveNoCache(x.openStart+s),end:f.resolveNoCache(f.content.size-x.openEnd-s)}}(s,x);return fe(m,xe(x,C,E,i,a))}{let C=x.parent,E=C.content;return fe(C,E.cut(0,x.parentOffset).append(s.content).append(E.cut(i.parentOffset)))}}return fe(m,Oe(x,i,a))}function J(x,i){if(!i.type.compatibleContent(x.type))throw new ee("Cannot join "+i.type.name+" onto "+x.type.name)}function re(x,i,s){let a=x.node(s);return J(a,i.node(s)),a}function ae(x,i){let s=i.length-1;s>=0&&x.isText&&x.sameMarkup(i[s])?i[s]=x.withText(i[s].text+x.text):i.push(x)}function Z(x,i,s,a){let f=(i||x).node(s),m=0,C=i?i.index(s):f.childCount;x&&(m=x.index(s),x.depth>s?m++:x.textOffset&&(ae(x.nodeAfter,a),m++));for(let E=m;E<C;E++)ae(f.child(E),a);i&&i.depth==s&&i.textOffset&&ae(i.nodeBefore,a)}function fe(x,i){if(!x.type.validContent(i))throw new ee("Invalid content for node "+x.type.name);return x.copy(i)}function xe(x,i,s,a,f){let m=x.depth>f&&re(x,i,f+1),C=a.depth>f&&re(s,a,f+1),E=[];return Z(null,x,f,E),m&&C&&i.index(f)==s.index(f)?(J(m,C),ae(fe(m,xe(x,i,s,a,f+1)),E)):(m&&ae(fe(m,Oe(x,i,f+1)),E),Z(i,s,f,E),C&&ae(fe(C,Oe(s,a,f+1)),E)),Z(a,null,f,E),new w(E)}function Oe(x,i,s){let a=[];return Z(null,x,s,a),x.depth>s&&ae(fe(re(x,i,s+1),Oe(x,i,s+1)),a),Z(i,null,s,a),new w(a)}j.empty=new j(w.empty,0,0);class Te{constructor(i,s,a){this.pos=i,this.path=s,this.parentOffset=a,this.depth=s.length/3-1}resolveDepth(i){return null==i?this.depth:i<0?this.depth+i:i}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(i){return this.path[3*this.resolveDepth(i)]}index(i){return this.path[3*this.resolveDepth(i)+1]}indexAfter(i){return i=this.resolveDepth(i),this.index(i)+(i!=this.depth||this.textOffset?1:0)}start(i){return 0==(i=this.resolveDepth(i))?0:this.path[3*i-1]+1}end(i){return i=this.resolveDepth(i),this.start(i)+this.node(i).content.size}before(i){if(!(i=this.resolveDepth(i)))throw new RangeError("There is no position before the top-level node");return i==this.depth+1?this.pos:this.path[3*i-1]}after(i){if(!(i=this.resolveDepth(i)))throw new RangeError("There is no position after the top-level node");return i==this.depth+1?this.pos:this.path[3*i-1]+this.path[3*i].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let i=this.parent,s=this.index(this.depth);if(s==i.childCount)return null;let a=this.pos-this.path[this.path.length-1],f=i.child(s);return a?i.child(s).cut(a):f}get nodeBefore(){let i=this.index(this.depth),s=this.pos-this.path[this.path.length-1];return s?this.parent.child(i).cut(0,s):0==i?null:this.parent.child(i-1)}posAtIndex(i,s){s=this.resolveDepth(s);let a=this.path[3*s],f=0==s?0:this.path[3*s-1]+1;for(let m=0;m<i;m++)f+=a.child(m).nodeSize;return f}marks(){let i=this.parent,s=this.index();if(0==i.content.size)return I.none;if(this.textOffset)return i.child(s).marks;let a=i.maybeChild(s-1),f=i.maybeChild(s);if(!a){let E=a;a=f,f=E}let m=a.marks;for(var C=0;C<m.length;C++)!1===m[C].type.spec.inclusive&&(!f||!m[C].isInSet(f.marks))&&(m=m[C--].removeFromSet(m));return m}marksAcross(i){let s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;let a=s.marks,f=i.parent.maybeChild(i.index());for(var m=0;m<a.length;m++)!1===a[m].type.spec.inclusive&&(!f||!a[m].isInSet(f.marks))&&(a=a[m--].removeFromSet(a));return a}sharedDepth(i){for(let s=this.depth;s>0;s--)if(this.start(s)<=i&&this.end(s)>=i)return s;return 0}blockRange(i=this,s){if(i.pos<this.pos)return i.blockRange(this);for(let a=this.depth-(this.parent.inlineContent||this.pos==i.pos?1:0);a>=0;a--)if(i.pos<=this.end(a)&&(!s||s(this.node(a))))return new Me(this,i,a);return null}sameParent(i){return this.pos-this.parentOffset==i.pos-i.parentOffset}max(i){return i.pos>this.pos?i:this}min(i){return i.pos<this.pos?i:this}toString(){let i="";for(let s=1;s<=this.depth;s++)i+=(i?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return i+":"+this.parentOffset}static resolve(i,s){if(!(s>=0&&s<=i.content.size))throw new RangeError("Position "+s+" out of range");let a=[],f=0,m=s;for(let C=i;;){let{index:E,offset:A}=C.content.findIndex(m),se=m-A;if(a.push(C,E,f+A),!se||(C=C.child(E),C.isText))break;m=se-1,f+=A+1}return new Te(s,a,m)}static resolveCached(i,s){for(let f=0;f<de.length;f++){let m=de[f];if(m.pos==s&&m.doc==i)return m}let a=de[te]=Te.resolve(i,s);return te=(te+1)%pe,a}}let de=[],te=0,pe=12;class Me{constructor(i,s,a){this.$from=i,this.$to=s,this.depth=a}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Se=Object.create(null);class G{constructor(i,s,a,f=I.none){this.type=i,this.attrs=s,this.marks=f,this.content=a||w.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(i){return this.content.child(i)}maybeChild(i){return this.content.maybeChild(i)}forEach(i){this.content.forEach(i)}nodesBetween(i,s,a,f=0){this.content.nodesBetween(i,s,a,f,this)}descendants(i){this.nodesBetween(0,this.content.size,i)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(i,s,a,f){return this.content.textBetween(i,s,a,f)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(i){return this==i||this.sameMarkup(i)&&this.content.eq(i.content)}sameMarkup(i){return this.hasMarkup(i.type,i.attrs,i.marks)}hasMarkup(i,s,a){return this.type==i&&v(this.attrs,s||i.defaultAttrs||Se)&&I.sameSet(this.marks,a||I.none)}copy(i=null){return i==this.content?this:new G(this.type,this.attrs,i,this.marks)}mark(i){return i==this.marks?this:new G(this.type,this.attrs,this.content,i)}cut(i,s=this.content.size){return 0==i&&s==this.content.size?this:this.copy(this.content.cut(i,s))}slice(i,s=this.content.size,a=!1){if(i==s)return j.empty;let f=this.resolve(i),m=this.resolve(s),C=a?0:f.sharedDepth(s),E=f.start(C),se=f.node(C).content.cut(f.pos-E,m.pos-E);return new j(se,f.depth-C,m.depth-C)}replace(i,s,a){return Y(this.resolve(i),this.resolve(s),a)}nodeAt(i){for(let s=this;;){let{index:a,offset:f}=s.content.findIndex(i);if(s=s.maybeChild(a),!s)return null;if(f==i||s.isText)return s;i-=f+1}}childAfter(i){let{index:s,offset:a}=this.content.findIndex(i);return{node:this.content.maybeChild(s),index:s,offset:a}}childBefore(i){if(0==i)return{node:null,index:0,offset:0};let{index:s,offset:a}=this.content.findIndex(i);if(a<i)return{node:this.content.child(s),index:s,offset:a};let f=this.content.child(s-1);return{node:f,index:s-1,offset:a-f.nodeSize}}resolve(i){return Te.resolveCached(this,i)}resolveNoCache(i){return Te.resolve(this,i)}rangeHasMark(i,s,a){let f=!1;return s>i&&this.nodesBetween(i,s,m=>(a.isInSet(m.marks)&&(f=!0),!f)),f}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let i=this.type.name;return this.content.size&&(i+="("+this.content.toStringInner()+")"),D(this.marks,i)}contentMatchAt(i){let s=this.type.contentMatch.matchFragment(this.content,0,i);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s}canReplace(i,s,a=w.empty,f=0,m=a.childCount){let C=this.contentMatchAt(i).matchFragment(a,f,m),E=C&&C.matchFragment(this.content,s);if(!E||!E.validEnd)return!1;for(let A=f;A<m;A++)if(!this.type.allowsMarks(a.child(A).marks))return!1;return!0}canReplaceWith(i,s,a,f){if(f&&!this.type.allowsMarks(f))return!1;let m=this.contentMatchAt(i).matchType(a),C=m&&m.matchFragment(this.content,s);return!!C&&C.validEnd}canAppend(i){return i.content.size?this.canReplace(this.childCount,this.childCount,i.content):this.type.compatibleContent(i.type)}check(){if(!this.type.validContent(this.content))throw new RangeError(`Invalid content for node ${this.type.name}: ${this.content.toString().slice(0,50)}`);let i=I.none;for(let s=0;s<this.marks.length;s++)i=this.marks[s].addToSet(i);if(!I.sameSet(i,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(s=>s.type.name)}`);this.content.forEach(s=>s.check())}toJSON(){let i={type:this.type.name};for(let s in this.attrs){i.attrs=this.attrs;break}return this.content.size&&(i.content=this.content.toJSON()),this.marks.length&&(i.marks=this.marks.map(s=>s.toJSON())),i}static fromJSON(i,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");let a=null;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=s.marks.map(i.markFromJSON)}if("text"==s.type){if("string"!=typeof s.text)throw new RangeError("Invalid text node in JSON");return i.text(s.text,a)}let f=w.fromJSON(i,s.content);return i.nodeType(s.type).create(s.attrs,f,a)}}G.prototype.text=void 0;class M extends G{constructor(i,s,a,f){if(super(i,s,null,f),!a)throw new RangeError("Empty text nodes are not allowed");this.text=a}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):D(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(i,s){return this.text.slice(i,s)}get nodeSize(){return this.text.length}mark(i){return i==this.marks?this:new M(this.type,this.attrs,this.text,i)}withText(i){return i==this.text?this:new M(this.type,this.attrs,i,this.marks)}cut(i=0,s=this.text.length){return 0==i&&s==this.text.length?this:this.withText(this.text.slice(i,s))}eq(i){return this.sameMarkup(i)&&this.text==i.text}toJSON(){let i=super.toJSON();return i.text=this.text,i}}function D(x,i){for(let s=x.length-1;s>=0;s--)i=x[s].type.name+"("+i+")";return i}class N{constructor(i){this.validEnd=i,this.next=[],this.wrapCache=[]}static parse(i,s){let a=new K(i,s);if(null==a.next)return N.empty;let f=X(a);a.next&&a.err("Unexpected trailing text");let m=function dt(x){let i=Object.create(null);return function s(a){let f=[];a.forEach(C=>{x[C].forEach(({term:E,to:A})=>{if(!E)return;let se;for(let he=0;he<f.length;he++)f[he][0]==E&&(se=f[he][1]);nt(x,A).forEach(he=>{se||f.push([E,se=[]]),-1==se.indexOf(he)&&se.push(he)})})});let m=i[a.join(",")]=new N(a.indexOf(x.length-1)>-1);for(let C=0;C<f.length;C++){let E=f[C][1].sort(ht);m.next.push({type:f[C][0],next:i[E.join(",")]||s(E)})}return m}(nt(x,0))}(function Je(x){let i=[[]];return f(function m(C,E){if("choice"==C.type)return C.exprs.reduce((A,se)=>A.concat(m(se,E)),[]);if("seq"!=C.type){if("star"==C.type){let A=s();return a(E,A),f(m(C.expr,A),A),[a(A)]}if("plus"==C.type){let A=s();return f(m(C.expr,E),A),f(m(C.expr,A),A),[a(A)]}if("opt"==C.type)return[a(E)].concat(m(C.expr,E));if("range"==C.type){let A=E;for(let se=0;se<C.min;se++){let he=s();f(m(C.expr,A),he),A=he}if(-1==C.max)f(m(C.expr,A),A);else for(let se=C.min;se<C.max;se++){let he=s();a(A,he),f(m(C.expr,A),he),A=he}return[a(A)]}if("name"==C.type)return[a(E,void 0,C.value)];throw new Error("Unknown expr type")}for(let A=0;;A++){let se=m(C.exprs[A],E);if(A==C.exprs.length-1)return se;f(se,E=s())}}(x,0),s()),i;function s(){return i.push([])-1}function a(C,E,A){let se={term:A,to:E};return i[C].push(se),se}function f(C,E){C.forEach(A=>A.to=E)}}(f));return function Ge(x,i){for(let s=0,a=[x];s<a.length;s++){let f=a[s],m=!f.validEnd,C=[];for(let E=0;E<f.next.length;E++){let{type:A,next:se}=f.next[E];C.push(A.name),m&&!(A.isText||A.hasRequiredAttrs())&&(m=!1),-1==a.indexOf(se)&&a.push(se)}m&&i.err("Only non-generatable nodes ("+C.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(m,a),m}matchType(i){for(let s=0;s<this.next.length;s++)if(this.next[s].type==i)return this.next[s].next;return null}matchFragment(i,s=0,a=i.childCount){let f=this;for(let m=s;f&&m<a;m++)f=f.matchType(i.child(m).type);return f}get inlineContent(){return this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type:s}=this.next[i];if(!s.isText&&!s.hasRequiredAttrs())return s}return null}compatible(i){for(let s=0;s<this.next.length;s++)for(let a=0;a<i.next.length;a++)if(this.next[s].type==i.next[a].type)return!0;return!1}fillBefore(i,s=!1,a=0){let f=[this];return function m(C,E){let A=C.matchFragment(i,a);if(A&&(!s||A.validEnd))return w.from(E.map(se=>se.createAndFill()));for(let se=0;se<C.next.length;se++){let{type:he,next:Re}=C.next[se];if(!he.isText&&!he.hasRequiredAttrs()&&-1==f.indexOf(Re)){f.push(Re);let rt=m(Re,E.concat(he));if(rt)return rt}}return null}(this,[])}findWrapping(i){for(let a=0;a<this.wrapCache.length;a+=2)if(this.wrapCache[a]==i)return this.wrapCache[a+1];let s=this.computeWrapping(i);return this.wrapCache.push(i,s),s}computeWrapping(i){let s=Object.create(null),a=[{match:this,type:null,via:null}];for(;a.length;){let f=a.shift(),m=f.match;if(m.matchType(i)){let C=[];for(let E=f;E.type;E=E.via)C.push(E.type);return C.reverse()}for(let C=0;C<m.next.length;C++){let{type:E,next:A}=m.next[C];!E.isLeaf&&!E.hasRequiredAttrs()&&!(E.name in s)&&(!f.type||A.validEnd)&&(a.push({match:E.contentMatch,type:E,via:f}),s[E.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(i){if(i>=this.next.length)throw new RangeError(`There's no ${i}th edge in this content match`);return this.next[i]}toString(){let i=[];return function s(a){i.push(a);for(let f=0;f<a.next.length;f++)-1==i.indexOf(a.next[f].next)&&s(a.next[f].next)}(this),i.map((a,f)=>{let m=f+(a.validEnd?"*":" ")+" ";for(let C=0;C<a.next.length;C++)m+=(C?", ":"")+a.next[C].type.name+"->"+i.indexOf(a.next[C].next);return m}).join("\n")}}N.empty=new N(!0);class K{constructor(i,s){this.string=i,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=i.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(i){return this.next==i&&(this.pos++||!0)}err(i){throw new SyntaxError(i+" (in content expression '"+this.string+"')")}}function X(x){let i=[];do{i.push(me(x))}while(x.eat("|"));return 1==i.length?i[0]:{type:"choice",exprs:i}}function me(x){let i=[];do{i.push(ke(x))}while(x.next&&")"!=x.next&&"|"!=x.next);return 1==i.length?i[0]:{type:"seq",exprs:i}}function ke(x){let i=function Ue(x){if(x.eat("(")){let i=X(x);return x.eat(")")||x.err("Missing closing paren"),i}if(!/\W/.test(x.next)){let i=function De(x,i){let s=x.nodeTypes,a=s[i];if(a)return[a];let f=[];for(let m in s){let C=s[m];C.groups.indexOf(i)>-1&&f.push(C)}return 0==f.length&&x.err("No node type or group '"+i+"' found"),f}(x,x.next).map(s=>(null==x.inline?x.inline=s.isInline:x.inline!=s.isInline&&x.err("Mixing inline and block content"),{type:"name",value:s}));return x.pos++,1==i.length?i[0]:{type:"choice",exprs:i}}x.err("Unexpected token '"+x.next+"'")}(x);for(;;)if(x.eat("+"))i={type:"plus",expr:i};else if(x.eat("*"))i={type:"star",expr:i};else if(x.eat("?"))i={type:"opt",expr:i};else{if(!x.eat("{"))break;i=ve(x,i)}return i}function _e(x){/\D/.test(x.next)&&x.err("Expected number, got '"+x.next+"'");let i=Number(x.next);return x.pos++,i}function ve(x,i){let s=_e(x),a=s;return x.eat(",")&&(a="}"!=x.next?_e(x):-1),x.eat("}")||x.err("Unclosed braced range"),{type:"range",min:s,max:a,expr:i}}function ht(x,i){return i-x}function nt(x,i){let s=[];return function a(f){let m=x[f];if(1==m.length&&!m[0].term)return a(m[0].to);s.push(f);for(let C=0;C<m.length;C++){let{term:E,to:A}=m[C];!E&&-1==s.indexOf(A)&&a(A)}}(i),s.sort(ht)}function ut(x){let i=Object.create(null);for(let s in x){let a=x[s];if(!a.hasDefault)return null;i[s]=a.default}return i}function Ke(x,i){let s=Object.create(null);for(let a in x){let f=i&&i[a];if(void 0===f){let m=x[a];if(!m.hasDefault)throw new RangeError("No value supplied for attribute "+a);f=m.default}s[a]=f}return s}function Ze(x){let i=Object.create(null);if(x)for(let s in x)i[s]=new ft(x[s]);return i}class Ve{constructor(i,s,a){this.name=i,this.schema=s,this.spec=a,this.markSet=null,this.groups=a.group?a.group.split(" "):[],this.attrs=Ze(a.attrs),this.defaultAttrs=ut(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(a.inline||"text"==i),this.isText="text"==i}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==N.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let i in this.attrs)if(this.attrs[i].isRequired)return!0;return!1}compatibleContent(i){return this==i||this.contentMatch.compatible(i.contentMatch)}computeAttrs(i){return!i&&this.defaultAttrs?this.defaultAttrs:Ke(this.attrs,i)}create(i=null,s,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new G(this,this.computeAttrs(i),w.from(s),I.setFrom(a))}createChecked(i=null,s,a){if(s=w.from(s),!this.validContent(s))throw new RangeError("Invalid content for node "+this.name);return new G(this,this.computeAttrs(i),s,I.setFrom(a))}createAndFill(i=null,s,a){if(i=this.computeAttrs(i),(s=w.from(s)).size){let C=this.contentMatch.fillBefore(s);if(!C)return null;s=C.append(s)}let f=this.contentMatch.matchFragment(s),m=f&&f.fillBefore(w.empty,!0);return m?new G(this,i,s.append(m),I.setFrom(a)):null}validContent(i){let s=this.contentMatch.matchFragment(i);if(!s||!s.validEnd)return!1;for(let a=0;a<i.childCount;a++)if(!this.allowsMarks(i.child(a).marks))return!1;return!0}allowsMarkType(i){return null==this.markSet||this.markSet.indexOf(i)>-1}allowsMarks(i){if(null==this.markSet)return!0;for(let s=0;s<i.length;s++)if(!this.allowsMarkType(i[s].type))return!1;return!0}allowedMarks(i){if(null==this.markSet)return i;let s;for(let a=0;a<i.length;a++)this.allowsMarkType(i[a].type)?s&&s.push(i[a]):s||(s=i.slice(0,a));return s?s.length?s:I.none:i}static compile(i,s){let a=Object.create(null);i.forEach((m,C)=>a[m]=new Ve(m,s,C));let f=s.spec.topNode||"doc";if(!a[f])throw new RangeError("Schema is missing its top node type ('"+f+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(let m in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a}}class ft{constructor(i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default}get isRequired(){return!this.hasDefault}}class Ne{constructor(i,s,a,f){this.name=i,this.rank=s,this.schema=a,this.spec=f,this.attrs=Ze(f.attrs),this.excluded=null;let m=ut(this.attrs);this.instance=m?new I(this,m):null}create(i=null){return!i&&this.instance?this.instance:new I(this,Ke(this.attrs,i))}static compile(i,s){let a=Object.create(null),f=0;return i.forEach((m,C)=>a[m]=new Ne(m,f++,s,C)),a}removeFromSet(i){for(var s=0;s<i.length;s++)i[s].type==this&&(i=i.slice(0,s).concat(i.slice(s+1)),s--);return i}isInSet(i){for(let s=0;s<i.length;s++)if(i[s].type==this)return i[s]}excludes(i){return this.excluded.indexOf(i)>-1}}class Mt{constructor(i){this.cached=Object.create(null),this.spec={nodes:q.from(i.nodes),marks:q.from(i.marks||{}),topNode:i.topNode},this.nodes=Ve.compile(this.spec.nodes,this),this.marks=Ne.compile(this.spec.marks,this);let s=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");let f=this.nodes[a],m=f.spec.content||"",C=f.spec.marks;f.contentMatch=s[m]||(s[m]=N.parse(m,this.nodes)),f.inlineContent=f.contentMatch.inlineContent,f.markSet="_"==C?null:C?it(this,C.split(" ")):""!=C&&f.inlineContent?null:[]}for(let a in this.marks){let f=this.marks[a],m=f.spec.excludes;f.excluded=null==m?[f]:""==m?[]:it(this,m.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(i,s=null,a,f){if("string"==typeof i)i=this.nodeType(i);else{if(!(i instanceof Ve))throw new RangeError("Invalid node type: "+i);if(i.schema!=this)throw new RangeError("Node type from different schema used ("+i.name+")")}return i.createChecked(s,a,f)}text(i,s){let a=this.nodes.text;return new M(a,a.defaultAttrs,i,I.setFrom(s))}mark(i,s){return"string"==typeof i&&(i=this.marks[i]),i.create(s)}nodeFromJSON(i){return G.fromJSON(this,i)}markFromJSON(i){return I.fromJSON(this,i)}nodeType(i){let s=this.nodes[i];if(!s)throw new RangeError("Unknown node type: "+i);return s}}function it(x,i){let s=[];for(let a=0;a<i.length;a++){let f=i[a],m=x.marks[f],C=m;if(m)s.push(m);else for(let E in x.marks){let A=x.marks[E];("_"==f||A.spec.group&&A.spec.group.split(" ").indexOf(f)>-1)&&s.push(C=A)}if(!C)throw new SyntaxError("Unknown mark type: '"+i[a]+"'")}return s}class Le{constructor(i,s){this.schema=i,this.rules=s,this.tags=[],this.styles=[],s.forEach(a=>{a.tag?this.tags.push(a):a.style&&this.styles.push(a)}),this.normalizeLists=!this.tags.some(a=>{if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;let f=i.nodes[a.node];return f.contentMatch.matchType(f)})}parse(i,s={}){let a=new p(this,s,!1);return a.addAll(i,s.from,s.to),a.finish()}parseSlice(i,s={}){let a=new p(this,s,!0);return a.addAll(i,s.from,s.to),j.maxOpen(a.finish())}matchTag(i,s,a){for(let f=a?this.tags.indexOf(a)+1:0;f<this.tags.length;f++){let m=this.tags[f];if(k(i,m.tag)&&(void 0===m.namespace||i.namespaceURI==m.namespace)&&(!m.context||s.matchesContext(m.context))){if(m.getAttrs){let C=m.getAttrs(i);if(!1===C)continue;m.attrs=C||void 0}return m}}}matchStyle(i,s,a,f){for(let m=f?this.styles.indexOf(f)+1:0;m<this.styles.length;m++){let C=this.styles[m],E=C.style;if(!(0!=E.indexOf(i)||C.context&&!a.matchesContext(C.context)||E.length>i.length&&(61!=E.charCodeAt(i.length)||E.slice(i.length+1)!=s))){if(C.getAttrs){let A=C.getAttrs(s);if(!1===A)continue;C.attrs=A||void 0}return C}}}static schemaRules(i){let s=[];function a(f){let m=null==f.priority?50:f.priority,C=0;for(;C<s.length;C++){let E=s[C];if((null==E.priority?50:E.priority)<m)break}s.splice(C,0,f)}for(let f in i.marks){let m=i.marks[f].spec.parseDOM;m&&m.forEach(C=>{a(C=T(C)),C.mark=f})}for(let f in i.nodes){let m=i.nodes[f].spec.parseDOM;m&&m.forEach(C=>{a(C=T(C)),C.node=f})}return s}static fromSchema(i){return i.cached.domParser||(i.cached.domParser=new Le(i,Le.schemaRules(i)))}}const $e={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},pt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},mt={ol:!0,ul:!0};function _(x,i,s){return null!=i?(i?1:0)|("full"===i?2:0):x&&"pre"==x.whitespace?3:-5&s}class h{constructor(i,s,a,f,m,C,E){this.type=i,this.attrs=s,this.marks=a,this.pendingMarks=f,this.solid=m,this.options=E,this.content=[],this.activeMarks=I.none,this.stashMarks=[],this.match=C||(4&E?null:i.contentMatch)}findWrapping(i){if(!this.match){if(!this.type)return[];let s=this.type.contentMatch.fillBefore(w.from(i));if(!s){let f,a=this.type.contentMatch;return(f=a.findWrapping(i.type))?(this.match=a,f):null}this.match=this.type.contentMatch.matchFragment(s)}return this.match.findWrapping(i.type)}finish(i){if(!(1&this.options)){let f,a=this.content[this.content.length-1];if(a&&a.isText&&(f=/[ \t\r\n\u000c]+$/.exec(a.text))){let m=a;a.text.length==f[0].length?this.content.pop():this.content[this.content.length-1]=m.withText(m.text.slice(0,m.text.length-f[0].length))}}let s=w.from(this.content);return!i&&this.match&&(s=s.append(this.match.fillBefore(w.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}popFromStashMark(i){for(let s=this.stashMarks.length-1;s>=0;s--)if(i.eq(this.stashMarks[s]))return this.stashMarks.splice(s,1)[0]}applyPending(i){for(let s=0,a=this.pendingMarks;s<a.length;s++){let f=a[s];(this.type?this.type.allowsMarkType(f.type):B(f.type,i))&&!f.isInSet(this.activeMarks)&&(this.activeMarks=f.addToSet(this.activeMarks),this.pendingMarks=f.removeFromSet(this.pendingMarks))}}inlineContext(i){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:i.parentNode&&!$e.hasOwnProperty(i.parentNode.nodeName.toLowerCase())}}class p{constructor(i,s,a){this.parser=i,this.options=s,this.isOpen=a,this.open=0;let m,f=s.topNode,C=_(null,s.preserveWhitespace,0)|(a?4:0);m=f?new h(f.type,f.attrs,I.none,I.none,!0,s.topMatch||f.type.contentMatch,C):new h(a?null:i.schema.topNodeType,null,I.none,I.none,!0,null,C),this.nodes=[m],this.find=s.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(i){if(3==i.nodeType)this.addTextNode(i);else if(1==i.nodeType){let s=i.getAttribute("style"),a=s?this.readStyles(function b(x){let s,i=/\s*([\w-]+)\s*:\s*([^;]+)/g,a=[];for(;s=i.exec(x);)a.push(s[1],s[2].trim());return a}(s)):null,f=this.top;if(null!=a)for(let m=0;m<a.length;m++)this.addPendingMark(a[m]);if(this.addElement(i),null!=a)for(let m=0;m<a.length;m++)this.removePendingMark(a[m],f)}}addTextNode(i){let s=i.nodeValue,a=this.top;if(2&a.options||a.inlineContext(i)||/[^ \t\r\n\u000c]/.test(s)){if(1&a.options)s=2&a.options?s.replace(/\r\n?/g,"\n"):s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let f=a.content[a.content.length-1],m=i.previousSibling;(!f||m&&"BR"==m.nodeName||f.isText&&/[ \t\r\n\u000c]$/.test(f.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s)),this.findInText(i)}else this.findInside(i)}addElement(i,s){let f,a=i.nodeName.toLowerCase();mt.hasOwnProperty(a)&&this.parser.normalizeLists&&function y(x){for(let i=x.firstChild,s=null;i;i=i.nextSibling){let a=1==i.nodeType?i.nodeName.toLowerCase():null;a&&mt.hasOwnProperty(a)&&s?(s.appendChild(i),i=s):"li"==a?s=i:a&&(s=null)}}(i);let m=this.options.ruleFromNode&&this.options.ruleFromNode(i)||(f=this.parser.matchTag(i,this,s));if(m?m.ignore:pt.hasOwnProperty(a))this.findInside(i),this.ignoreFallback(i);else if(!m||m.skip||m.closeParent){m&&m.closeParent?this.open=Math.max(0,this.open-1):m&&m.skip.nodeType&&(i=m.skip);let C,E=this.top,A=this.needsBlock;if($e.hasOwnProperty(a))C=!0,E.type||(this.needsBlock=!0);else if(!i.firstChild)return void this.leafFallback(i);this.addAll(i),C&&this.sync(E),this.needsBlock=A}else this.addElementByRule(i,m,!1===m.consuming?f:void 0)}leafFallback(i){"BR"==i.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(i.ownerDocument.createTextNode("\n"))}ignoreFallback(i){"BR"==i.nodeName&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(i){let s=I.none;e:for(let a=0;a<i.length;a+=2)for(let f;;){let m=this.parser.matchStyle(i[a],i[a+1],this,f);if(!m)continue e;if(m.ignore)return null;if(s=this.parser.schema.marks[m.mark].create(m.attrs).addToSet(s),!1!==m.consuming)break;f=m}return s}addElementByRule(i,s,a){let f,m,C;s.node?(m=this.parser.schema.nodes[s.node],m.isLeaf?this.insertNode(m.create(s.attrs))||this.leafFallback(i):f=this.enter(m,s.attrs||null,s.preserveWhitespace)):(C=this.parser.schema.marks[s.mark].create(s.attrs),this.addPendingMark(C));let E=this.top;if(m&&m.isLeaf)this.findInside(i);else if(a)this.addElement(i,a);else if(s.getContent)this.findInside(i),s.getContent(i,this.parser.schema).forEach(A=>this.insertNode(A));else{let A=i;"string"==typeof s.contentElement?A=i.querySelector(s.contentElement):"function"==typeof s.contentElement?A=s.contentElement(i):s.contentElement&&(A=s.contentElement),this.findAround(i,A,!0),this.addAll(A)}f&&this.sync(E)&&this.open--,C&&this.removePendingMark(C,E)}addAll(i,s,a){let f=s||0;for(let m=s?i.childNodes[s]:i.firstChild,C=null==a?null:i.childNodes[a];m!=C;m=m.nextSibling,++f)this.findAtPoint(i,f),this.addDOM(m);this.findAtPoint(i,f)}findPlace(i){let s,a;for(let f=this.open;f>=0;f--){let m=this.nodes[f],C=m.findWrapping(i);if(C&&(!s||s.length>C.length)&&(s=C,a=m,!C.length)||m.solid)break}if(!s)return!1;this.sync(a);for(let f=0;f<s.length;f++)this.enterInner(s[f],null,!1);return!0}insertNode(i){if(i.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&this.enterInner(s)}if(this.findPlace(i)){this.closeExtra();let s=this.top;s.applyPending(i.type),s.match&&(s.match=s.match.matchType(i.type));let a=s.activeMarks;for(let f=0;f<i.marks.length;f++)(!s.type||s.type.allowsMarkType(i.marks[f].type))&&(a=i.marks[f].addToSet(a));return s.content.push(i.mark(a)),!0}return!1}enter(i,s,a){let f=this.findPlace(i.create(s));return f&&this.enterInner(i,s,!0,a),f}enterInner(i,s=null,a=!1,f){this.closeExtra();let m=this.top;m.applyPending(i),m.match=m.match&&m.match.matchType(i);let C=_(i,f,m.options);4&m.options&&0==m.content.length&&(C|=4),this.nodes.push(new h(i,s,m.activeMarks,m.pendingMarks,a,null,C)),this.open++}closeExtra(i=!1){let s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(i));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(i){for(let s=this.open;s>=0;s--)if(this.nodes[s]==i)return this.open=s,!0;return!1}get currentPos(){this.closeExtra();let i=0;for(let s=this.open;s>=0;s--){let a=this.nodes[s].content;for(let f=a.length-1;f>=0;f--)i+=a[f].nodeSize;s&&i++}return i}findAtPoint(i,s){if(this.find)for(let a=0;a<this.find.length;a++)this.find[a].node==i&&this.find[a].offset==s&&(this.find[a].pos=this.currentPos)}findInside(i){if(this.find)for(let s=0;s<this.find.length;s++)null==this.find[s].pos&&1==i.nodeType&&i.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)}findAround(i,s,a){if(i!=s&&this.find)for(let f=0;f<this.find.length;f++)null==this.find[f].pos&&1==i.nodeType&&i.contains(this.find[f].node)&&s.compareDocumentPosition(this.find[f].node)&(a?2:4)&&(this.find[f].pos=this.currentPos)}findInText(i){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==i&&(this.find[s].pos=this.currentPos-(i.nodeValue.length-this.find[s].offset))}matchesContext(i){if(i.indexOf("|")>-1)return i.split(/\s*\|\s*/).some(this.matchesContext,this);let s=i.split("/"),a=this.options.context,f=!(this.isOpen||a&&a.parent.type!=this.nodes[0].type),m=(f?0:1)-(a?a.depth+1:0),C=(E,A)=>{for(;E>=0;E--){let se=s[E];if(""==se){if(E==s.length-1||0==E)continue;for(;A>=m;A--)if(C(E-1,A))return!0;return!1}{let he=A>0||0==A&&f?this.nodes[A].type:a&&A>=m?a.node(A-m).type:null;if(!he||he.name!=se&&-1==he.groups.indexOf(se))return!1;A--}}return!0};return C(s.length-1,this.open)}textblockFromContext(){let i=this.options.context;if(i)for(let s=i.depth;s>=0;s--){let a=i.node(s).contentMatchAt(i.indexAfter(s)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(let s in this.parser.schema.nodes){let a=this.parser.schema.nodes[s];if(a.isTextblock&&a.defaultAttrs)return a}}addPendingMark(i){let s=function U(x,i){for(let s=0;s<i.length;s++)if(x.eq(i[s]))return i[s]}(i,this.top.pendingMarks);s&&this.top.stashMarks.push(s),this.top.pendingMarks=i.addToSet(this.top.pendingMarks)}removePendingMark(i,s){for(let a=this.open;a>=0;a--){let f=this.nodes[a];if(f.pendingMarks.lastIndexOf(i)>-1)f.pendingMarks=i.removeFromSet(f.pendingMarks);else{f.activeMarks=i.removeFromSet(f.activeMarks);let C=f.popFromStashMark(i);C&&f.type&&f.type.allowsMarkType(C.type)&&(f.activeMarks=C.addToSet(f.activeMarks))}if(f==s)break}}}function k(x,i){return(x.matches||x.msMatchesSelector||x.webkitMatchesSelector||x.mozMatchesSelector).call(x,i)}function T(x){let i={};for(let s in x)i[s]=x[s];return i}function B(x,i){let s=i.schema.nodes;for(let a in s){let f=s[a];if(!f.allowsMarkType(x))continue;let m=[],C=E=>{m.push(E);for(let A=0;A<E.edgeCount;A++){let{type:se,next:he}=E.edge(A);if(se==i||m.indexOf(he)<0&&C(he))return!0}};if(C(f.contentMatch))return!0}}class Q{constructor(i,s){this.nodes=i,this.marks=s}serializeFragment(i,s={},a){a||(a=ce(s).createDocumentFragment());let f=a,m=[];return i.forEach(C=>{if(m.length||C.marks.length){let E=0,A=0;for(;E<m.length&&A<C.marks.length;){let se=C.marks[A];if(this.marks[se.type.name]){if(!se.eq(m[E][0])||!1===se.type.spec.spanning)break;E++,A++}else A++}for(;E<m.length;)f=m.pop()[1];for(;A<C.marks.length;){let se=C.marks[A++],he=this.serializeMark(se,C.isInline,s);he&&(m.push([se,f]),f.appendChild(he.dom),f=he.contentDOM||he.dom)}}f.appendChild(this.serializeNodeInner(C,s))}),a}serializeNodeInner(i,s){let{dom:a,contentDOM:f}=Q.renderSpec(ce(s),this.nodes[i.type.name](i));if(f){if(i.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(i.content,s,f)}return a}serializeNode(i,s={}){let a=this.serializeNodeInner(i,s);for(let f=i.marks.length-1;f>=0;f--){let m=this.serializeMark(i.marks[f],i.isInline,s);m&&((m.contentDOM||m.dom).appendChild(a),a=m.dom)}return a}serializeMark(i,s,a={}){let f=this.marks[i.type.name];return f&&Q.renderSpec(ce(a),f(i,s))}static renderSpec(i,s,a=null){if("string"==typeof s)return{dom:i.createTextNode(s)};if(null!=s.nodeType)return{dom:s};if(s.dom&&null!=s.dom.nodeType)return s;let f=s[0],m=f.indexOf(" ");m>0&&(a=f.slice(0,m),f=f.slice(m+1));let C,E=a?i.createElementNS(a,f):i.createElement(f),A=s[1],se=1;if(A&&"object"==typeof A&&null==A.nodeType&&!Array.isArray(A)){se=2;for(let he in A)if(null!=A[he]){let Re=he.indexOf(" ");Re>0?E.setAttributeNS(he.slice(0,Re),he.slice(Re+1),A[he]):E.setAttribute(he,A[he])}}for(let he=se;he<s.length;he++){let Re=s[he];if(0===Re){if(he<s.length-1||he>se)throw new RangeError("Content hole must be the only child of its parent node");return{dom:E,contentDOM:E}}{let{dom:rt,contentDOM:Ot}=Q.renderSpec(i,Re,a);if(E.appendChild(rt),Ot){if(C)throw new RangeError("Multiple content holes");C=Ot}}}return{dom:E,contentDOM:C}}static fromSchema(i){return i.cached.domSerializer||(i.cached.domSerializer=new Q(this.nodesFromSchema(i),this.marksFromSchema(i)))}static nodesFromSchema(i){let s=ie(i.nodes);return s.text||(s.text=a=>a.text),s}static marksFromSchema(i){return ie(i.marks)}}function ie(x){let i={};for(let s in x){let a=x[s].spec.toDOM;a&&(i[s]=a)}return i}function ce(x){return x.document||window.document}},3981:(be,ue,P)=>{P.d(ue,{fK:()=>W});var d=P(8197);const q=["p",0],ne=["blockquote",0],V=["hr"],w=["pre",["code",0]],H=["br"],v=["em",0],I=["strong",0],ee=["code",0],W=new d.V_({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>q},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>ne},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>V},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:oe=>["h"+oe.attrs.level,0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>w},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:oe=>({src:oe.getAttribute("src"),title:oe.getAttribute("title"),alt:oe.getAttribute("alt")})}],toDOM(oe){let{src:Y,alt:le,title:J}=oe.attrs;return["img",{src:Y,alt:le,title:J}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>H}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:oe=>({href:oe.getAttribute("href"),title:oe.getAttribute("title")})}],toDOM(oe){let{href:Y,title:le}=oe.attrs;return["a",{href:Y,title:le},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>v},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:oe=>"normal"!=oe.style.fontWeight&&null},{style:"font-weight",getAttrs:oe=>/^(bold(er)?|[5-9]\d{2,})$/.test(oe)&&null}],toDOM:()=>I},code:{parseDOM:[{tag:"code"}],toDOM:()=>ee}}})},6956:(be,ue,P)=>{P.d(ue,{Bs:()=>v,C1:()=>W,H$:()=>Se,Sy:()=>te,Y1:()=>V,qv:()=>ee,yy:()=>Te});var d=P(8197),q=P(3060);const ne=Object.create(null);class V{constructor(M,D,N){this.$anchor=M,this.$head=D,this.ranges=N||[new w(M.min(D),M.max(D))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let M=this.ranges;for(let D=0;D<M.length;D++)if(M[D].$from.pos!=M[D].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(M,D=d.p2.empty){let N=D.content.lastChild,K=null;for(let ke=0;ke<D.openEnd;ke++)K=N,N=N.lastChild;let X=M.steps.length,me=this.ranges;for(let ke=0;ke<me.length;ke++){let{$from:_e,$to:ve}=me[ke],De=M.mapping.slice(X);M.replaceRange(De.map(_e.pos),De.map(ve.pos),ke?d.p2.empty:D),0==ke&&le(M,X,(N?N.isInline:K&&K.isTextblock)?-1:1)}}replaceWith(M,D){let N=M.steps.length,K=this.ranges;for(let X=0;X<K.length;X++){let{$from:me,$to:ke}=K[X],_e=M.mapping.slice(N),ve=_e.map(me.pos),De=_e.map(ke.pos);X?M.deleteRange(ve,De):(M.replaceRangeWith(ve,De,D),le(M,N,D.isInline?-1:1))}}static findFrom(M,D,N=!1){let K=M.parent.inlineContent?new v(M):Y(M.node(0),M.parent,M.pos,M.index(),D,N);if(K)return K;for(let X=M.depth-1;X>=0;X--){let me=D<0?Y(M.node(0),M.node(X),M.before(X+1),M.index(X),D,N):Y(M.node(0),M.node(X),M.after(X+1),M.index(X)+1,D,N);if(me)return me}return null}static near(M,D=1){return this.findFrom(M,D)||this.findFrom(M,-D)||new W(M.node(0))}static atStart(M){return Y(M,M,0,0,1)||new W(M)}static atEnd(M){return Y(M,M,M.content.size,M.childCount,-1)||new W(M)}static fromJSON(M,D){if(!D||!D.type)throw new RangeError("Invalid input for Selection.fromJSON");let N=ne[D.type];if(!N)throw new RangeError(`No selection type ${D.type} defined`);return N.fromJSON(M,D)}static jsonID(M,D){if(M in ne)throw new RangeError("Duplicate use of selection JSON ID "+M);return ne[M]=D,D.prototype.jsonID=M,D}getBookmark(){return v.between(this.$anchor,this.$head).getBookmark()}}V.prototype.visible=!0;class w{constructor(M,D){this.$from=M,this.$to=D}}let H=!1;function F(G){!H&&!G.parent.inlineContent&&(H=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+G.parent.type.name+")"))}class v extends V{constructor(M,D=M){F(M),F(D),super(M,D)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(M,D){let N=M.resolve(D.map(this.head));if(!N.parent.inlineContent)return V.near(N);let K=M.resolve(D.map(this.anchor));return new v(K.parent.inlineContent?K:N,N)}replace(M,D=d.p2.empty){if(super.replace(M,D),D==d.p2.empty){let N=this.$from.marksAcross(this.$to);N&&M.ensureMarks(N)}}eq(M){return M instanceof v&&M.anchor==this.anchor&&M.head==this.head}getBookmark(){return new I(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(M,D){if("number"!=typeof D.anchor||"number"!=typeof D.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new v(M.resolve(D.anchor),M.resolve(D.head))}static create(M,D,N=D){let K=M.resolve(D);return new this(K,N==D?K:M.resolve(N))}static between(M,D,N){let K=M.pos-D.pos;if((!N||K)&&(N=K>=0?1:-1),!D.parent.inlineContent){let X=V.findFrom(D,N,!0)||V.findFrom(D,-N,!0);if(!X)return V.near(D,N);D=X.$head}return M.parent.inlineContent||(0==K||(M=(V.findFrom(M,-N,!0)||V.findFrom(M,N,!0)).$anchor).pos<D.pos!=K<0)&&(M=D),new v(M,D)}}V.jsonID("text",v);class I{constructor(M,D){this.anchor=M,this.head=D}map(M){return new I(M.map(this.anchor),M.map(this.head))}resolve(M){return v.between(M.resolve(this.anchor),M.resolve(this.head))}}class ee extends V{constructor(M){let D=M.nodeAfter,N=M.node(0).resolve(M.pos+D.nodeSize);super(M,N),this.node=D}map(M,D){let{deleted:N,pos:K}=D.mapResult(this.anchor),X=M.resolve(K);return N?V.near(X):new ee(X)}content(){return new d.p2(d.HY.from(this.node),0,0)}eq(M){return M instanceof ee&&M.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new j(this.anchor)}static fromJSON(M,D){if("number"!=typeof D.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ee(M.resolve(D.anchor))}static create(M,D){return new ee(M.resolve(D))}static isSelectable(M){return!M.isText&&!1!==M.type.spec.selectable}}ee.prototype.visible=!1,V.jsonID("node",ee);class j{constructor(M){this.anchor=M}map(M){let{deleted:D,pos:N}=M.mapResult(this.anchor);return D?new I(N,N):new j(N)}resolve(M){let D=M.resolve(this.anchor),N=D.nodeAfter;return N&&ee.isSelectable(N)?new ee(D):V.near(D)}}class W extends V{constructor(M){super(M.resolve(0),M.resolve(M.content.size))}replace(M,D=d.p2.empty){if(D==d.p2.empty){M.delete(0,M.doc.content.size);let N=V.atStart(M.doc);N.eq(M.selection)||M.setSelection(N)}else super.replace(M,D)}toJSON(){return{type:"all"}}static fromJSON(M){return new W(M)}map(M){return new W(M)}eq(M){return M instanceof W}getBookmark(){return oe}}V.jsonID("all",W);const oe={map(){return this},resolve:G=>new W(G)};function Y(G,M,D,N,K,X=!1){if(M.inlineContent)return v.create(G,D);for(let me=N-(K>0?0:1);K>0?me<M.childCount:me>=0;me+=K){let ke=M.child(me);if(ke.isAtom){if(!X&&ee.isSelectable(ke))return ee.create(G,D-(K<0?ke.nodeSize:0))}else{let _e=Y(G,ke,D+K,K<0?ke.childCount:0,K,X);if(_e)return _e}D+=ke.nodeSize*K}return null}function le(G,M,D){let N=G.steps.length-1;if(N<M)return;let me,K=G.steps[N];(K instanceof q.Pu||K instanceof q.FC)&&(G.mapping.maps[N].forEach((ke,_e,ve,De)=>{null==me&&(me=De)}),G.setSelection(V.near(G.doc.resolve(me),D)))}class Z extends q.wx{constructor(M){super(M.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=M.selection,this.storedMarks=M.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(M){if(M.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=M,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(M){return this.storedMarks=M,this.updated|=2,this}ensureMarks(M){return d.vc.sameSet(this.storedMarks||this.selection.$from.marks(),M)||this.setStoredMarks(M),this}addStoredMark(M){return this.ensureMarks(M.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(M){return this.ensureMarks(M.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(M,D){super.addStep(M,D),this.updated=-3&this.updated,this.storedMarks=null}setTime(M){return this.time=M,this}replaceSelection(M){return this.selection.replace(this,M),this}replaceSelectionWith(M,D=!0){let N=this.selection;return D&&(M=M.mark(this.storedMarks||(N.empty?N.$from.marks():N.$from.marksAcross(N.$to)||d.vc.none))),N.replaceWith(this,M),this}deleteSelection(){return this.selection.replace(this),this}insertText(M,D,N){let K=this.doc.type.schema;if(null==D)return M?this.replaceSelectionWith(K.text(M),!0):this.deleteSelection();{if(null==N&&(N=D),N=null==N?D:N,!M)return this.deleteRange(D,N);let X=this.storedMarks;if(!X){let me=this.doc.resolve(D);X=N==D?me.marks():me.marksAcross(this.doc.resolve(N))}return this.replaceRangeWith(D,N,K.text(M,X)),this.selection.empty||this.setSelection(V.near(this.selection.$to)),this}}setMeta(M,D){return this.meta["string"==typeof M?M:M.key]=D,this}getMeta(M){return this.meta["string"==typeof M?M:M.key]}get isGeneric(){for(let M in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function fe(G,M){return M&&G?G.bind(M):G}class xe{constructor(M,D,N){this.name=M,this.init=fe(D.init,N),this.apply=fe(D.apply,N)}}const Oe=[new xe("doc",{init:G=>G.doc||G.schema.topNodeType.createAndFill(),apply:G=>G.doc}),new xe("selection",{init:(G,M)=>G.selection||V.atStart(M.doc),apply:G=>G.selection}),new xe("storedMarks",{init:G=>G.storedMarks||null,apply:(G,M,D,N)=>N.selection.$cursor?G.storedMarks:null}),new xe("scrollToSelection",{init:()=>0,apply:(G,M)=>G.scrolledIntoView?M+1:M})];class Ie{constructor(M,D){this.schema=M,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Oe.slice(),D&&D.forEach(N=>{if(this.pluginsByKey[N.key])throw new RangeError("Adding different instances of a keyed plugin ("+N.key+")");this.plugins.push(N),this.pluginsByKey[N.key]=N,N.spec.state&&this.fields.push(new xe(N.key,N.spec.state,N))})}}class Te{constructor(M){this.config=M}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(M){return this.applyTransaction(M).state}filterTransaction(M,D=-1){for(let N=0;N<this.config.plugins.length;N++)if(N!=D){let K=this.config.plugins[N];if(K.spec.filterTransaction&&!K.spec.filterTransaction.call(K,M,this))return!1}return!0}applyTransaction(M){if(!this.filterTransaction(M))return{state:this,transactions:[]};let D=[M],N=this.applyInner(M),K=null;for(;;){let X=!1;for(let me=0;me<this.config.plugins.length;me++){let ke=this.config.plugins[me];if(ke.spec.appendTransaction){let _e=K?K[me].n:0,ve=K?K[me].state:this,De=_e<D.length&&ke.spec.appendTransaction.call(ke,_e?D.slice(_e):D,ve,N);if(De&&N.filterTransaction(De,me)){if(De.setMeta("appendedTransaction",M),!K){K=[];for(let Ue=0;Ue<this.config.plugins.length;Ue++)K.push(Ue<me?{state:N,n:D.length}:{state:this,n:0})}D.push(De),N=N.applyInner(De),X=!0}K&&(K[me]={state:N,n:D.length})}}if(!X)return{state:N,transactions:D}}}applyInner(M){if(!M.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let D=new Te(this.config),N=this.config.fields;for(let K=0;K<N.length;K++){let X=N[K];D[X.name]=X.apply(M,this[X.name],this,D)}return D}get tr(){return new Z(this)}static create(M){let D=new Ie(M.doc?M.doc.type.schema:M.schema,M.plugins),N=new Te(D);for(let K=0;K<D.fields.length;K++)N[D.fields[K].name]=D.fields[K].init(M,N);return N}reconfigure(M){let D=new Ie(this.schema,M.plugins),N=D.fields,K=new Te(D);for(let X=0;X<N.length;X++){let me=N[X].name;K[me]=this.hasOwnProperty(me)?this[me]:N[X].init(M,K)}return K}toJSON(M){let D={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(D.storedMarks=this.storedMarks.map(N=>N.toJSON())),M&&"object"==typeof M)for(let N in M){if("doc"==N||"selection"==N)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let K=M[N],X=K.spec.state;X&&X.toJSON&&(D[N]=X.toJSON.call(K,this[K.key]))}return D}static fromJSON(M,D,N){if(!D)throw new RangeError("Invalid input for EditorState.fromJSON");if(!M.schema)throw new RangeError("Required config field 'schema' missing");let K=new Ie(M.schema,M.plugins),X=new Te(K);return K.fields.forEach(me=>{if("doc"==me.name)X.doc=d.NB.fromJSON(M.schema,D.doc);else if("selection"==me.name)X.selection=V.fromJSON(X.doc,D.selection);else if("storedMarks"==me.name)D.storedMarks&&(X.storedMarks=D.storedMarks.map(M.schema.markFromJSON));else{if(N)for(let ke in N){let _e=N[ke],ve=_e.spec.state;if(_e.key==me.name&&ve&&ve.fromJSON&&Object.prototype.hasOwnProperty.call(D,ke))return void(X[me.name]=ve.fromJSON.call(_e,M,D[ke],X))}X[me.name]=me.init(M,X)}}),X}}function de(G,M,D){for(let N in G){let K=G[N];K instanceof Function?K=K.bind(M):"handleDOMEvents"==N&&(K=de(K,M,{})),D[N]=K}return D}class te{constructor(M){this.spec=M,this.props={},M.props&&de(M.props,this,this.props),this.key=M.key?M.key.key:Me("plugin")}getState(M){return M[this.key]}}const pe=Object.create(null);function Me(G){return G in pe?G+"$"+ ++pe[G]:(pe[G]=0,G+"$")}class Se{constructor(M="key"){this.key=Me(M)}get(M){return M.config.pluginsByKey[this.key]}getState(M){return M[this.key]}}},3060:(be,ue,P)=>{P.d(ue,{Ax:()=>ke,FC:()=>xe,GJ:()=>Ue,Mn:()=>ve,Pu:()=>fe,dR:()=>dt,k9:()=>pe,nd:()=>Se,nj:()=>nt,vs:()=>oe,wx:()=>He});var d=P(8197);const ne=Math.pow(2,16);function V(_,h){return _+h*ne}function w(_){return 65535&_}class j{constructor(h,p,y){this.pos=h,this.delInfo=p,this.recover=y}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class W{constructor(h,p=!1){if(this.ranges=h,this.inverted=p,!h.length&&W.empty)return W.empty}recover(h){let p=0,y=w(h);if(!this.inverted)for(let k=0;k<y;k++)p+=this.ranges[3*k+2]-this.ranges[3*k+1];return this.ranges[3*y]+p+function H(_){return(_-(65535&_))/ne}(h)}mapResult(h,p=1){return this._map(h,p,!1)}map(h,p=1){return this._map(h,p,!0)}_map(h,p,y){let k=0,b=this.inverted?2:1,T=this.inverted?1:2;for(let B=0;B<this.ranges.length;B+=3){let U=this.ranges[B]-(this.inverted?k:0);if(U>h)break;let Q=this.ranges[B+b],ie=this.ranges[B+T],ce=U+Q;if(h<=ce){let i=U+k+((Q?h==U?-1:h==ce?1:p:p)<0?0:ie);if(y)return i;let s=h==(p<0?U:ce)?null:V(B/3,h-U),a=h==U?2:h==ce?1:4;return(p<0?h!=U:h!=ce)&&(a|=8),new j(i,a,s)}k+=ie-Q}return y?h+k:new j(h+k,0,null)}touches(h,p){let y=0,k=w(p),b=this.inverted?2:1,T=this.inverted?1:2;for(let B=0;B<this.ranges.length;B+=3){let U=this.ranges[B]-(this.inverted?y:0);if(U>h)break;let Q=this.ranges[B+b];if(h<=U+Q&&B==3*k)return!0;y+=this.ranges[B+T]-Q}return!1}forEach(h){let p=this.inverted?2:1,y=this.inverted?1:2;for(let k=0,b=0;k<this.ranges.length;k+=3){let T=this.ranges[k],B=T-(this.inverted?b:0),U=T+(this.inverted?0:b),Q=this.ranges[k+p],ie=this.ranges[k+y];h(B,B+Q,U,U+ie),b+=ie-Q}}invert(){return new W(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(h){return 0==h?W.empty:new W(h<0?[0,-h,0]:[0,0,h])}}W.empty=new W([]);class oe{constructor(h=[],p,y=0,k=h.length){this.maps=h,this.mirror=p,this.from=y,this.to=k}slice(h=0,p=this.maps.length){return new oe(this.maps,this.mirror,h,p)}copy(){return new oe(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(h,p){this.to=this.maps.push(h),null!=p&&this.setMirror(this.maps.length-1,p)}appendMapping(h){for(let p=0,y=this.maps.length;p<h.maps.length;p++){let k=h.getMirror(p);this.appendMap(h.maps[p],null!=k&&k<p?y+k:void 0)}}getMirror(h){if(this.mirror)for(let p=0;p<this.mirror.length;p++)if(this.mirror[p]==h)return this.mirror[p+(p%2?-1:1)]}setMirror(h,p){this.mirror||(this.mirror=[]),this.mirror.push(h,p)}appendMappingInverted(h){for(let p=h.maps.length-1,y=this.maps.length+h.maps.length;p>=0;p--){let k=h.getMirror(p);this.appendMap(h.maps[p].invert(),null!=k&&k>p?y-k-1:void 0)}}invert(){let h=new oe;return h.appendMappingInverted(this),h}map(h,p=1){if(this.mirror)return this._map(h,p,!0);for(let y=this.from;y<this.to;y++)h=this.maps[y].map(h,p);return h}mapResult(h,p=1){return this._map(h,p,!1)}_map(h,p,y){let k=0;for(let b=this.from;b<this.to;b++){let B=this.maps[b].mapResult(h,p);if(null!=B.recover){let U=this.getMirror(b);if(null!=U&&U>b&&U<this.to){b=U,h=this.maps[U].recover(B.recover);continue}}k|=B.delInfo,h=B.pos}return y?h:new j(h,k,null)}}const Y=Object.create(null);class le{getMap(){return W.empty}merge(h){return null}static fromJSON(h,p){if(!p||!p.stepType)throw new RangeError("Invalid input for Step.fromJSON");let y=Y[p.stepType];if(!y)throw new RangeError(`No step type ${p.stepType} defined`);return y.fromJSON(h,p)}static jsonID(h,p){if(h in Y)throw new RangeError("Duplicate use of step JSON ID "+h);return Y[h]=p,p.prototype.jsonID=h,p}}class J{constructor(h,p){this.doc=h,this.failed=p}static ok(h){return new J(h,null)}static fail(h){return new J(null,h)}static fromReplace(h,p,y,k){try{return J.ok(h.replace(p,y,k))}catch(b){if(b instanceof d.e4)return J.fail(b.message);throw b}}}function re(_,h,p){let y=[];for(let k=0;k<_.childCount;k++){let b=_.child(k);b.content.size&&(b=b.copy(re(b.content,h,b))),b.isInline&&(b=h(b,p,k)),y.push(b)}return d.HY.fromArray(y)}class ae extends le{constructor(h,p,y){super(),this.from=h,this.to=p,this.mark=y}apply(h){let p=h.slice(this.from,this.to),y=h.resolve(this.from),k=y.node(y.sharedDepth(this.to)),b=new d.p2(re(p.content,(T,B)=>T.isAtom&&B.type.allowsMarkType(this.mark.type)?T.mark(this.mark.addToSet(T.marks)):T,k),p.openStart,p.openEnd);return J.fromReplace(h,this.from,this.to,b)}invert(){return new Z(this.from,this.to,this.mark)}map(h){let p=h.mapResult(this.from,1),y=h.mapResult(this.to,-1);return p.deleted&&y.deleted||p.pos>=y.pos?null:new ae(p.pos,y.pos,this.mark)}merge(h){return h instanceof ae&&h.mark.eq(this.mark)&&this.from<=h.to&&this.to>=h.from?new ae(Math.min(this.from,h.from),Math.max(this.to,h.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(h,p){if("number"!=typeof p.from||"number"!=typeof p.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ae(p.from,p.to,h.markFromJSON(p.mark))}}le.jsonID("addMark",ae);class Z extends le{constructor(h,p,y){super(),this.from=h,this.to=p,this.mark=y}apply(h){let p=h.slice(this.from,this.to),y=new d.p2(re(p.content,k=>k.mark(this.mark.removeFromSet(k.marks)),h),p.openStart,p.openEnd);return J.fromReplace(h,this.from,this.to,y)}invert(){return new ae(this.from,this.to,this.mark)}map(h){let p=h.mapResult(this.from,1),y=h.mapResult(this.to,-1);return p.deleted&&y.deleted||p.pos>=y.pos?null:new Z(p.pos,y.pos,this.mark)}merge(h){return h instanceof Z&&h.mark.eq(this.mark)&&this.from<=h.to&&this.to>=h.from?new Z(Math.min(this.from,h.from),Math.max(this.to,h.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(h,p){if("number"!=typeof p.from||"number"!=typeof p.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Z(p.from,p.to,h.markFromJSON(p.mark))}}le.jsonID("removeMark",Z);class fe extends le{constructor(h,p,y,k=!1){super(),this.from=h,this.to=p,this.slice=y,this.structure=k}apply(h){return this.structure&&Oe(h,this.from,this.to)?J.fail("Structure replace would overwrite content"):J.fromReplace(h,this.from,this.to,this.slice)}getMap(){return new W([this.from,this.to-this.from,this.slice.size])}invert(h){return new fe(this.from,this.from+this.slice.size,h.slice(this.from,this.to))}map(h){let p=h.mapResult(this.from,1),y=h.mapResult(this.to,-1);return p.deletedAcross&&y.deletedAcross?null:new fe(p.pos,Math.max(p.pos,y.pos),this.slice)}merge(h){if(!(h instanceof fe)||h.structure||this.structure)return null;if(this.from+this.slice.size!=h.from||this.slice.openEnd||h.slice.openStart){if(h.to!=this.from||this.slice.openStart||h.slice.openEnd)return null;{let p=this.slice.size+h.slice.size==0?d.p2.empty:new d.p2(h.slice.content.append(this.slice.content),h.slice.openStart,this.slice.openEnd);return new fe(h.from,this.to,p,this.structure)}}{let p=this.slice.size+h.slice.size==0?d.p2.empty:new d.p2(this.slice.content.append(h.slice.content),this.slice.openStart,h.slice.openEnd);return new fe(this.from,this.to+(h.to-h.from),p,this.structure)}}toJSON(){let h={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(h.slice=this.slice.toJSON()),this.structure&&(h.structure=!0),h}static fromJSON(h,p){if("number"!=typeof p.from||"number"!=typeof p.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new fe(p.from,p.to,d.p2.fromJSON(h,p.slice),!!p.structure)}}le.jsonID("replace",fe);class xe extends le{constructor(h,p,y,k,b,T,B=!1){super(),this.from=h,this.to=p,this.gapFrom=y,this.gapTo=k,this.slice=b,this.insert=T,this.structure=B}apply(h){if(this.structure&&(Oe(h,this.from,this.gapFrom)||Oe(h,this.gapTo,this.to)))return J.fail("Structure gap-replace would overwrite content");let p=h.slice(this.gapFrom,this.gapTo);if(p.openStart||p.openEnd)return J.fail("Gap is not a flat range");let y=this.slice.insertAt(this.insert,p.content);return y?J.fromReplace(h,this.from,this.to,y):J.fail("Content does not fit in gap")}getMap(){return new W([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(h){let p=this.gapTo-this.gapFrom;return new xe(this.from,this.from+this.slice.size+p,this.from+this.insert,this.from+this.insert+p,h.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(h){let p=h.mapResult(this.from,1),y=h.mapResult(this.to,-1),k=h.map(this.gapFrom,-1),b=h.map(this.gapTo,1);return p.deletedAcross&&y.deletedAcross||k<p.pos||b>y.pos?null:new xe(p.pos,y.pos,k,b,this.slice,this.insert,this.structure)}toJSON(){let h={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(h.slice=this.slice.toJSON()),this.structure&&(h.structure=!0),h}static fromJSON(h,p){if("number"!=typeof p.from||"number"!=typeof p.to||"number"!=typeof p.gapFrom||"number"!=typeof p.gapTo||"number"!=typeof p.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new xe(p.from,p.to,p.gapFrom,p.gapTo,d.p2.fromJSON(h,p.slice),p.insert,!!p.structure)}}function Oe(_,h,p){let y=_.resolve(h),k=p-h,b=y.depth;for(;k>0&&b>0&&y.indexAfter(b)==y.node(b).childCount;)b--,k--;if(k>0){let T=y.node(b).maybeChild(y.indexAfter(b));for(;k>0;){if(!T||T.isLeaf)return!0;T=T.firstChild,k--}}return!1}function te(_,h,p){return(0==h||_.canReplace(h,_.childCount))&&(p==_.childCount||_.canReplace(0,p))}function pe(_){let p=_.parent.content.cutByIndex(_.startIndex,_.endIndex);for(let y=_.depth;;--y){let k=_.$from.node(y),b=_.$from.index(y),T=_.$to.indexAfter(y);if(y<_.depth&&k.canReplace(b,T,p))return y;if(0==y||k.type.spec.isolating||!te(k,b,T))break}return null}function Se(_,h,p=null,y=_){let k=function M(_,h){let{parent:p,startIndex:y,endIndex:k}=_,b=p.contentMatchAt(y).findWrapping(h);return b&&p.canReplaceWith(y,k,b.length?b[0]:h)?b:null}(_,h),b=k&&function D(_,h){let{parent:p,startIndex:y,endIndex:k}=_,b=p.child(y),T=h.contentMatch.findWrapping(b.type);if(!T)return null;let U=(T.length?T[T.length-1]:h).contentMatch;for(let Q=y;U&&Q<k;Q++)U=U.matchType(p.child(Q).type);return U&&U.validEnd?T:null}(y,h);return b?k.map(G).concat({type:h,attrs:p}).concat(b.map(G)):null}function G(_){return{type:_,attrs:null}}function ke(_,h,p=1,y){let k=_.resolve(h),b=k.depth-p,T=y&&y[y.length-1]||k.parent;if(b<0||k.parent.type.spec.isolating||!k.parent.canReplace(k.index(),k.parent.childCount)||!T.type.validContent(k.parent.content.cutByIndex(k.index(),k.parent.childCount)))return!1;for(let Q=k.depth-1,ie=p-2;Q>b;Q--,ie--){let ce=k.node(Q),x=k.index(Q);if(ce.type.spec.isolating)return!1;let i=ce.content.cutByIndex(x,ce.childCount),s=y&&y[ie]||ce;if(s!=ce&&(i=i.replaceChild(0,s.type.create(s.attrs))),!ce.canReplace(x+1,ce.childCount)||!s.type.validContent(i))return!1}let B=k.indexAfter(b),U=y&&y[0];return k.node(b).canReplaceWith(B,B,U?U.type:k.node(b+1).type)}function ve(_,h){let p=_.resolve(h),y=p.index();return De(p.nodeBefore,p.nodeAfter)&&p.parent.canReplace(y,y+1)}function De(_,h){return!(!_||!h||_.isLeaf||!_.canAppend(h))}function Ue(_,h,p=-1){let y=_.resolve(h);for(let k=y.depth;;k--){let b,T,B=y.index(k);if(k==y.depth?(b=y.nodeBefore,T=y.nodeAfter):p>0?(b=y.node(k+1),B++,T=y.node(k).maybeChild(B)):(b=y.node(k).maybeChild(B-1),T=y.node(k+1)),b&&!b.isTextblock&&De(b,T)&&y.node(k).canReplace(B,B+1))return h;if(0==k)break;h=p<0?y.before(k):y.after(k)}}function nt(_,h,p){let y=_.resolve(h);if(!p.content.size)return h;let k=p.content;for(let b=0;b<p.openStart;b++)k=k.firstChild.content;for(let b=1;b<=(0==p.openStart&&p.size?2:1);b++)for(let T=y.depth;T>=0;T--){let B=T==y.depth?0:y.pos<=(y.start(T+1)+y.end(T+1))/2?-1:1,U=y.index(T)+(B>0?1:0),Q=y.node(T),ie=!1;if(1==b)ie=Q.canReplace(U,U,k);else{let ce=Q.contentMatchAt(U).findWrapping(k.firstChild.type);ie=ce&&Q.canReplaceWith(U,U,ce[0])}if(ie)return 0==B?y.pos:B<0?y.before(T+1):y.after(T+1)}return null}function dt(_,h,p=h,y=d.p2.empty){if(h==p&&!y.size)return null;let k=_.resolve(h),b=_.resolve(p);return Ge(k,b,y)?new fe(h,p,y):new ut(k,b,y).fit()}function Ge(_,h,p){return!p.openStart&&!p.openEnd&&_.start()==h.start()&&_.parent.canReplace(_.index(),h.index(),p.content)}le.jsonID("replaceAround",xe);class ut{constructor(h,p,y){this.$from=h,this.$to=p,this.unplaced=y,this.frontier=[],this.placed=d.HY.empty;for(let k=0;k<=h.depth;k++){let b=h.node(k);this.frontier.push({type:b.type,match:b.contentMatchAt(h.indexAfter(k))})}for(let k=h.depth;k>0;k--)this.placed=d.HY.from(h.node(k).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let Q=this.findFittable();Q?this.placeNodes(Q):this.openMore()||this.dropNode()}let h=this.mustMoveInline(),p=this.placed.size-this.depth-this.$from.depth,y=this.$from,k=this.close(h<0?this.$to:y.doc.resolve(h));if(!k)return null;let b=this.placed,T=y.depth,B=k.depth;for(;T&&B&&1==b.childCount;)b=b.firstChild.content,T--,B--;let U=new d.p2(b,T,B);return h>-1?new xe(y.pos,h,this.$to.pos,this.$to.end(),U,p):U.size||y.pos!=this.$to.pos?new fe(y.pos,k.pos,U):null}findFittable(){for(let h=1;h<=2;h++)for(let p=this.unplaced.openStart;p>=0;p--){let y,k=null;p?(k=Ve(this.unplaced.content,p-1).firstChild,y=k.content):y=this.unplaced.content;let b=y.firstChild;for(let T=this.depth;T>=0;T--){let Q,{type:B,match:U}=this.frontier[T],ie=null;if(1==h&&(b?U.matchType(b.type)||(ie=U.fillBefore(d.HY.from(b),!1)):k&&B.compatibleContent(k.type)))return{sliceDepth:p,frontierDepth:T,parent:k,inject:ie};if(2==h&&b&&(Q=U.findWrapping(b.type)))return{sliceDepth:p,frontierDepth:T,parent:k,wrap:Q};if(k&&U.matchType(k.type))break}}}openMore(){let{content:h,openStart:p,openEnd:y}=this.unplaced,k=Ve(h,p);return!(!k.childCount||k.firstChild.isLeaf||(this.unplaced=new d.p2(h,p+1,Math.max(y,k.size+p>=h.size-y?p+1:0)),0))}dropNode(){let{content:h,openStart:p,openEnd:y}=this.unplaced,k=Ve(h,p);if(k.childCount<=1&&p>0){let b=h.size-p<=p+k.size;this.unplaced=new d.p2(Ke(h,p-1,1),p-1,b?p-1:y)}else this.unplaced=new d.p2(Ke(h,p,1),p,y)}placeNodes({sliceDepth:h,frontierDepth:p,parent:y,inject:k,wrap:b}){for(;this.depth>p;)this.closeFrontierNode();if(b)for(let a=0;a<b.length;a++)this.openFrontierNode(b[a]);let T=this.unplaced,B=y?y.content:T.content,U=T.openStart-h,Q=0,ie=[],{match:ce,type:x}=this.frontier[p];if(k){for(let a=0;a<k.childCount;a++)ie.push(k.child(a));ce=ce.matchFragment(k)}let i=B.size+h-(T.content.size-T.openEnd);for(;Q<B.childCount;){let a=B.child(Q),f=ce.matchType(a.type);if(!f)break;Q++,(Q>1||0==U||a.content.size)&&(ce=f,ie.push(ft(a.mark(x.allowedMarks(a.marks)),1==Q?U:0,Q==B.childCount?i:-1)))}let s=Q==B.childCount;s||(i=-1),this.placed=Ze(this.placed,p,d.HY.from(ie)),this.frontier[p].match=ce,s&&i<0&&y&&y.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let a=0,f=B;a<i;a++){let m=f.lastChild;this.frontier.push({type:m.type,match:m.contentMatchAt(m.childCount)}),f=m.content}this.unplaced=s?0==h?d.p2.empty:new d.p2(Ke(T.content,h-1,1),h-1,i<0?T.openEnd:h-1):new d.p2(Ke(T.content,h,Q),T.openStart,T.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let p,h=this.frontier[this.depth];if(!h.type.isTextblock||!Ne(this.$to,this.$to.depth,h.type,h.match,!1)||this.$to.depth==this.depth&&(p=this.findCloseLevel(this.$to))&&p.depth==this.depth)return-1;let{depth:y}=this.$to,k=this.$to.after(y);for(;y>1&&k==this.$to.end(--y);)++k;return k}findCloseLevel(h){e:for(let p=Math.min(this.depth,h.depth);p>=0;p--){let{match:y,type:k}=this.frontier[p],b=p<h.depth&&h.end(p+1)==h.pos+(h.depth-(p+1)),T=Ne(h,p,k,y,b);if(T){for(let B=p-1;B>=0;B--){let{match:U,type:Q}=this.frontier[B],ie=Ne(h,B,Q,U,!0);if(!ie||ie.childCount)continue e}return{depth:p,fit:T,move:b?h.doc.resolve(h.after(p+1)):h}}}}close(h){let p=this.findCloseLevel(h);if(!p)return null;for(;this.depth>p.depth;)this.closeFrontierNode();p.fit.childCount&&(this.placed=Ze(this.placed,p.depth,p.fit)),h=p.move;for(let y=p.depth+1;y<=h.depth;y++){let k=h.node(y),b=k.type.contentMatch.fillBefore(k.content,!0,h.index(y));this.openFrontierNode(k.type,k.attrs,b)}return h}openFrontierNode(h,p=null,y){let k=this.frontier[this.depth];k.match=k.match.matchType(h),this.placed=Ze(this.placed,this.depth,d.HY.from(h.create(p,y))),this.frontier.push({type:h,match:h.contentMatch})}closeFrontierNode(){let p=this.frontier.pop().match.fillBefore(d.HY.empty,!0);p.childCount&&(this.placed=Ze(this.placed,this.frontier.length,p))}}function Ke(_,h,p){return 0==h?_.cutByIndex(p,_.childCount):_.replaceChild(0,_.firstChild.copy(Ke(_.firstChild.content,h-1,p)))}function Ze(_,h,p){return 0==h?_.append(p):_.replaceChild(_.childCount-1,_.lastChild.copy(Ze(_.lastChild.content,h-1,p)))}function Ve(_,h){for(let p=0;p<h;p++)_=_.firstChild.content;return _}function ft(_,h,p){if(h<=0)return _;let y=_.content;return h>1&&(y=y.replaceChild(0,ft(y.firstChild,h-1,1==y.childCount?p-1:0))),h>0&&(y=_.type.contentMatch.fillBefore(y).append(y),p<=0&&(y=y.append(_.type.contentMatch.matchFragment(y).fillBefore(d.HY.empty,!0)))),_.copy(y)}function Ne(_,h,p,y,k){let b=_.node(h),T=k?_.indexAfter(h):_.index(h);if(T==b.childCount&&!p.compatibleContent(b.type))return null;let B=y.fillBefore(b.content,!0,T);return B&&!function Mt(_,h,p){for(let y=p;y<h.childCount;y++)if(!_.allowsMarks(h.child(y).marks))return!0;return!1}(p,b.content,T)?B:null}function it(_){return _.spec.defining||_.spec.definingForContent}function $e(_,h,p,y,k){if(h<p){let b=_.firstChild;_=_.replaceChild(0,b.copy($e(b.content,h+1,p,y,b)))}if(h>y){let b=k.contentMatchAt(0),T=b.fillBefore(_).append(_);_=T.append(b.matchFragment(T).fillBefore(d.HY.empty,!0))}return _}function Ye(_,h){let p=[];for(let k=Math.min(_.depth,h.depth);k>=0;k--){let b=_.start(k);if(b<_.pos-(_.depth-k)||h.end(k)>h.pos+(h.depth-k)||_.node(k).type.spec.isolating||h.node(k).type.spec.isolating)break;(b==h.start(k)||k==_.depth&&k==h.depth&&_.parent.inlineContent&&h.parent.inlineContent&&k&&h.start(k-1)==b-1)&&p.push(k)}return p}let ze=class extends Error{};ze=function _(h){let p=Error.call(this,h);return p.__proto__=_.prototype,p},(ze.prototype=Object.create(Error.prototype)).constructor=ze,ze.prototype.name="TransformError";class He{constructor(h){this.doc=h,this.steps=[],this.docs=[],this.mapping=new oe}get before(){return this.docs.length?this.docs[0]:this.doc}step(h){let p=this.maybeStep(h);if(p.failed)throw new ze(p.failed);return this}maybeStep(h){let p=h.apply(this.doc);return p.failed||this.addStep(h,p.doc),p}get docChanged(){return this.steps.length>0}addStep(h,p){this.docs.push(this.doc),this.steps.push(h),this.mapping.appendMap(h.getMap()),this.doc=p}replace(h,p=h,y=d.p2.empty){let k=dt(this.doc,h,p,y);return k&&this.step(k),this}replaceWith(h,p,y){return this.replace(h,p,new d.p2(d.HY.from(y),0,0))}delete(h,p){return this.replace(h,p,d.p2.empty)}insert(h,p){return this.replaceWith(h,h,p)}replaceRange(h,p,y){return function Le(_,h,p,y){if(!y.size)return _.deleteRange(h,p);let k=_.doc.resolve(h),b=_.doc.resolve(p);if(Ge(k,b,y))return _.step(new fe(h,p,y));let T=Ye(k,_.doc.resolve(p));0==T[T.length-1]&&T.pop();let B=-(k.depth+1);T.unshift(B);for(let x=k.depth,i=k.pos-1;x>0;x--,i--){let s=k.node(x).type.spec;if(s.defining||s.definingAsContext||s.isolating)break;T.indexOf(x)>-1?B=x:k.before(x)==i&&T.splice(1,0,-x)}let U=T.indexOf(B),Q=[],ie=y.openStart;for(let x=y.content,i=0;;i++){let s=x.firstChild;if(Q.push(s),i==y.openStart)break;x=s.content}for(let x=ie-1;x>=0;x--){let i=Q[x].type,s=it(i);if(s&&k.node(U).type!=i)ie=x;else if(s||!i.isTextblock)break}for(let x=y.openStart;x>=0;x--){let i=(x+ie+1)%(y.openStart+1),s=Q[i];if(s)for(let a=0;a<T.length;a++){let f=T[(a+U)%T.length],m=!0;f<0&&(m=!1,f=-f);let C=k.node(f-1),E=k.index(f-1);if(C.canReplaceWith(E,E,s.type,s.marks))return _.replace(k.before(f),m?b.after(f):p,new d.p2($e(y.content,0,y.openStart,i),i,y.openEnd))}}let ce=_.steps.length;for(let x=T.length-1;x>=0&&(_.replace(h,p,y),!(_.steps.length>ce));x--){let i=T[x];i<0||(h=k.before(i),p=b.after(i))}}(this,h,p,y),this}replaceRangeWith(h,p,y){return function pt(_,h,p,y){if(!y.isInline&&h==p&&_.doc.resolve(h).parent.content.size){let k=function ht(_,h,p){let y=_.resolve(h);if(y.parent.canReplaceWith(y.index(),y.index(),p))return h;if(0==y.parentOffset)for(let k=y.depth-1;k>=0;k--){let b=y.index(k);if(y.node(k).canReplaceWith(b,b,p))return y.before(k+1);if(b>0)return null}if(y.parentOffset==y.parent.content.size)for(let k=y.depth-1;k>=0;k--){let b=y.indexAfter(k);if(y.node(k).canReplaceWith(b,b,p))return y.after(k+1);if(b<y.node(k).childCount)return null}return null}(_.doc,h,y.type);null!=k&&(h=p=k)}_.replaceRange(h,p,new d.p2(d.HY.from(y),0,0))}(this,h,p,y),this}deleteRange(h,p){return function mt(_,h,p){let y=_.doc.resolve(h),k=_.doc.resolve(p),b=Ye(y,k);for(let T=0;T<b.length;T++){let B=b[T],U=T==b.length-1;if(U&&0==B||y.node(B).type.contentMatch.validEnd)return _.delete(y.start(B),k.end(B));if(B>0&&(U||y.node(B-1).canReplace(y.index(B-1),k.indexAfter(B-1))))return _.delete(y.before(B),k.after(B))}for(let T=1;T<=y.depth&&T<=k.depth;T++)if(h-y.start(T)==y.depth-T&&p>y.end(T)&&k.end(T)-p!=k.depth-T)return _.delete(y.before(T),p);_.delete(h,p)}(this,h,p),this}lift(h,p){return function Me(_,h,p){let{$from:y,$to:k,depth:b}=h,T=y.before(b+1),B=k.after(b+1),U=T,Q=B,ie=d.HY.empty,ce=0;for(let s=b,a=!1;s>p;s--)a||y.index(s)>0?(a=!0,ie=d.HY.from(y.node(s).copy(ie)),ce++):U--;let x=d.HY.empty,i=0;for(let s=b,a=!1;s>p;s--)a||k.after(s+1)<k.end(s)?(a=!0,x=d.HY.from(k.node(s).copy(x)),i++):Q++;_.step(new xe(U,Q,T,B,new d.p2(ie.append(x),ce,i),ie.size-ce,!0))}(this,h,p),this}join(h,p=1){return function Je(_,h,p){let y=new fe(h-p,h+p,d.p2.empty,!0);_.step(y)}(this,h,p),this}wrap(h,p){return function N(_,h,p){let y=d.HY.empty;for(let T=p.length-1;T>=0;T--){if(y.size){let B=p[T].type.contentMatch.matchFragment(y);if(!B||!B.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}y=d.HY.from(p[T].type.create(p[T].attrs,y))}let k=h.start,b=h.end;_.step(new xe(k,b,k,b,new d.p2(y,0,0),p.length,!0))}(this,h,p),this}setBlockType(h,p=h,y,k=null){return function K(_,h,p,y,k){if(!y.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let b=_.steps.length;_.doc.nodesBetween(h,p,(T,B)=>{if(T.isTextblock&&!T.hasMarkup(y,k)&&function X(_,h,p){let y=_.resolve(h),k=y.index();return y.parent.canReplaceWith(k,k+1,p)}(_.doc,_.mapping.slice(b).map(B),y)){_.clearIncompatible(_.mapping.slice(b).map(B,1),y);let U=_.mapping.slice(b),Q=U.map(B,1),ie=U.map(B+T.nodeSize,1);return _.step(new xe(Q,ie,Q+1,ie-1,new d.p2(d.HY.from(y.create(k,null,T.marks)),0,0),1,!0)),!1}})}(this,h,p,y,k),this}setNodeMarkup(h,p,y=null,k=[]){return function me(_,h,p,y,k){let b=_.doc.nodeAt(h);if(!b)throw new RangeError("No node at given position");p||(p=b.type);let T=p.create(y,null,k||b.marks);if(b.isLeaf)return _.replaceWith(h,h+b.nodeSize,T);if(!p.validContent(b.content))throw new RangeError("Invalid content for node type "+p.name);_.step(new xe(h,h+b.nodeSize,h+1,h+b.nodeSize-1,new d.p2(d.HY.from(T),0,0),1,!0))}(this,h,p,y,k),this}split(h,p=1,y){return function _e(_,h,p=1,y){let k=_.doc.resolve(h),b=d.HY.empty,T=d.HY.empty;for(let B=k.depth,U=k.depth-p,Q=p-1;B>U;B--,Q--){b=d.HY.from(k.node(B).copy(b));let ie=y&&y[Q];T=d.HY.from(ie?ie.type.create(ie.attrs,T):k.node(B).copy(T))}_.step(new fe(h,h,new d.p2(b.append(T),p,p),!0))}(this,h,p,y),this}addMark(h,p,y){return function Ie(_,h,p,y){let T,B,k=[],b=[];_.doc.nodesBetween(h,p,(U,Q,ie)=>{if(!U.isInline)return;let ce=U.marks;if(!y.isInSet(ce)&&ie.type.allowsMarkType(y.type)){let x=Math.max(Q,h),i=Math.min(Q+U.nodeSize,p),s=y.addToSet(ce);for(let a=0;a<ce.length;a++)ce[a].isInSet(s)||(T&&T.to==x&&T.mark.eq(ce[a])?T.to=i:k.push(T=new Z(x,i,ce[a])));B&&B.to==x?B.to=i:b.push(B=new ae(x,i,y))}}),k.forEach(U=>_.step(U)),b.forEach(U=>_.step(U))}(this,h,p,y),this}removeMark(h,p,y){return function Te(_,h,p,y){let k=[],b=0;_.doc.nodesBetween(h,p,(T,B)=>{if(!T.isInline)return;b++;let U=null;if(y instanceof d.ZU){let ie,Q=T.marks;for(;ie=y.isInSet(Q);)(U||(U=[])).push(ie),Q=ie.removeFromSet(Q)}else y?y.isInSet(T.marks)&&(U=[y]):U=T.marks;if(U&&U.length){let Q=Math.min(B+T.nodeSize,p);for(let ie=0;ie<U.length;ie++){let x,ce=U[ie];for(let i=0;i<k.length;i++){let s=k[i];s.step==b-1&&ce.eq(k[i].style)&&(x=s)}x?(x.to=Q,x.step=b):k.push({style:ce,from:Math.max(B,h),to:Q,step:b})}}}),k.forEach(T=>_.step(new Z(T.from,T.to,T.style)))}(this,h,p,y),this}clearIncompatible(h,p,y){return function de(_,h,p,y=p.contentMatch){let k=_.doc.nodeAt(h),b=[],T=h+1;for(let B=0;B<k.childCount;B++){let U=k.child(B),Q=T+U.nodeSize,ie=y.matchType(U.type);if(ie){y=ie;for(let ce=0;ce<U.marks.length;ce++)p.allowsMarkType(U.marks[ce].type)||_.step(new Z(T,Q,U.marks[ce]))}else b.push(new fe(T,Q,d.p2.empty));T=Q}if(!y.validEnd){let B=y.fillBefore(d.HY.empty,!0);_.replace(T,T,new d.p2(B,0,0))}for(let B=b.length-1;B>=0;B--)_.step(b[B])}(this,h,p,y),this}}},412:(be,ue,P)=>{P.d(ue,{EH:()=>we,p:()=>Fe,tk:()=>vi});var d=P(6956),q=P(8197),ne=P(3060);const V="undefined"!=typeof navigator?navigator:null,w="undefined"!=typeof document?document:null,H=V&&V.userAgent||"",F=/Edge\/(\d+)/.exec(H),v=/MSIE \d/.exec(H),I=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(H),ee=!!(v||I||F),j=v?document.documentMode:I?+I[1]:F?+F[1]:0,W=!ee&&/gecko\/(\d+)/i.test(H);W&&/Firefox\/(\d+)/.exec(H);const oe=!ee&&/Chrome\/(\d+)/.exec(H),Y=!!oe,le=oe?+oe[1]:0,J=!ee&&!!V&&/Apple Computer/.test(V.vendor),re=J&&(/Mobile\/\w+/.test(H)||!!V&&V.maxTouchPoints>2),ae=re||!!V&&/Mac/.test(V.platform),Z=/Android \d/.test(H),fe=!!w&&"webkitFontSmoothing"in w.documentElement.style,xe=fe?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,Oe=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},Ie=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let Te=null;const de=function(t,e,n){let r=Te||(Te=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},te=function(t,e,n,r){return n&&(Me(t,e,n,r,-1)||Me(t,e,n,r,1))},pe=/^(img|br|input|textarea|hr)$/i;function Me(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:Se(t))){let l=t.parentNode;if(!l||1!=l.nodeType||M(t)||pe.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Oe(t)+(o<0?0:1),t=l}else{if(1!=t.nodeType)return!1;if("false"==(t=t.childNodes[e+(o<0?-1:0)]).contentEditable)return!1;e=o<0?Se(t):0}}}function Se(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function M(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const D=function(t){let e=t.isCollapsed;return e&&Y&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function N(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function K(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function X(t,e){return"number"==typeof t?t:t[e]}function me(t){let e=t.getBoundingClientRect();return{left:e.left,right:e.left+t.clientWidth*(e.width/t.offsetWidth||1),top:e.top,bottom:e.top+t.clientHeight*(e.height/t.offsetHeight||1)}}function ke(t,e,n){let r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,l=t.dom.ownerDocument;for(let c=n||t.dom;c;c=Ie(c)){if(1!=c.nodeType)continue;let u=c,g=u==l.body,O=g?K(l):me(u),S=0,L=0;if(e.top<O.top+X(r,"top")?L=-(O.top-e.top+X(o,"top")):e.bottom>O.bottom-X(r,"bottom")&&(L=e.bottom-O.bottom+X(o,"bottom")),e.left<O.left+X(r,"left")?S=-(O.left-e.left+X(o,"left")):e.right>O.right-X(r,"right")&&(S=e.right-O.right+X(o,"right")),S||L)if(g)l.defaultView.scrollBy(S,L);else{let z=u.scrollLeft,R=u.scrollTop;L&&(u.scrollTop+=L),S&&(u.scrollLeft+=S);let $=u.scrollLeft-z,ge=u.scrollTop-R;e={left:e.left-$,top:e.top-ge,right:e.right-$,bottom:e.bottom-ge}}if(g)break}}function ve(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Ie(r));return e}function Ue(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:o,left:l}=t[n];r.scrollTop!=o+e&&(r.scrollTop=o+e),r.scrollLeft!=l&&(r.scrollLeft=l)}}let Je=null;function nt(t,e){let n,o,r=2e8,l=0,c=e.top,u=e.top;for(let g=t.firstChild,O=0;g;g=g.nextSibling,O++){let S;if(1==g.nodeType)S=g.getClientRects();else{if(3!=g.nodeType)continue;S=de(g).getClientRects()}for(let L=0;L<S.length;L++){let z=S[L];if(z.top<=c&&z.bottom>=u){c=Math.max(z.bottom,c),u=Math.min(z.top,u);let R=z.left>e.left?z.left-e.left:z.right<e.left?e.left-z.right:0;if(R<r){n=g,r=R,o=R&&3==n.nodeType?{left:z.right<e.left?z.right:z.left,top:e.top}:e,1==g.nodeType&&R&&(l=O+(e.left>=(z.left+z.right)/2?1:0));continue}}!n&&(e.left>=z.right&&e.top>=z.top||e.left>=z.left&&e.top>=z.bottom)&&(l=O+1)}}return n&&3==n.nodeType?function dt(t,e){let n=t.nodeValue.length,r=document.createRange();for(let o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);let l=Ne(r,1);if(l.top!=l.bottom&&Ge(e,l))return{node:t,offset:o+(e.left>=(l.left+l.right)/2?1:0)}}return{node:t,offset:0}}(n,o):!n||r&&1==n.nodeType?{node:t,offset:l}:nt(n,o)}function Ge(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Ve(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),l=o;;){let c=t.childNodes[l];if(1==c.nodeType){let u=c.getClientRects();for(let g=0;g<u.length;g++){let O=u[g];if(Ge(e,O))return Ve(c,e,O)}}if((l=(l+1)%r)==o)break}return t}function ft(t,e){let r,n=t.dom.ownerDocument,o=0;if(n.caretPositionFromPoint)try{let g=n.caretPositionFromPoint(e.left,e.top);g&&({offsetNode:r,offset:o}=g)}catch(g){}if(!r&&n.caretRangeFromPoint){let g=n.caretRangeFromPoint(e.left,e.top);g&&({startContainer:r,startOffset:o}=g)}let c,l=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top);if(!l||!t.dom.contains(1!=l.nodeType?l.parentNode:l)){let g=t.dom.getBoundingClientRect();if(!Ge(e,g)||(l=Ve(t.dom,e,g),!l))return null}if(J)for(let g=l;r&&g;g=Ie(g))g.draggable&&(r=void 0);if(l=function ut(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(l,e),r){if(W&&1==r.nodeType&&(o=Math.min(o,r.childNodes.length),o<r.childNodes.length)){let O,g=r.childNodes[o];"IMG"==g.nodeName&&(O=g.getBoundingClientRect()).right<=e.left&&O.bottom>e.top&&o++}r==t.dom&&o==r.childNodes.length-1&&1==r.lastChild.nodeType&&e.top>r.lastChild.getBoundingClientRect().bottom?c=t.state.doc.content.size:(0==o||1!=r.nodeType||"BR"!=r.childNodes[o-1].nodeName)&&(c=function Ze(t,e,n,r){let o=-1;for(let l=e;l!=t.dom;){let c=t.docView.nearestDesc(l,!0);if(!c)return null;if(c.node.isBlock&&c.parent){let u=c.dom.getBoundingClientRect();if(u.left>r.left||u.top>r.top)o=c.posBefore;else{if(!(u.right<r.left||u.bottom<r.top))break;o=c.posAfter}}l=c.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,1)}(t,r,o,e))}null==c&&(c=function Ke(t,e,n){let{node:r,offset:o}=nt(e,n),l=-1;if(1==r.nodeType&&!r.firstChild){let c=r.getBoundingClientRect();l=c.left!=c.right&&n.left>(c.left+c.right)/2?1:-1}return t.docView.posFromDOM(r,o,l)}(t,l,e));let u=t.docView.nearestDesc(l,!0);return{pos:c,inside:u?u.posAtStart-u.border:-1}}function Ne(t,e){let n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}const Mt=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function it(t,e,n){let{node:r,offset:o,atom:l}=t.docView.domFromPos(e,n<0?-1:1),c=fe||W;if(3==r.nodeType){if(!c||!Mt.test(r.nodeValue)&&(n<0?o:o!=r.nodeValue.length)){let g=o,O=o,S=n<0?1:-1;return n<0&&!o?(O++,S=-1):n>=0&&o==r.nodeValue.length?(g--,S=1):n<0?g--:O++,Le(Ne(de(r,g,O),S),S<0)}{let g=Ne(de(r,o,o),n);if(W&&o&&/\s/.test(r.nodeValue[o-1])&&o<r.nodeValue.length){let O=Ne(de(r,o-1,o-1),-1);if(O.top==g.top){let S=Ne(de(r,o,o+1),-1);if(S.top!=g.top)return Le(S,S.left<O.left)}}return g}}if(!t.state.doc.resolve(e-(l||0)).parent.inlineContent){if(null==l&&o&&(n<0||o==Se(r))){let g=r.childNodes[o-1];if(1==g.nodeType)return $e(g.getBoundingClientRect(),!1)}if(null==l&&o<Se(r)){let g=r.childNodes[o];if(1==g.nodeType)return $e(g.getBoundingClientRect(),!0)}return $e(r.getBoundingClientRect(),n>=0)}if(null==l&&o&&(n<0||o==Se(r))){let g=r.childNodes[o-1],O=3==g.nodeType?de(g,Se(g)-(c?0:1)):1!=g.nodeType||"BR"==g.nodeName&&g.nextSibling?null:g;if(O)return Le(Ne(O,1),!1)}if(null==l&&o<Se(r)){let g=r.childNodes[o];for(;g.pmViewDesc&&g.pmViewDesc.ignoreForCoords;)g=g.nextSibling;let O=g?3==g.nodeType?de(g,0,c?0:1):1==g.nodeType?g:null:null;if(O)return Le(Ne(O,-1),!0)}return Le(Ne(3==r.nodeType?de(r):r,-n),n>=0)}function Le(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function $e(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function pt(t,e,n){let r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}const Ye=/[\u0590-\u08ac]/;let He=null,_=null,h=!1;class B{constructor(e,n,r,o){this.parent=e,this.children=n,this.dom=r,this.contentDOM=o,this.dirty=0,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let o=this.children[n];if(o==e)return r;r+=o.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(r<0){let l,c;if(e==this.contentDOM)l=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;l=e.previousSibling}for(;l&&(!(c=l.pmViewDesc)||c.parent!=this);)l=l.previousSibling;return l?this.posBeforeChild(c)+c.size:this.posAtStart}{let l,c;if(e==this.contentDOM)l=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;l=e.nextSibling}for(;l&&(!(c=l.pmViewDesc)||c.parent!=this);)l=l.nextSibling;return l?this.posBeforeChild(c):this.posAtEnd}}let o;if(e==this.dom&&this.contentDOM)o=n>Oe(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))o=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==n)for(let l=e;;l=l.parentNode){if(l==this.dom){o=!1;break}if(l.previousSibling)break}if(null==o&&n==e.childNodes.length)for(let l=e;;l=l.parentNode){if(l==this.dom){o=!0;break}if(l.nextSibling)break}}return(null==o?r>0:o)?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,o=e;o;o=o.parentNode){let c,l=this.getDesc(o);if(l&&(!n||l.node)){if(!r||!(c=l.nodeDOM)||(1==c.nodeType?c.contains(1==e.nodeType?e:e.parentNode):c==e))return l;r=!1}}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let o=e;o;o=o.parentNode){let l=this.getDesc(o);if(l)return l.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.size;if(r==e&&l!=r){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(e<l)return o.descAt(e-r-o.border);r=l}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let l,r=0,o=0;for(let l=0;r<this.children.length;r++){let c=this.children[r],u=l+c.size;if(u>e||c instanceof s){o=e-l;break}l=u}if(o)return this.children[r].domFromPos(o-this.children[r].border,n);for(;r&&!(l=this.children[r-1]).size&&l instanceof U&&l.side>=0;r--);if(n<=0){let l,c=!0;for(;l=r?this.children[r-1]:null,l&&l.dom.parentNode!=this.contentDOM;r--,c=!1);return l&&n&&c&&!l.border&&!l.domAtom?l.domFromPos(l.size,n):{node:this.contentDOM,offset:l?Oe(l.dom)+1:0}}{let l,c=!0;for(;l=r<this.children.length?this.children[r]:null,l&&l.dom.parentNode!=this.contentDOM;r++,c=!1);return l&&c&&!l.border&&!l.domAtom?l.domFromPos(0,n):{node:this.contentDOM,offset:l?Oe(l.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let o=-1,l=-1;for(let c=r,u=0;;u++){let g=this.children[u],O=c+g.size;if(-1==o&&e<=O){let S=c+g.border;if(e>=S&&n<=O-g.border&&g.node&&g.contentDOM&&this.contentDOM.contains(g.contentDOM))return g.parseRange(e,n,S);e=c;for(let L=u;L>0;L--){let z=this.children[L-1];if(z.size&&z.dom.parentNode==this.contentDOM&&!z.emptyChildAt(1)){o=Oe(z.dom)+1;break}e-=z.size}-1==o&&(o=0)}if(o>-1&&(O>n||u==this.children.length-1)){n=O;for(let S=u+1;S<this.children.length;S++){let L=this.children[S];if(L.size&&L.dom.parentNode==this.contentDOM&&!L.emptyChildAt(-1)){l=Oe(L.dom);break}n+=L.size}-1==l&&(l=this.contentDOM.childNodes.length);break}c=O}return{node:this.contentDOM,from:e,to:n,fromOffset:o,toOffset:l}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return 0==n.size||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,o=!1){let l=Math.min(e,n),c=Math.max(e,n);for(let z=0,R=0;z<this.children.length;z++){let $=this.children[z],ge=R+$.size;if(l>R&&c<ge)return $.setSelection(e-R-$.border,n-R-$.border,r,o);R=ge}let u=this.domFromPos(e,e?-1:1),g=n==e?u:this.domFromPos(n,n?-1:1),O=r.getSelection(),S=!1;if((W||J)&&e==n){let{node:z,offset:R}=u;if(3==z.nodeType){if(S=!(!R||"\n"!=z.nodeValue[R-1]),S&&R==z.nodeValue.length)for(let ge,$=z;$;$=$.parentNode){if(ge=$.nextSibling){"BR"==ge.nodeName&&(u=g={node:ge.parentNode,offset:Oe(ge)+1});break}let Ce=$.pmViewDesc;if(Ce&&Ce.node&&Ce.node.isBlock)break}}else{let $=z.childNodes[R-1];S=$&&("BR"==$.nodeName||"false"==$.contentEditable)}}if(W&&O.focusNode&&O.focusNode!=g.node&&1==O.focusNode.nodeType){let z=O.focusNode.childNodes[O.focusOffset];z&&"false"==z.contentEditable&&(o=!0)}if(!(o||S&&J)&&te(u.node,u.offset,O.anchorNode,O.anchorOffset)&&te(g.node,g.offset,O.focusNode,O.focusOffset))return;let L=!1;if((O.extend||e==n)&&!S){O.collapse(u.node,u.offset);try{e!=n&&O.extend(g.node,g.offset),L=!0}catch(z){if(!(z instanceof DOMException))throw z}}if(!L){if(e>n){let R=u;u=g,g=R}let z=document.createRange();z.setEnd(g.node,g.offset),z.setStart(u.node,u.offset),O.removeAllRanges(),O.addRange(z)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,o=0;o<this.children.length;o++){let l=this.children[o],c=r+l.size;if(r==c?e<=c&&n>=r:e<c&&n>r){let u=r+l.border,g=c-l.border;if(e>=u&&n<=g)return this.dirty=e==r||n==c?2:1,void(e!=u||n!=g||!l.contentLost&&l.dom.parentNode==this.contentDOM?l.markDirty(e-u,n-u):l.dirty=3);l.dirty=l.dom!=l.contentDOM||l.dom.parentNode!=this.contentDOM||l.children.length?3:2}r=c}this.dirty=2}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=1==e?2:1;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class U extends B{constructor(e,n,r,o){let l,c=n.type.toDOM;if("function"==typeof c&&(c=c(r,()=>l?l.parent?l.parent.posBeforeChild(l):void 0:o)),!n.type.spec.raw){if(1!=c.nodeType){let u=document.createElement("span");u.appendChild(c),c=u}c.contentEditable="false",c.classList.add("ProseMirror-widget")}super(e,[],c,null),this.widget=n,this.widget=n,l=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return!!n&&n(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Q extends B{constructor(e,n,r,o){super(e,[],n,null),this.textDOM=r,this.text=o}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class ie extends B{constructor(e,n,r,o){super(e,[],r,o),this.mark=n}static create(e,n,r,o){let l=o.nodeViews[n.type.name],c=l&&l(n,o,r);return(!c||!c.dom)&&(c=q.PW.renderSpec(document,n.type.spec.toDOM(n,r))),new ie(e,n,c.dom,c.contentDOM||c.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),0!=this.dirty){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=0}}slice(e,n,r){let o=ie.create(this.parent,this.mark,!0,r),l=this.children,c=this.size;n<c&&(l=Et(l,n,c,r)),e>0&&(l=Et(l,0,e,r));for(let u=0;u<l.length;u++)l[u].parent=o;return o.children=l,o}}class ce extends B{constructor(e,n,r,o,l,c,u,g,O){super(e,[],l,c),this.node=n,this.outerDeco=r,this.innerDeco=o,this.nodeDOM=u,c&&this.updateChildren(g,O)}static create(e,n,r,o,l,c){let g,u=l.nodeViews[n.type.name],O=u&&u(n,l,()=>g?g.parent?g.parent.posBeforeChild(g):void 0:c,r,o),S=O&&O.dom,L=O&&O.contentDOM;if(n.isText)if(S){if(3!=S.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else S=document.createTextNode(n.text);else S||({dom:S,contentDOM:L}=q.PW.renderSpec(document,n.type.spec.toDOM(n)));!L&&!n.isText&&"BR"!=S.nodeName&&(S.hasAttribute("contenteditable")||(S.contentEditable="false"),n.type.spec.draggable&&(S.draggable=!0));let z=S;return S=he(S,r,n),O?g=new a(e,n,r,o,S,L||null,z,O,l,c+1):n.isText?new i(e,n,r,o,S,z,l):new ce(e,n,r,o,S,L||null,z,l,c+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>q.HY.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,n,r){return 0==this.dirty&&e.eq(this.node)&&Re(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,o=n,l=e.composing?this.localCompositionInfo(e,n):null,c=l&&l.pos>-1?l:null,u=l&&l.pos<0,g=new Ot(this,c&&c.node);(function Bn(t,e,n,r){let o=e.locals(t),l=0;if(0==o.length){for(let O=0;O<t.childCount;O++){let S=t.child(O);r(S,o,e.forChild(l,S),O),l+=S.nodeSize}return}let c=0,u=[],g=null;for(let O=0;;){if(c<o.length&&o[c].to==l){let ge,$=o[c++];for(;c<o.length&&o[c].to==l;)(ge||(ge=[$])).push(o[c++]);if(ge){ge.sort(Rn);for(let Ce=0;Ce<ge.length;Ce++)n(ge[Ce],O,!!g)}else n($,O,!!g)}let S,L;if(g)L=-1,S=g,g=null;else{if(!(O<t.childCount))break;L=O,S=t.child(O++)}for(let $=0;$<u.length;$++)u[$].to<=l&&u.splice($--,1);for(;c<o.length&&o[c].from<=l&&o[c].to>l;)u.push(o[c++]);let z=l+S.nodeSize;if(S.isText){let $=z;c<o.length&&o[c].from<$&&($=o[c].from);for(let ge=0;ge<u.length;ge++)u[ge].to<$&&($=u[ge].to);$<z&&(g=S.cut($-l),S=S.cut(0,$-l),z=$,L=-1)}r(S,S.isInline&&!S.isLeaf?u.filter($=>!$.inline):u.slice(),e.forChild(l,S),L),l=z}})(this.node,this.innerDeco,(O,S,L)=>{O.spec.marks?g.syncToMarks(O.spec.marks,r,e):O.type.side>=0&&!L&&g.syncToMarks(S==this.node.childCount?q.vc.none:this.node.child(S).marks,r,e),g.placeWidget(O,e,o)},(O,S,L,z)=>{let R;g.syncToMarks(O.marks,r,e),g.findNodeMatch(O,S,L,z)||u&&e.state.selection.from>o&&e.state.selection.to<o+O.nodeSize&&(R=g.findIndexWithChild(l.node))>-1&&g.updateNodeAt(O,S,L,R,e)||g.updateNextNode(O,S,L,e,z)||g.addNode(O,S,L,e,o),o+=O.nodeSize}),g.syncToMarks([],r,e),this.node.isTextblock&&g.addTextblockHacks(),g.destroyRest(),(g.changed||2==this.dirty)&&(c&&this.protectLocalComposition(e,c),f(this.contentDOM,this.children,e),re&&function zn(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t),t.style.cssText=e}}(this.dom))}localCompositionInfo(e,n){let{from:r,to:o}=e.state.selection;if(!(e.state.selection instanceof d.Bs)||r<n||o>n+this.node.content.size)return null;let l=e.domSelection(),c=function Ln(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];e=Se(t=t.childNodes[e-1])}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}(l.focusNode,l.focusOffset);if(!c||!this.dom.contains(c.parentNode))return null;if(this.node.inlineContent){let u=c.nodeValue,g=function Fn(t,e,n,r){for(let o=0,l=0;o<t.childCount&&l<=r;){let c=t.child(o++),u=l;if(l+=c.nodeSize,!c.isText)continue;let g=c.text;for(;o<t.childCount;){let O=t.child(o++);if(l+=O.nodeSize,!O.isText)break;g+=O.text}if(l>=n){let O=u<r?g.lastIndexOf(e,r-u-1):-1;if(O>=0&&O+e.length+u>=n)return u+O;if(n==r&&g.length>=r+e.length-u&&g.slice(r-u,r-u+e.length)==e)return r}}return-1}(this.node.content,u,r-n,o-n);return g<0?null:{node:c,pos:g,text:u}}return{node:c,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:o}){if(this.getDesc(n))return;let l=n;for(;l.parentNode!=this.contentDOM;l=l.parentNode){for(;l.previousSibling;)l.parentNode.removeChild(l.previousSibling);for(;l.nextSibling;)l.parentNode.removeChild(l.nextSibling);l.pmViewDesc&&(l.pmViewDesc=void 0)}let c=new Q(this,l,n,o);e.input.compositionNodes.push(c),this.children=Et(this.children,r,r+o.length,e,c)}update(e,n,r,o){return!(3==this.dirty||!e.sameMarkup(this.node)||(this.updateInner(e,n,r,o),0))}updateInner(e,n,r,o){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(o,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(Re(e,this.outerDeco))return;let n=1!=this.nodeDOM.nodeType,r=this.dom;this.dom=A(this.dom,this.nodeDOM,E(this.outerDeco,this.node,n),E(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function x(t,e,n,r,o){return he(r,e,t),new ce(void 0,t,e,n,r,r,r,o,0)}class i extends ce{constructor(e,n,r,o,l,c,u){super(e,n,r,o,l,null,c,u,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,o){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node)||(this.updateOuterDeco(n),(0!=this.dirty||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,o.trackWrites==this.nodeDOM&&(o.trackWrites=null)),this.node=e,this.dirty=0,0))}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,n,r){let o=this.node.cut(e,n),l=document.createTextNode(o.text);return new i(this.parent,o,this.outerDeco,this.innerDeco,l,l,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(0==e||n==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}}class s extends B{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class a extends ce{constructor(e,n,r,o,l,c,u,g,O,S){super(e,n,r,o,l,c,u,O,S),this.spec=g}update(e,n,r,o){if(3==this.dirty)return!1;if(this.spec.update){let l=this.spec.update(e,n,r);return l&&this.updateInner(e,n,r,o),l}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,n,r,o)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r):super.setSelection(e,n,r,o)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function f(t,e,n){let r=t.firstChild,o=!1;for(let l=0;l<e.length;l++){let c=e[l],u=c.dom;if(u.parentNode==t){for(;u!=r;)r=rt(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(u,r);if(c instanceof ie){let g=r?r.previousSibling:t.lastChild;f(c.contentDOM,c.children,n),r=g?g.nextSibling:t.firstChild}}for(;r;)r=rt(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}const m=function(t){t&&(this.nodeName=t)};m.prototype=Object.create(null);const C=[new m];function E(t,e,n){if(0==t.length)return C;let r=n?C[0]:new m,o=[r];for(let l=0;l<t.length;l++){let c=t[l].type.attrs;if(c){c.nodeName&&o.push(r=new m(c.nodeName));for(let u in c){let g=c[u];null!=g&&(n&&1==o.length&&o.push(r=new m(e.isInline?"span":"div")),"class"==u?r.class=(r.class?r.class+" ":"")+g:"style"==u?r.style=(r.style?r.style+";":"")+g:"nodeName"!=u&&(r[u]=g))}}}return o}function A(t,e,n,r){if(n==C&&r==C)return e;let o=e;for(let l=0;l<r.length;l++){let c=r[l],u=n[l];if(l){let g;u&&u.nodeName==c.nodeName&&o!=t&&(g=o.parentNode)&&g.nodeName.toLowerCase()==c.nodeName||(g=document.createElement(c.nodeName),g.pmIsDeco=!0,g.appendChild(o),u=C[0]),o=g}se(o,u||C[0],c)}return o}function se(t,e,n){for(let r in e)"class"!=r&&"style"!=r&&"nodeName"!=r&&!(r in n)&&t.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let l=0;l<r.length;l++)-1==o.indexOf(r[l])&&t.classList.remove(r[l]);for(let l=0;l<o.length;l++)-1==r.indexOf(o[l])&&t.classList.add(o[l]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let o,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;o=r.exec(e.style);)t.style.removeProperty(o[1])}n.style&&(t.style.cssText+=n.style)}}function he(t,e,n){return A(t,t,C,E(e,n,1!=t.nodeType))}function Re(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rt(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Ot{constructor(e,n){this.lock=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function An(t,e){let n=e,r=n.children.length,o=t.childCount,l=new Map,c=[];e:for(;o>0;){let u;for(;;)if(r){let O=n.children[r-1];if(!(O instanceof ie)){u=O,r--;break}n=O,r=O.children.length}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let g=u.node;if(g){if(g!=t.child(o-1))break;--o,l.set(u,o),c.push(u)}}return{index:o,matched:l,matches:c.reverse()}}(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let o=0,l=this.stack.length>>1,c=Math.min(l,e.length);for(;o<c&&(o==l-1?this.top:this.stack[o+1<<1]).matchesMark(e[o])&&!1!==e[o].type.spec.spanning;)o++;for(;o<l;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),l--;for(;l<e.length;){this.stack.push(this.top,this.index+1);let u=-1;for(let g=this.index;g<Math.min(this.index+3,this.top.children.length);g++)if(this.top.children[g].matchesMark(e[l])){u=g;break}if(u>-1)u>this.index&&(this.changed=!0,this.destroyBetween(this.index,u)),this.top=this.top.children[this.index];else{let g=ie.create(this.top,e[l],n,r);this.top.children.splice(this.index,0,g),this.top=g,this.changed=!0}this.index=0,l++}}findNodeMatch(e,n,r,o){let c,l=-1;if(o>=this.preMatch.index&&(c=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&c.matchesNode(e,n,r))l=this.top.children.indexOf(c,this.index);else for(let u=this.index,g=Math.min(this.top.children.length,u+5);u<g;u++){let O=this.top.children[u];if(O.matchesNode(e,n,r)&&!this.preMatch.matched.has(O)){l=u;break}}return!(l<0||(this.destroyBetween(this.index,l),this.index++,0))}updateNodeAt(e,n,r,o,l){let c=this.top.children[o];return 3==c.dirty&&c.dom==c.contentDOM&&(c.dirty=2),!!c.update(e,n,r,l)&&(this.destroyBetween(this.index,o),this.index++,!0)}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r)for(let o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==r)return o;return-1}e=n}}updateNextNode(e,n,r,o,l){for(let c=this.index;c<this.top.children.length;c++){let u=this.top.children[c];if(u instanceof ce){let g=this.preMatch.matched.get(u);if(null!=g&&g!=l)return!1;let O=u.dom;if((!this.lock||!(O==this.lock||1==O.nodeType&&O.contains(this.lock.parentNode))||e.isText&&u.node&&u.node.isText&&u.nodeDOM.nodeValue==e.text&&3!=u.dirty&&Re(n,u.outerDeco))&&u.update(e,n,r,o))return this.destroyBetween(this.index,c),u.dom!=O&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,n,r,o,l){this.top.children.splice(this.index++,0,ce.create(this.top,e,n,r,o,l)),this.changed=!0}placeWidget(e,n,r){let o=this.index<this.top.children.length?this.top.children[this.index]:null;if(!o||!o.matchesWidget(e)||e!=o.widget&&o.widget.type.toDOM.parentNode){let l=new U(this.top,e,n,r);this.top.children.splice(this.index++,0,l),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof ie;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof i)||/\n$/.test(e.node.text))&&((J||Y)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);"IMG"==e&&(r.className="ProseMirror-separator",r.alt=""),"BR"==e&&(r.className="ProseMirror-trailingBreak");let o=new s(this.top,[],r,null);n!=this.top?n.children.push(o):n.children.splice(this.index++,0,o),this.changed=!0}}}function Rn(t,e){return t.type.side-e.type.side}function Et(t,e,n,r,o){let l=[];for(let c=0,u=0;c<t.length;c++){let g=t[c],O=u,S=u+=g.size;O>=n||S<=e?l.push(g):(O<e&&l.push(g.slice(0,e-O,r)),o&&(l.push(o),o=void 0),S>n&&l.push(g.slice(n-O,g.size,r)))}return l}function $t(t,e=null){let n=t.domSelection(),r=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),l=o&&0==o.size,c=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(c<0)return null;let g,O,u=r.resolve(c);if(D(n)){for(g=u;o&&!o.node;)o=o.parent;let S=o.node;if(o&&S.isAtom&&d.qv.isSelectable(S)&&o.parent&&(!S.isInline||!function G(t,e,n){for(let r=0==e,o=e==Se(t);r||o;){if(t==n)return!0;let l=Oe(t);if(!(t=t.parentNode))return!1;r=r&&0==l,o=o&&l==Se(t)}}(n.focusNode,n.focusOffset,o.dom))){let L=o.posBefore;O=new d.qv(c==L?u:r.resolve(L))}}else{let S=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(S<0)return null;g=r.resolve(S)}return O||(O=Nt(t,g,u,"pointer"==e||t.state.selection.head<u.pos&&!l?1:-1)),O}function Yt(t){return t.editable?t.hasFocus():nn(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Qe(t,e=!1){let n=t.state.selection;if(Xt(t,n),Yt(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Y){let r=t.domSelection(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&te(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function Vn(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,Oe(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&ee&&j<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{let l,c,{anchor:r,head:o}=n;Gt&&!(n instanceof d.Bs)&&(n.$from.parent.inlineContent||(l=Qt(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(c=Qt(t,n.to))),t.docView.setSelection(r,o,t.root,e),Gt&&(l&&jt(l),c&&jt(c)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function qn(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Yt(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Gt=J||Y&&le<63;function Qt(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),o=r<n.childNodes.length?n.childNodes[r]:null,l=r?n.childNodes[r-1]:null;if(J&&o&&"false"==o.contentEditable)return vt(o);if(!(o&&"false"!=o.contentEditable||l&&"false"!=l.contentEditable)){if(o)return vt(o);if(l)return vt(l)}}function vt(t){return t.contentEditable="true",J&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function jt(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Xt(t,e){if(e instanceof d.qv){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(en(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else en(t)}function en(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Nt(t,e,n,r){return t.someProp("createSelectionBetween",o=>o(t,e,n))||d.Bs.between(e,n,r)}function tn(t){return(!t.editable||t.root.activeElement==t.dom)&&nn(t)}function nn(t){let e=t.domSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function wt(t,e){let{$anchor:n,$head:r}=t.selection,o=e>0?n.max(r):n.min(r),l=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return l&&d.Y1.findFrom(l,e)}function st(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function rn(t,e,n){let r=t.state.selection;if(!(r instanceof d.Bs)){if(r instanceof d.qv&&r.node.isInline)return st(t,new d.Bs(e>0?r.$to:r.$from));{let o=wt(t.state,e);return!!o&&st(t,o)}}if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let o=wt(t.state,e);return!!(o&&o instanceof d.qv)&&st(t,o)}if(!(ae&&n.indexOf("m")>-1)){let c,o=r.$head,l=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!l||l.isText)return!1;let u=e<0?o.pos-l.nodeSize:o.pos;return!!(l.isAtom||(c=t.docView.descAt(u))&&!c.contentDOM)&&(d.qv.isSelectable(l)?st(t,new d.qv(e<0?t.state.doc.resolve(o.pos-l.nodeSize):o)):!!fe&&st(t,new d.Bs(t.state.doc.resolve(e<0?u:u+l.nodeSize))))}}function St(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function kt(t){let e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function Pt(t){let e=t.domSelection(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,l,c=!1;for(W&&1==n.nodeType&&r<St(n)&&kt(n.childNodes[r])&&(c=!0);;)if(r>0){if(1!=n.nodeType)break;{let u=n.childNodes[r-1];if(kt(u))o=n,l=--r;else{if(3!=u.nodeType)break;n=u,r=n.nodeValue.length}}}else{if(sn(n))break;{let u=n.previousSibling;for(;u&&kt(u);)o=n.parentNode,l=Oe(u),u=u.previousSibling;if(u)n=u,r=St(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}c?At(t,e,n,r):o&&At(t,e,o,l)}function It(t){let e=t.domSelection(),n=e.focusNode,r=e.focusOffset;if(!n)return;let l,c,o=St(n);for(;;)if(r<o){if(1!=n.nodeType)break;if(!kt(n.childNodes[r]))break;l=n,c=++r}else{if(sn(n))break;{let u=n.nextSibling;for(;u&&kt(u);)l=u.parentNode,c=Oe(u)+1,u=u.nextSibling;if(u)n=u,r=0,o=St(n);else{if(n=n.parentNode,n==t.dom)break;r=o=0}}}l&&At(t,e,l,c)}function sn(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function At(t,e,n,r){if(D(e)){let l=document.createRange();l.setEnd(n,r),l.setStart(n,r),e.removeAllRanges(),e.addRange(l)}else e.extend&&e.extend(n,r);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&Qe(t)},50)}function on(t,e,n){let r=t.state.selection;if(r instanceof d.Bs&&!r.empty||n.indexOf("s")>-1||ae&&n.indexOf("m")>-1)return!1;let{$from:o,$to:l}=r;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let c=wt(t.state,e);if(c&&c instanceof d.qv)return st(t,c)}if(!o.parent.inlineContent){let c=e<0?o:l,u=r instanceof d.C1?d.Y1.near(c,e):d.Y1.findFrom(c,e);return!!u&&st(t,u)}return!1}function ln(t,e){if(!(t.state.selection instanceof d.Bs))return!0;let{$head:n,$anchor:r,empty:o}=t.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let l=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(l&&!l.isText){let c=t.state.tr;return e<0?c.delete(n.pos-l.nodeSize,n.pos):c.delete(n.pos,n.pos+l.nodeSize),t.dispatch(c),!0}return!1}function an(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function cn(t,e){let n=[],{content:r,openStart:o,openEnd:l}=e;for(;o>1&&l>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,l--;let R=r.firstChild;n.push(R.type.name,R.attrs!=R.type.defaultAttrs?R.attrs:null),r=R.content}let c=t.someProp("clipboardSerializer")||q.PW.fromSchema(t.state.schema),u=yn(),g=u.createElement("div");g.appendChild(c.serializeFragment(r,{document:u}));let S,O=g.firstChild,L=0;for(;O&&1==O.nodeType&&(S=mn[O.nodeName.toLowerCase()]);){for(let R=S.length-1;R>=0;R--){let $=u.createElement(S[R]);for(;g.firstChild;)$.appendChild(g.firstChild);g.appendChild($),L++}O=g.firstChild}return O&&1==O.nodeType&&O.setAttribute("data-pm-slice",`${o} ${l}${L?` -${L}`:""} ${JSON.stringify(n)}`),{dom:g,text:t.someProp("clipboardTextSerializer",R=>R(e))||e.content.textBetween(0,e.content.size,"\n\n")}}function hn(t,e,n,r,o){let c,u,l=o.parent.type.spec.code;if(!n&&!e)return null;let g=e&&(r||l||!n);if(g){if(t.someProp("transformPastedText",z=>{e=z(e,l||r)}),l)return e?new q.p2(q.HY.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):q.p2.empty;let L=t.someProp("clipboardTextParser",z=>z(e,o,r));if(L)u=L;else{let z=o.marks(),{schema:R}=t.state,$=q.PW.fromSchema(R);c=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(ge=>{let Ce=c.appendChild(document.createElement("p"));ge&&Ce.appendChild($.serializeNode(R.text(ge,z)))})}}else t.someProp("transformPastedHTML",L=>{n=L(n)}),c=function $n(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let o,n=yn().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t);if((o=r&&mn[r[1].toLowerCase()])&&(t=o.map(l=>"<"+l+">").join("")+t+o.map(l=>"</"+l+">").reverse().join("")),n.innerHTML=t,o)for(let l=0;l<o.length;l++)n=n.querySelector(o[l])||n;return n}(n),fe&&function Yn(t){let e=t.querySelectorAll(Y?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];1==r.childNodes.length&&"\xa0"==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(c);let O=c&&c.querySelector("[data-pm-slice]"),S=O&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(O.getAttribute("data-pm-slice")||"");if(S&&S[3])for(let L=+S[3];L>0&&c.firstChild;L--)c=c.firstChild;if(u||(u=(t.someProp("clipboardParser")||t.someProp("domParser")||q.aw.fromSchema(t.state.schema)).parseSlice(c,{preserveWhitespace:!(!g&&!S),context:o,ruleFromNode:z=>"BR"!=z.nodeName||z.nextSibling||!z.parentNode||Zn.test(z.parentNode.nodeName)?null:{ignore:!0}})),S)u=function Gn(t,e){if(!t.size)return t;let r,n=t.content.firstChild.type.schema;try{r=JSON.parse(e)}catch(u){return t}let{content:o,openStart:l,openEnd:c}=t;for(let u=r.length-2;u>=0;u-=2){let g=n.nodes[r[u]];if(!g||g.hasRequiredAttrs())break;o=q.HY.from(g.create(r[u+1],o)),l++,c++}return new q.p2(o,l,c)}(pn(u,+S[1],+S[2]),S[4]);else if(u=q.p2.maxOpen(function Hn(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let l,o=e.node(n).contentMatchAt(e.index(n)),c=[];if(t.forEach(u=>{if(!c)return;let O,g=o.findWrapping(u.type);if(!g)return c=null;if(O=c.length&&l.length&&un(g,l,u,c[c.length-1],0))c[c.length-1]=O;else{c.length&&(c[c.length-1]=fn(c[c.length-1],l.length));let S=dn(u,g);c.push(S),o=o.matchType(S.type),l=g}}),c)return q.HY.from(c)}return t}(u.content,o),!0),u.openStart||u.openEnd){let L=0,z=0;for(let R=u.content.firstChild;L<u.openStart&&!R.type.spec.isolating;L++,R=R.firstChild);for(let R=u.content.lastChild;z<u.openEnd&&!R.type.spec.isolating;z++,R=R.lastChild);u=pn(u,L,z)}return t.someProp("transformPasted",L=>{u=L(u)}),u}const Zn=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function dn(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,q.HY.from(t));return t}function un(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let l=un(t,e,n,r.lastChild,o+1);if(l)return r.copy(r.content.replaceChild(r.childCount-1,l));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(q.HY.from(dn(n,t,o+1))))}}function fn(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,fn(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(q.HY.empty,!0);return t.copy(n.append(r))}function Rt(t,e,n,r,o,l){let c=e<0?t.firstChild:t.lastChild,u=c.content;return o<r-1&&(u=Rt(u,e,n,r,o+1,l)),o>=n&&(u=e<0?c.contentMatchAt(0).fillBefore(u,t.childCount>1||l<=o).append(u):u.append(c.contentMatchAt(c.childCount).fillBefore(q.HY.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,c.copy(u))}function pn(t,e,n){return e<t.openStart&&(t=new q.p2(Rt(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new q.p2(Rt(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const mn={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let gn=null;function yn(){return gn||(gn=document.implementation.createHTMLDocument("title"))}const Be={};let Ae={};class Qn{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ot(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Bt(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>zt(t,r))})}function zt(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function ei(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function bt(t){return{left:t.clientX,top:t.clientY}}function Lt(t,e,n,r,o){if(-1==r)return!1;let l=t.state.doc.resolve(r);for(let c=l.depth+1;c>0;c--)if(t.someProp(e,u=>c>l.depth?u(t,n,l.nodeAfter,l.before(c),o,!0):u(t,n,l.node(c),l.before(c),o,!1)))return!0;return!1}function gt(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function oi(t,e,n,r){return Lt(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",o=>o(t,e,r))}function li(t,e,n,r){return Lt(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",o=>o(t,e,r))||function ai(t,e,n){if(0!=n.button)return!1;let r=t.state.doc;if(-1==e)return!!r.inlineContent&&(gt(t,d.Bs.create(r,0,r.content.size),"pointer"),!0);let o=r.resolve(e);for(let l=o.depth+1;l>0;l--){let c=l>o.depth?o.nodeAfter:o.node(l),u=o.before(l);if(c.inlineContent)gt(t,d.Bs.create(r,u+1,u+1+c.content.size),"pointer");else{if(!d.qv.isSelectable(c))continue;gt(t,d.qv.create(r,u),"pointer")}return!0}}(t,n,r)}function Ft(t){return _t(t)}Ae.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!Mn(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!Z||!Y||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!re||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",r=>r(t,n))||function Kn(t,e){let n=e.keyCode,r=function Jn(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);return 8==n||ae&&72==n&&"c"==r?ln(t,-1)||Pt(t):46==n||ae&&68==n&&"c"==r?ln(t,1)||It(t):13==n||27==n||(37==n||ae&&66==n&&"c"==r?rn(t,-1,r)||Pt(t):39==n||ae&&70==n&&"c"==r?rn(t,1,r)||It(t):38==n||ae&&80==n&&"c"==r?on(t,-1,r)||Pt(t):40==n||ae&&78==n&&"c"==r?function Un(t){if(!J||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelection();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let r=e.firstChild;an(t,r,"true"),setTimeout(()=>an(t,r,"false"),20)}return!1}(t)||on(t,1,r)||It(t):r==(ae?"m":"c")&&(66==n||73==n||89==n||90==n))}(t,n)?n.preventDefault():ot(t,"key");else{let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",o=>o(t,N(13,"Enter"))),t.input.lastIOSEnter=0)},200)}},Ae.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},Ae.keypress=(t,e)=>{let n=e;if(Mn(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||ae&&n.metaKey)return;if(t.someProp("handleKeyPress",o=>o(t,n)))return void n.preventDefault();let r=t.state.selection;if(!(r instanceof d.Bs&&r.$from.sameParent(r.$to))){let o=String.fromCharCode(n.charCode);t.someProp("handleTextInput",l=>l(t,r.$from.pos,r.$to.pos,o))||t.dispatch(t.state.tr.insertText(o).scrollIntoView()),n.preventDefault()}};const xn=ae?"metaKey":"ctrlKey";Be.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Ft(t),o=Date.now(),l="singleClick";o-t.input.lastClick.time<500&&function ni(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[xn]&&("singleClick"==t.input.lastClick.type?l="doubleClick":"doubleClick"==t.input.lastClick.type&&(l="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:l};let c=t.posAtCoords(bt(n));!c||("singleClick"==l?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new ci(t,c,n,!!r)):("doubleClick"==l?oi:li)(t,c.pos,c.inside,n)?n.preventDefault():ot(t,"pointer"))};class ci{constructor(e,n,r,o){let l,c;if(this.view=e,this.pos=n,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[xn],this.allowDefault=r.shiftKey,n.inside>-1)l=e.state.doc.nodeAt(n.inside),c=n.inside;else{let S=e.state.doc.resolve(n.pos);l=S.parent,c=S.depth?S.before():0}const u=o?null:r.target,g=u?e.docView.nearestDesc(u,!0):null;this.target=g?g.dom:null;let{selection:O}=e.state;(0==r.button&&l.type.spec.draggable&&!1!==l.type.spec.selectable||O instanceof d.qv&&O.from<=c&&O.to>c)&&(this.mightDrag={node:l,pos:c,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!W||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ot(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Qe(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(bt(e))),this.allowDefault||!n?ot(this.view,"pointer"):function si(t,e,n,r,o){return Lt(t,"handleClickOn",e,n,r)||t.someProp("handleClick",l=>l(t,e,r))||(o?function ri(t,e){if(-1==e)return!1;let r,o,n=t.state.selection;n instanceof d.qv&&(r=n.node);let l=t.state.doc.resolve(e);for(let c=l.depth+1;c>0;c--){let u=c>l.depth?l.nodeAfter:l.node(c);if(d.qv.isSelectable(u)){o=r&&n.$from.depth>0&&c>=n.$from.depth&&l.before(n.$from.depth+1)==n.$from.pos?l.before(n.$from.depth):l.before(c);break}}return null!=o&&(gt(t,d.qv.create(t.state.doc,o),"pointer"),!0)}(t,n):function ii(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&d.qv.isSelectable(r))&&(gt(t,new d.qv(n),"pointer"),!0)}(t,n))}(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||J&&this.mightDrag&&!this.mightDrag.node.isAtom||Y&&!(this.view.state.selection instanceof d.Bs)&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(gt(this.view,d.Y1.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):ot(this.view,"pointer")}move(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),ot(this.view,"pointer"),0==e.buttons&&this.done()}}function Mn(t,e){return!!t.composing||!!(J&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}Be.touchdown=t=>{Ft(t),ot(t,"pointer")},Be.contextmenu=t=>Ft(t);const hi=Z?5e3:-1;function kn(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>_t(t),e))}function Cn(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function di(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function _t(t,e=!1){if(!(Z&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Cn(t),e||t.docView&&t.docView.dirty){let n=$t(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}}Ae.compositionstart=Ae.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>!1===r.type.spec.inclusive)))t.markCursor=t.state.storedMarks||n.marks(),_t(t,!0),t.markCursor=null;else if(_t(t),W&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelection();for(let o=r.focusNode,l=r.focusOffset;o&&1==o.nodeType&&0!=l;){let c=l<0?o.lastChild:o.childNodes[l-1];if(!c)break;if(3==c.nodeType){r.collapse(c,c.nodeValue.length);break}o=c,l=-1}}t.input.composing=!0}kn(t,hi)},Ae.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,kn(t,20))};const yt=ee&&j<15||re&&xe<604;function qt(t,e,n,r){let o=hn(t,e,n,t.input.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",u=>u(t,r,o||q.p2.empty)))return!0;if(!o)return!1;let l=function fi(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(o),c=l?t.state.tr.replaceSelectionWith(l,t.input.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Be.copy=Ae.cut=(t,e)=>{let n=e,r=t.state.selection,o="cut"==n.type;if(r.empty)return;let l=yt?null:n.clipboardData,c=r.content(),{dom:u,text:g}=cn(t,c);l?(n.preventDefault(),l.clearData(),l.setData("text/html",u.innerHTML),l.setData("text/plain",g)):function ui(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}(t,u),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Ae.paste=(t,e)=>{let n=e;if(t.composing&&!Z)return;let r=yt?null:n.clipboardData;r&&qt(t,r.getData("text/plain"),r.getData("text/html"),n)?n.preventDefault():function pi(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?qt(t,r.value,null,e):qt(t,r.textContent,r.innerHTML,e)},50)}(t,n)};class mi{constructor(e,n){this.slice=e,this.move=n}}const On=ae?"altKey":"ctrlKey";Be.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o=t.state.selection,l=o.empty?null:t.posAtCoords(bt(n));if(!(l&&l.pos>=o.from&&l.pos<=(o instanceof d.qv?o.to-1:o.to)))if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(d.qv.create(t.state.doc,r.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let O=t.docView.nearestDesc(n.target,!0);O&&O.node.type.spec.draggable&&O!=t.docView&&t.dispatch(t.state.tr.setSelection(d.qv.create(t.state.doc,O.posBefore)))}let c=t.state.selection.content(),{dom:u,text:g}=cn(t,c);n.dataTransfer.clearData(),n.dataTransfer.setData(yt?"Text":"text/html",u.innerHTML),n.dataTransfer.effectAllowed="copyMove",yt||n.dataTransfer.setData("text/plain",g),t.dragging=new mi(c,!n[On])},Be.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},Ae.dragover=Ae.dragenter=(t,e)=>e.preventDefault(),Ae.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let o=t.posAtCoords(bt(n));if(!o)return;let l=t.state.doc.resolve(o.pos);if(!l)return;let c=r&&r.slice;c?t.someProp("transformPasted",$=>{c=$(c)}):c=hn(t,n.dataTransfer.getData(yt?"Text":"text/plain"),yt?null:n.dataTransfer.getData("text/html"),!1,l);let u=!(!r||n[On]);if(t.someProp("handleDrop",$=>$(t,n,c||q.p2.empty,u)))return void n.preventDefault();if(!c)return;n.preventDefault();let g=c?(0,ne.nj)(t.state.doc,l.pos,c):l.pos;null==g&&(g=l.pos);let O=t.state.tr;u&&O.deleteSelection();let S=O.mapping.map(g),L=0==c.openStart&&0==c.openEnd&&1==c.content.childCount,z=O.doc;if(L?O.replaceRangeWith(S,S,c.content.firstChild):O.replaceRange(S,S,c),O.doc.eq(z))return;let R=O.doc.resolve(S);if(L&&d.qv.isSelectable(c.content.firstChild)&&R.nodeAfter&&R.nodeAfter.sameMarkup(c.content.firstChild))O.setSelection(new d.qv(R));else{let $=O.mapping.map(g);O.mapping.maps[O.mapping.maps.length-1].forEach((ge,Ce,Ee,We)=>$=We),O.setSelection(Nt(t,R,O.doc.resolve($)))}t.focus(),t.dispatch(O.setMeta("uiEvent","drop"))},Be.focus=t=>{t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelection())&&Qe(t)},20))},Be.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},Be.beforeinput=(t,e)=>{if(Y&&Z&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",l=>l(t,N(8,"Backspace")))))return;let{$cursor:o}=t.state.selection;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let t in Ae)Be[t]=Ae[t];function Ct(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Vt{constructor(e,n){this.toDOM=e,this.spec=n||lt,this.side=this.spec.side||0}map(e,n,r,o){let{pos:l,deleted:c}=e.mapResult(n.from+o,this.side<0?-1:1);return c?null:new Fe(l-r,l-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Vt&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ct(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class je{constructor(e,n){this.attrs=e,this.spec=n||lt}map(e,n,r,o){let l=e.map(n.from+o,this.spec.inclusiveStart?-1:1)-r,c=e.map(n.to+o,this.spec.inclusiveEnd?1:-1)-r;return l>=c?null:new Fe(l,c,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof je&&Ct(this.attrs,e.attrs)&&Ct(this.spec,e.spec)}static is(e){return e.type instanceof je}destroy(){}}class Wt{constructor(e,n){this.attrs=e,this.spec=n||lt}map(e,n,r,o){let l=e.mapResult(n.from+o,1);if(l.deleted)return null;let c=e.mapResult(n.to+o,-1);return c.deleted||c.pos<=l.pos?null:new Fe(l.pos-r,c.pos-r,this)}valid(e,n){let l,{index:r,offset:o}=e.content.findIndex(n.from);return o==n.from&&!(l=e.child(r)).isText&&o+l.nodeSize==n.to}eq(e){return this==e||e instanceof Wt&&Ct(this.attrs,e.attrs)&&Ct(this.spec,e.spec)}destroy(){}}class Fe{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Fe(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Fe(e,e,new Vt(n,r))}static inline(e,n,r,o){return new Fe(e,n,new je(r,o))}static node(e,n,r,o){return new Fe(e,n,new Wt(r,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof je}}const xt=[],lt={};class we{constructor(e,n){this.local=e.length?e:xt,this.children=n.length?n:xt}static create(e,n){return n.length?Tt(n,e,0,lt):Pe}find(e,n,r){let o=[];return this.findInner(null==e?0:e,null==n?1e9:n,o,0,r),o}findInner(e,n,r,o,l){for(let c=0;c<this.local.length;c++){let u=this.local[c];u.from<=n&&u.to>=e&&(!l||l(u.spec))&&r.push(u.copy(u.from+o,u.to+o))}for(let c=0;c<this.children.length;c+=3)if(this.children[c]<n&&this.children[c+1]>e){let u=this.children[c]+1;this.children[c+2].findInner(e-u,n-u,r,o+u,l)}}map(e,n,r){return this==Pe||0==e.maps.length?this:this.mapInner(e,n,0,0,r||lt)}mapInner(e,n,r,o,l){let c;for(let u=0;u<this.local.length;u++){let g=this.local[u].map(e,r,o);g&&g.type.valid(n,g)?(c||(c=[])).push(g):l.onRemove&&l.onRemove(this.local[u].spec)}return this.children.length?function gi(t,e,n,r,o,l,c){let u=t.slice(),g=(S,L,z,R)=>{for(let $=0;$<u.length;$+=3){let Ce,ge=u[$+1];if(ge<0||S>ge+l)continue;let Ee=u[$]+l;L>=Ee?u[$+1]=S<=Ee?-2:-1:z>=o&&(Ce=R-z-(L-S))&&(u[$]+=Ce,u[$+1]+=Ce)}};for(let S=0;S<n.maps.length;S++)n.maps[S].forEach(g);let O=!1;for(let S=0;S<u.length;S+=3)if(u[S+1]<0){if(-2==u[S+1]){O=!0,u[S+1]=-1;continue}let L=n.map(t[S]+l),z=L-o;if(z<0||z>=r.content.size){O=!0;continue}let $=n.map(t[S+1]+l,-1)-o,{index:ge,offset:Ce}=r.content.findIndex(z),Ee=r.maybeChild(ge);if(Ee&&Ce==z&&Ce+Ee.nodeSize==$){let We=u[S+2].mapInner(n,Ee,L+1,t[S]+l+1,c);We!=Pe?(u[S]=z,u[S+1]=$,u[S+2]=We):(u[S+1]=-2,O=!0)}else O=!0}if(O){let S=function yi(t,e,n,r,o,l,c){function u(g,O){for(let S=0;S<g.local.length;S++){let L=g.local[S].map(r,o,O);L?n.push(L):c.onRemove&&c.onRemove(g.local[S].spec)}for(let S=0;S<g.children.length;S+=3)u(g.children[S+2],g.children[S]+O+1)}for(let g=0;g<t.length;g+=3)-1==t[g+1]&&u(t[g+2],e[g]+l+1);return n}(u,t,e,n,o,l,c),L=Tt(S,r,0,c);e=L.local;for(let z=0;z<u.length;z+=3)u[z+1]<0&&(u.splice(z,3),z-=3);for(let z=0,R=0;z<L.children.length;z+=3){let $=L.children[z];for(;R<u.length&&u[R]<$;)R+=3;u.splice(R,0,L.children[z],L.children[z+1],L.children[z+2])}}return new we(e.sort(at),u)}(this.children,c||[],e,n,r,o,l):c?new we(c.sort(at),xt):Pe}add(e,n){return n.length?this==Pe?we.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let o,l=0;e.forEach((u,g)=>{let S,O=g+r;if(S=bn(n,u,O)){for(o||(o=this.children.slice());l<o.length&&o[l]<g;)l+=3;o[l]==g?o[l+2]=o[l+2].addInner(u,S,O+1):o.splice(l,0,g,g+u.nodeSize,Tt(S,u,O+1,lt)),l+=3}});let c=Sn(l?_n(n):n,-r);for(let u=0;u<c.length;u++)c[u].type.valid(e,c[u])||c.splice(u--,1);return new we(c.length?this.local.concat(c).sort(at):this.local,o||this.children)}remove(e){return 0==e.length||this==Pe?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,o=this.local;for(let l=0;l<r.length;l+=3){let c,u=r[l]+n,g=r[l+1]+n;for(let L,S=0;S<e.length;S++)(L=e[S])&&L.from>u&&L.to<g&&(e[S]=null,(c||(c=[])).push(L));if(!c)continue;r==this.children&&(r=this.children.slice());let O=r[l+2].removeInner(c,u+1);O!=Pe?r[l+2]=O:(r.splice(l,3),l-=3)}if(o.length)for(let c,l=0;l<e.length;l++)if(c=e[l])for(let u=0;u<o.length;u++)o[u].eq(c,n)&&(o==this.local&&(o=this.local.slice()),o.splice(u--,1));return r==this.children&&o==this.local?this:o.length||r.length?new we(o,r):Pe}forChild(e,n){if(this==Pe)return this;if(n.isLeaf)return we.empty;let r,o;for(let u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(r=this.children[u+2]);break}let l=e+1,c=l+n.content.size;for(let u=0;u<this.local.length;u++){let g=this.local[u];if(g.from<c&&g.to>l&&g.type instanceof je){let O=Math.max(l,g.from)-l,S=Math.min(c,g.to)-l;O<S&&(o||(o=[])).push(g.copy(O,S))}}if(o){let u=new we(o.sort(at),xt);return r?new Xe([u,r]):u}return r||Pe}eq(e){if(this==e)return!0;if(!(e instanceof we)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Ut(this.localsInner(e))}localsInner(e){if(this==Pe)return xt;if(e.inlineContent||!this.local.some(je.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof je||n.push(this.local[r]);return n}}we.empty=new we([],[]),we.removeOverlap=Ut;const Pe=we.empty;class Xe{constructor(e){this.members=e}map(e,n){const r=this.members.map(o=>o.map(e,n,lt));return Xe.from(r)}forChild(e,n){if(n.isLeaf)return we.empty;let r=[];for(let o=0;o<this.members.length;o++){let l=this.members[o].forChild(e,n);l!=Pe&&(l instanceof Xe?r=r.concat(l.members):r.push(l))}return Xe.from(r)}eq(e){if(!(e instanceof Xe)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let o=0;o<this.members.length;o++){let l=this.members[o].localsInner(e);if(l.length)if(n){r&&(n=n.slice(),r=!1);for(let c=0;c<l.length;c++)n.push(l[c])}else n=l}return n?Ut(r?n:n.sort(at)):xt}static from(e){switch(e.length){case 0:return Pe;case 1:return e[0];default:return new Xe(e)}}}function Sn(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(new Fe(o.from+e,o.to+e,o.type))}return n}function bn(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,o=null;for(let c,l=0;l<t.length;l++)(c=t[l])&&c.from>n&&c.to<r&&((o||(o=[])).push(c),t[l]=null);return o}function _n(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function Tt(t,e,n,r){let o=[],l=!1;e.forEach((u,g)=>{let O=bn(t,u,g+n);if(O){l=!0;let S=Tt(O,u,n+g+1,r);S!=Pe&&o.push(g,g+u.nodeSize,S)}});let c=Sn(l?_n(t):t,-n).sort(at);for(let u=0;u<c.length;u++)c[u].type.valid(e,c[u])||(r.onRemove&&r.onRemove(c[u].spec),c.splice(u--,1));return c.length||o.length?new we(c,o):Pe}function at(t,e){return t.from-e.from||t.to-e.to}function Ut(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let o=n+1;o<e.length;o++){let l=e[o];if(l.from!=r.from){l.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,l.from),Tn(e,o,r.copy(l.from,r.to)));break}l.to!=r.to&&(e==t&&(e=t.slice()),e[o]=l.copy(l.from,r.to),Tn(e,o+1,l.copy(r.to,l.to)))}}return e}function Tn(t,e,n){for(;e<t.length&&at(n,t[e])>0;)e++;t.splice(e,0,n)}function Jt(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Pe&&e.push(r)}),t.cursorWrapper&&e.push(we.create(t.state.doc,[t.cursorWrapper.deco])),Xe.from(e)}const xi={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Mi=ee&&j<=11;class ki{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Ci{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new ki,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let o=0;o<r.length;o++)this.queue.push(r[o]);ee&&j<=11&&r.some(o=>"childList"==o.type&&o.removedNodes.length||"characterData"==o.type&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),Mi&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,xi)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(tn(this.view)){if(this.suppressingSelectionUpdates)return Qe(this.view);if(ee&&j<=11&&!this.view.state.selection.empty){let e=this.view.domSelection();if(e.focusNode&&te(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelection())}ignoreSelectionChange(e){if(0==e.rangeCount)return!0;let n=e.getRangeAt(0).commonAncestorContainer,r=this.view.docView.nearestDesc(n);return r&&r.ignoreMutation({type:"selection",target:3==n.nodeType?n.parentNode:n})?(this.setCurSelection(),!0):void 0}flush(){if(!this.view.docView||this.flushingSoon>-1)return;let e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);let n=this.view.domSelection(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&tn(this.view)&&!this.ignoreSelectionChange(n),o=-1,l=-1,c=!1,u=[];if(this.view.editable)for(let g=0;g<e.length;g++){let O=this.registerMutation(e[g],u);O&&(o=o<0?O.from:Math.min(O.from,o),l=l<0?O.to:Math.max(O.to,l),O.typeOver&&(c=!0))}if(W&&u.length>1){let g=u.filter(O=>"BR"==O.nodeName);if(2==g.length){let O=g[0],S=g[1];O.parentNode&&O.parentNode.parentNode==S.parentNode?S.remove():O.remove()}}(o>-1||r)&&(o>-1&&(this.view.docView.markDirty(o,l),function Oi(t){Dn||(Dn=!0,"normal"==getComputedStyle(t.dom).whiteSpace&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}(this.view)),this.handleDOMChange(o,l,c,u),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(n)||Qe(this.view),this.currentSelection.set(n))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(r==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if("childList"==e.type){for(let S=0;S<e.addedNodes.length;S++)n.push(e.addedNodes[S]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let o=e.previousSibling,l=e.nextSibling;if(ee&&j<=11&&e.addedNodes.length)for(let S=0;S<e.addedNodes.length;S++){let{previousSibling:L,nextSibling:z}=e.addedNodes[S];(!L||Array.prototype.indexOf.call(e.addedNodes,L)<0)&&(o=L),(!z||Array.prototype.indexOf.call(e.addedNodes,z)<0)&&(l=z)}let c=o&&o.parentNode==e.target?Oe(o)+1:0,u=r.localPosFromDOM(e.target,c,-1),g=l&&l.parentNode==e.target?Oe(l):e.target.childNodes.length;return{from:u,to:r.localPosFromDOM(e.target,g,1)}}return"attributes"==e.type?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let Dn=!1;function bi(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(J&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||J&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}function En(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Nt(t,e.resolve(n.anchor),e.resolve(n.head))}function Kt(t,e,n){let r=t.depth,o=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n){let l=t.node(r).maybeChild(t.indexAfter(r));for(;l&&!l.isLeaf;)l=l.firstChild,o++}return o}class vi{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Qn,this.prevDirectPlugins=[],this.pluginViews=[],this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(In),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=wn(this),Nn(this),this.nodeViews=Pn(this),this.docView=x(this.state.doc,vn(this),Jt(this),this.dom,this),this.domObserver=new Ci(this,(r,o,l,c)=>function _i(t,e,n,r,o){if(e<0){let ye=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,tt=$t(t,ye);if(tt&&!t.state.selection.eq(tt)){let Ht=t.state.tr.setSelection(tt);"pointer"==ye?Ht.setMeta("pointer",!0):"key"==ye&&Ht.scrollIntoView(),t.dispatch(Ht)}return}let l=t.state.doc.resolve(e),c=l.sharedDepth(n);e=l.before(c+1),n=t.state.doc.resolve(n).after(c+1);let u=t.state.selection,g=function Si(t,e,n){let O,{node:r,fromOffset:o,toOffset:l,from:c,to:u}=t.docView.parseRange(e,n),g=t.domSelection(),S=g.anchorNode;if(S&&t.dom.contains(1==S.nodeType?S:S.parentNode)&&(O=[{node:S,offset:g.anchorOffset}],D(g)||O.push({node:g.focusNode,offset:g.focusOffset})),Y&&8===t.input.lastKeyCode)for(let Ce=l;Ce>o;Ce--){let Ee=r.childNodes[Ce-1],We=Ee.pmViewDesc;if("BR"==Ee.nodeName&&!We){l=Ce;break}if(!We||We.size)break}let L=t.state.doc,z=t.someProp("domParser")||q.aw.fromSchema(t.state.schema),R=L.resolve(c),$=null,ge=z.parse(r,{topNode:R.parent,topMatch:R.parent.contentMatchAt(R.index()),topOpen:!0,from:o,to:l,preserveWhitespace:"pre"!=R.parent.type.whitespace||"full",findPositions:O,ruleFromNode:bi,context:R});if(O&&null!=O[0].pos){let Ce=O[0].pos,Ee=O[1]&&O[1].pos;null==Ee&&(Ee=Ce),$={anchor:Ce+c,head:Ee+c}}return{doc:ge,sel:$,from:c,to:u}}(t,e,n);if(Y&&t.cursorWrapper&&g.sel&&g.sel.anchor==t.cursorWrapper.deco.from&&g.sel.head==g.sel.anchor){let ye=t.cursorWrapper.deco.type.toDOM.nextSibling,tt=ye&&ye.nodeValue?ye.nodeValue.length:1;g.sel={anchor:g.sel.anchor+tt,head:g.sel.anchor+tt}}let L,z,O=t.state.doc,S=O.slice(g.from,g.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(L=t.state.selection.to,z="end"):(L=t.state.selection.from,z="start"),t.input.lastKeyCode=null;let R=function Ei(t,e,n,r,o){let l=t.findDiffStart(e,n);if(null==l)return null;let{a:c,b:u}=t.findDiffEnd(e,n+t.size,n+e.size);return"end"==o&&(r-=c+Math.max(0,l-Math.min(c,u))-l),c<l&&t.size<e.size?(l-=r<=l&&r>=c?l-r:0,u=l+(u-c),c=l):u<l&&(l-=r<=l&&r>=u?l-r:0,c=l+(c-u),u=l),{start:l,endA:c,endB:u}}(S.content,g.doc.content,g.from,L,z);if((re&&t.input.lastIOSEnter>Date.now()-225||Z)&&o.some(ye=>"DIV"==ye.nodeName||"P"==ye.nodeName)&&(!R||R.endA>=R.endB)&&t.someProp("handleKeyDown",ye=>ye(t,N(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(!R){if(!(r&&u instanceof d.Bs&&!u.empty&&u.$head.sameParent(u.$anchor))||t.composing||g.sel&&g.sel.anchor!=g.sel.head){if(g.sel){let ye=En(t,t.state.doc,g.sel);ye&&!ye.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(ye))}return}R={start:u.from,endA:u.to,endB:u.to}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&R.start==R.endB&&t.state.selection instanceof d.Bs&&(R.start>t.state.selection.from&&R.start<=t.state.selection.from+2&&t.state.selection.from>=g.from?R.start=t.state.selection.from:R.endA<t.state.selection.to&&R.endA>=t.state.selection.to-2&&t.state.selection.to<=g.to&&(R.endB+=t.state.selection.to-R.endA,R.endA=t.state.selection.to)),ee&&j<=11&&R.endB==R.start+1&&R.endA==R.start&&R.start>g.from&&" \xa0"==g.doc.textBetween(R.start-g.from-1,R.start-g.from+1)&&(R.start--,R.endA--,R.endB--);let We,$=g.doc.resolveNoCache(R.start-g.from),ge=g.doc.resolveNoCache(R.endB-g.from),Ce=O.resolve(R.start),Ee=$.sameParent(ge)&&$.parent.inlineContent&&Ce.end()>=R.endA;if((re&&t.input.lastIOSEnter>Date.now()-225&&(!Ee||o.some(ye=>"DIV"==ye.nodeName||"P"==ye.nodeName))||!Ee&&$.pos<g.doc.content.size&&(We=d.Y1.findFrom(g.doc.resolve($.pos+1),1,!0))&&We.head==ge.pos)&&t.someProp("handleKeyDown",ye=>ye(t,N(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>R.start&&function Di(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||Kt(r,!0,!1)<o.pos)return!1;let l=t.resolve(e);if(l.parentOffset<l.parent.content.size||!l.parent.isTextblock)return!1;let c=t.resolve(Kt(l,!0,!0));return!(!c.parent.isTextblock||c.pos>n||Kt(c,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(c.parent.content)}(O,R.start,R.endA,$,ge)&&t.someProp("handleKeyDown",ye=>ye(t,N(8,"Backspace"))))return void(Z&&Y&&t.domObserver.suppressSelectionUpdates());Y&&Z&&R.endB==R.start&&(t.input.lastAndroidDelete=Date.now()),Z&&!Ee&&$.start()!=ge.start()&&0==ge.parentOffset&&$.depth==ge.depth&&g.sel&&g.sel.anchor==g.sel.head&&g.sel.head==R.endA&&(R.endB-=2,ge=g.doc.resolveNoCache(R.endB-g.from),setTimeout(()=>{t.someProp("handleKeyDown",function(ye){return ye(t,N(13,"Enter"))})},20));let qe,Zt,Dt,et=R.start,ct=R.endA;if(Ee)if($.pos==ge.pos)ee&&j<=11&&0==$.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Qe(t),20)),qe=t.state.tr.delete(et,ct),Zt=O.resolve(R.start).marksAcross(O.resolve(R.endA));else if(R.endA==R.endB&&(Dt=function Ti(t,e){let c,u,g,n=t.firstChild.marks,r=e.firstChild.marks,o=n,l=r;for(let S=0;S<r.length;S++)o=r[S].removeFromSet(o);for(let S=0;S<n.length;S++)l=n[S].removeFromSet(l);if(1==o.length&&0==l.length)u=o[0],c="add",g=S=>S.mark(u.addToSet(S.marks));else{if(0!=o.length||1!=l.length)return null;u=l[0],c="remove",g=S=>S.mark(u.removeFromSet(S.marks))}let O=[];for(let S=0;S<e.childCount;S++)O.push(g(e.child(S)));if(q.HY.from(O).eq(t))return{mark:u,type:c}}($.parent.content.cut($.parentOffset,ge.parentOffset),Ce.parent.content.cut(Ce.parentOffset,R.endA-Ce.start()))))qe=t.state.tr,"add"==Dt.type?qe.addMark(et,ct,Dt.mark):qe.removeMark(et,ct,Dt.mark);else if($.parent.child($.index()).isText&&$.index()==ge.index()-(ge.textOffset?0:1)){let ye=$.parent.textBetween($.parentOffset,ge.parentOffset);if(t.someProp("handleTextInput",tt=>tt(t,et,ct,ye)))return;qe=t.state.tr.insertText(ye,et,ct)}if(qe||(qe=t.state.tr.replace(et,ct,g.doc.slice(R.start-g.from,R.endB-g.from))),g.sel){let ye=En(t,qe.doc,g.sel);ye&&!(Y&&Z&&t.composing&&ye.empty&&(R.start!=R.endB||t.input.lastAndroidDelete<Date.now()-100)&&(ye.head==et||ye.head==qe.mapping.map(ct)-1)||ee&&ye.empty&&ye.head==et)&&qe.setSelection(ye)}Zt&&qe.ensureMarks(Zt),t.dispatch(qe.scrollIntoView())}(this,r,o,l,c)),this.domObserver.start(),function jn(t){for(let e in Be){let n=Be[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{ei(t,r)&&!zt(t,r)&&(t.editable||!(r.type in Ae))&&n(t,r)})}J&&t.dom.addEventListener("input",()=>null),Bt(t)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Bt(this),this._props=e,e.plugins&&(e.plugins.forEach(In),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this.state.plugins!=e.plugins)}updateStateInner(e,n){let r=this.state,o=!1,l=!1;if(e.storedMarks&&this.composing&&(Cn(this),l=!0),this.state=e,n){let L=Pn(this);(function wi(t,e){let n=0,r=0;for(let o in t){if(t[o]!=e[o])return!0;n++}for(let o in e)r++;return n!=r})(L,this.nodeViews)&&(this.nodeViews=L,o=!0),Bt(this)}this.editable=wn(this),Nn(this);let c=Jt(this),u=vn(this),g=n?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",O=o||!this.docView.matchesNode(e.doc,u,c);(O||!e.selection.eq(r.selection))&&(l=!0);let S="preserve"==g&&l&&null==this.dom.style.overflowAnchor&&function _e(t){let r,o,e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top);for(let l=(e.left+e.right)/2,c=n+1;c<Math.min(innerHeight,e.bottom);c+=5){let u=t.root.elementFromPoint(l,c);if(!u||u==t.dom||!t.dom.contains(u))continue;let g=u.getBoundingClientRect();if(g.top>=n-20){r=u,o=g.top;break}}return{refDOM:r,refTop:o,stack:ve(t.dom)}}(this);if(l){this.domObserver.stop();let L=O&&(ee||Y)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&function Ni(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}(r.selection,e.selection);if(O){let z=Y?this.trackWrites=this.domSelection().focusNode:null;(o||!this.docView.update(e.doc,u,c,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=x(e.doc,u,c,this.dom,this)),z&&!this.trackWrites&&(L=!0)}L||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelection())&&function Wn(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelection();return te(e.node,e.offset,n.anchorNode,n.anchorOffset)}(this))?Qe(this,L):(Xt(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(r),"reset"==g)this.dom.scrollTop=0;else if("to selection"==g){let L=this.domSelection().focusNode;if(!this.someProp("handleScrollToSelection",z=>z(this)))if(e.selection instanceof d.qv){let z=this.docView.domAfterPos(e.selection.from);1==z.nodeType&&ke(this,z.getBoundingClientRect(),L)}else ke(this,this.coordsAtPos(e.selection.head,1),L)}else S&&function De({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;Ue(n,0==r?0:r-e)}(S)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}}someProp(e,n){let o,r=this._props&&this._props[e];if(null!=r&&(o=n?n(r):r))return o;for(let c=0;c<this.directPlugins.length;c++){let u=this.directPlugins[c].props[e];if(null!=u&&(o=n?n(u):u))return o}let l=this.state.plugins;if(l)for(let c=0;c<l.length;c++){let u=l[c].props[e];if(null!=u&&(o=n?n(u):u))return o}}hasFocus(){return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function ht(t){if(t.setActive)return t.setActive();if(Je)return t.focus(Je);let e=ve(t);t.focus(null==Je?{get preventScroll(){return Je={preventScroll:!0},!0}}:void 0),Je||(Je=!1,Ue(e,0))}(this.dom),Qe(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let n=this.dom.parentNode;n;n=n.parentNode)if(9==n.nodeType||11==n.nodeType&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n;return e||document}posAtCoords(e){return ft(this,e)}coordsAtPos(e,n=1){return it(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let o=this.docView.posFromDOM(e,n,r);if(null==o)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(e,n){return function p(t,e,n){return He==e&&_==n?h:(He=e,_=n,h="up"==n||"down"==n?function mt(t,e,n){let r=e.selection,o="up"==n?r.$from:r.$to;return pt(t,e,()=>{let{node:l}=t.docView.domFromPos(o.pos,"up"==n?-1:1);for(;;){let u=t.docView.nearestDesc(l,!0);if(!u)break;if(u.node.isBlock){l=u.dom;break}l=u.dom.parentNode}let c=it(t,o.pos,1);for(let u=l.firstChild;u;u=u.nextSibling){let g;if(1==u.nodeType)g=u.getClientRects();else{if(3!=u.nodeType)continue;g=de(u,0,u.nodeValue.length).getClientRects()}for(let O=0;O<g.length;O++){let S=g[O];if(S.bottom>S.top+1&&("up"==n?c.top-S.top>2*(S.bottom-c.top):S.bottom-c.bottom>2*(c.bottom-S.top)))return!1}}return!0})}(t,e,n):function ze(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let o=r.parentOffset,l=!o,c=o==r.parent.content.size,u=t.domSelection();return Ye.test(r.parent.textContent)&&u.modify?pt(t,e,()=>{let g=u.getRangeAt(0),O=u.focusNode,S=u.focusOffset,L=u.caretBidiLevel;u.modify("move",n,"character");let R=!(r.depth?t.docView.domAfterPos(r.before()):t.dom).contains(1==u.focusNode.nodeType?u.focusNode:u.focusNode.parentNode)||O==u.focusNode&&S==u.focusOffset;return u.removeAllRanges(),u.addRange(g),null!=L&&(u.caretBidiLevel=L),R}):"left"==n||"backward"==n?l:c}(t,e,n))}(this,n||this.state,e)}destroy(){!this.docView||(function Xn(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Jt(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function ti(t,e){!zt(t,e)&&Be[e.type]&&(t.editable||!(e.type in Ae))&&Be[e.type](t,e)}(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelection(){return this.root.getSelection()}}function vn(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let r in n)"class"==r&&(e.class+=" "+n[r]),"style"==r?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&"contenteditable"!=r&&"nodeName"!=r&&(e[r]=String(n[r]))}),[Fe.node(0,t.state.doc.content.size,e)]}function Nn(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Fe.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function wn(t){return!t.someProp("editable",e=>!1===e(t.state))}function Pn(t){let e=Object.create(null);function n(r){for(let o in r)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=r[o])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function In(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}},5861:(be,ue,P)=>{function d(ne,V,w,H,F,v,I){try{var ee=ne[v](I),j=ee.value}catch(W){return void w(W)}ee.done?V(j):Promise.resolve(j).then(H,F)}function q(ne){return function(){var V=this,w=arguments;return new Promise(function(H,F){var v=ne.apply(V,w);function I(j){d(v,H,F,I,ee,"next",j)}function ee(j){d(v,H,F,I,ee,"throw",j)}I(void 0)})}}P.d(ue,{Z:()=>q})}}]);