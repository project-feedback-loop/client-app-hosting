"use strict";(self.webpackChunkfeedback_loop_client=self.webpackChunkfeedback_loop_client||[]).push([[612],{6335:(Ee,fe,L)=>{L.d(fe,{P:()=>F});var O=L(914),z=L(5e3),le=L(6580),K=L(3616);let F=(()=>{class J extends O.Hb{constructor(v,A){super(v),this.store=v,this.authQuery=A,this.appConfig={headers:{Authorization:`Bearer ${this.authQuery.jwtToken}`}},this.authQuery.$jwtToken.subscribe(Q=>this.appConfig={headers:{Authorization:`Bearer ${Q}`}})}getall(){return this.get({params:{populate:"*"},headers:this.appConfig.headers}).subscribe()}getOne(v){return this.get(v,{params:{populate:"*"},headers:this.appConfig.headers}).subscribe()}addRequest(v){return this.add(Object.assign(Object.assign({},v),{data:v}),this.appConfig).subscribe()}updateRequest(v,A){return this.update(v,{data:{content:A.content,rawContent:A.rawContent,category:A.category,severity:A.severity,status:A.status,associatedTask:A.associatedTask,createdByUser:A.createdByUser}},this.appConfig).subscribe()}}return J.\u0275fac=function(v){return new(v||J)(z.LFG(le.y),z.LFG(K.i))},J.\u0275prov=z.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},6580:(Ee,fe,L)=>{L.d(fe,{y:()=>K});var O=L(655),z=L(1469),le=L(5e3);let K=class extends z.cf{constructor(){super()}};K.\u0275fac=function(J){return new(J||K)},K.\u0275prov=le.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"}),K=(0,O.gn)([(0,z.yC)({name:"requests"})],K)},8025:(Ee,fe,L)=>{function O(z){return{jwt:"",accessToken:"",user:{}}}L.d(fe,{l:()=>O})},3616:(Ee,fe,L)=>{L.d(fe,{i:()=>K});var O=L(1469),z=L(5e3),le=L(4277);let K=(()=>{class F extends O.Gv{constructor(W){super(W),this.store=W,this.$jwtToken=this.select("jwt"),this.$authUser=this.select("user"),this.$accessToken=this.select("accessToken"),this.jwtToken="",this.$jwtToken.subscribe(v=>{this.jwtToken=v}),this.$authUser.subscribe(v=>this.user=v)}}return F.\u0275fac=function(W){return new(W||F)(z.LFG(le.C))},F.\u0275prov=z.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},4277:(Ee,fe,L)=>{L.d(fe,{C:()=>F});var O=L(655),z=L(1469),le=L(8025),K=L(5e3);let F=class extends z.cf{constructor(){super((0,le.l)({}))}};F.\u0275fac=function(W){return new(W||F)},F.\u0275prov=K.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F=(0,O.gn)([(0,z.yC)({name:"auth"})],F)},4817:(Ee,fe,L)=>{L.d(fe,{z:()=>le});var O=L(5e3),z=L(9565);let le=(()=>{class K{constructor(J){this.navigation=J}onClick(){this.navigation.back()}}return K.\u0275fac=function(J){return new(J||K)(O.Y36(z.f))},K.\u0275dir=O.lG2({type:K,selectors:[["","appBackButton",""]],hostBindings:function(J,W){1&J&&O.NdJ("click",function(){return W.onClick()})}}),K})()},7465:(Ee,fe,L)=>{L.d(fe,{U:()=>G});var O=L(2626),z=L(8197),le=L(3981),K=L(5e3),F=L(9854),J=L(6138),W=L(8964);const v=L(8769),{addMentionNodes:Q}=v;let G=(()=>{class ne{constructor(ue,ee,Oe,pe){this.router=ue,this.requestService=ee,this.taskService=Oe,this.milestoneService=pe,this.selectedIndex=0,this.isSearching=!1,this.url="",this.showMenu=!1,this.entity="Request",this.requestSubFilterList=["All","Open","Close"],this.taskSubFilterList=["All","Yet To Start","In Discussion","In Progress","Completed","Testing","Released"],this.searchFilterList=["Requests","Tasks","Milestones"],this.milestoneSubFilterList=["All","Yet To Start","In Discussion","In Progress","Completed","Testing","Released"],this.customSchema=new z.V_({nodes:Q(Q(le.fK.spec.nodes)),marks:le.fK.spec.marks}),this.mentionArray=[{name:"IlayaSelvaGanesh",id:"101",email:"ilaya@gmail.com"},{name:"SanthoshBalaji",id:"102",email:"santhosh@gmail.com"},{name:"Dhivya",id:"103",email:"dhivya@gmail.com"},{name:"Ramya",id:"104",email:"ramya@gmail.com"},{name:"Sathya",id:"104",email:"sathya@gmail.com"},{name:"Murali",id:"105",email:"murali@gmail.com"}],this.tagArray=[{tag:"ShowStopper",type:"Severity"},{tag:"Critical",type:"Severity"},{tag:"Major",type:"Severity"},{tag:"Minor",type:"Severity"},{tag:"Grid",type:"Module"},{tag:"Issue",type:"Category"},{tag:"Feature",type:"Category"},{tag:"Feedback",type:"Category"}],ue.events.subscribe(oe=>{oe instanceof O.m2&&(this.url=oe.url)})}getFilterListFromEntity(ue){switch(ue){case"request":return this.requestSubFilterList;case"task":return this.taskSubFilterList;case"search":return this.searchFilterList;case"milestone":return this.milestoneSubFilterList;default:return[]}return[]}navigatToSearch(ue){null==event||event.stopPropagation(),this.router.navigate([`/home/search/${ue}`])}}return ne.\u0275fac=function(ue){return new(ue||ne)(K.LFG(O.F0),K.LFG(F.s),K.LFG(J.M),K.LFG(W.$))},ne.\u0275prov=K.Yz7({token:ne,factory:ne.\u0275fac,providedIn:"root"}),ne})()},6858:(Ee,fe,L)=>{L.d(fe,{O:()=>K});var O=L(2340),z=L(5e3),le=L(520);let K=(()=>{class F{constructor(W){this.http=W,this.strapi_url=O.N.strapi_url,this.options={headers:{Authorization:`Bearer ${O.N.strapi_token}`}}}addNewRequest(W){return this.http.post(`${this.strapi_url}api/requests`,W,this.options)}getRequestList(){return this.http.get(`${this.strapi_url}api/requests/`,this.options)}getRequestById(W){return this.http.get(`${this.strapi_url}api/requests/${W}/`,this.options)}getAllDetailsRequestById(W){return this.http.get(`${this.strapi_url}api/requests/${W}/?populate=%2A`,this.options)}getUnlinkedRequestList(){return this.http.get(`${this.strapi_url}api/requests/?filters[associatedTask]`,this.options)}getFilteredRequestList(W){let v=`${this.strapi_url}api/requests/?`;return W.forEach(A=>{v+=`&filters[${A.fieldName}][${A.operator}]=${A.searchValue}`}),this.http.get(v,this.options)}updateRequestById(W,v){return this.http.put(`${this.strapi_url}api/requests/${W}`,v={data:{content:v.data.content,rawContent:v.data.rawContent,category:v.data.category,severity:v.data.severity,status:v.data.status,associatedTask:v.data.associatedTask}},this.options)}deleteRequestById(W){return this.http.delete(`${this.strapi_url}api/requests/${W}`,this.options)}addNewTask(W){return this.http.post(`${this.strapi_url}api/tasks`,W,this.options)}getTaskList(){return this.http.get(`${this.strapi_url}api/tasks/`,this.options)}getTaskById(W){return this.http.get(`${this.strapi_url}api/tasks/${W}/`,this.options)}getAllDetailsTaskById(W){return this.http.get(`${this.strapi_url}api/tasks/${W}/?populate=%2A`,this.options)}getUnlinkedTasks(){return this.http.get(`${this.strapi_url}api/tasks/?filters[associatedMilestone]`,this.options)}getFilteredTaskList(W){let v=`${this.strapi_url}api/tasks/?`;return W.forEach(A=>{v+=`&filters[${A.fieldName}][${A.operator}]=${A.searchValue}`}),console.log(v),this.http.get(v,this.options)}updateTaskById(W,v){return this.http.put(`${this.strapi_url}api/tasks/${W}`,v,this.options)}deleteTaskById(W){return this.http.delete(`${this.strapi_url}api/tasks/${W}`,this.options)}addNewMilestone(W){return this.http.post(`${this.strapi_url}api/milestones`,W,this.options)}getMilestoneList(){return this.http.get(`${this.strapi_url}api/milestones/`,this.options)}getMilestoneById(W){return this.http.get(`${this.strapi_url}api/milestones/${W}/`,this.options)}getAllDetailsMilestoneById(W){return this.http.get(`${this.strapi_url}api/milestones/${W}/?populate=%2A`,this.options)}getFilteredMilestoneList(W){let v=`${this.strapi_url}api/milestones/?`;return W.forEach(A=>{v+=`&filters[${A.fieldName}][${A.operator}]=${A.searchValue}`}),this.http.get(v,this.options)}updateMilestoneById(W,v){return this.http.put(`${this.strapi_url}api/milestones/${W}`,v,this.options)}deleteMilestoneById(W){return this.http.delete(`${this.strapi_url}api/milestones/${W}`,this.options)}}return F.\u0275fac=function(W){return new(W||F)(z.LFG(le.eN))},F.\u0275prov=z.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},8964:(Ee,fe,L)=>{L.d(fe,{$:()=>F});var O=L(5861),z=L(4464),le=L(5e3),K=L(6858);let F=(()=>{class J{constructor(v){this.httpService=v,this.allMilestones=[]}addNewMilestone(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.addNewMilestone(v))})()}getMilestoneList(){var v=this;return(0,O.Z)(function*(){v.allMilestones=yield(0,z.n)(v.httpService.getMilestoneList())})()}getMilestoneById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getMilestoneById(v))})()}getAllDetailsMilestoneById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getAllDetailsMilestoneById(v))})()}getFilteredMilestoneList(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getFilteredMilestoneList(v))})()}updateMilestoneById(v,A){var Q=this;return(0,O.Z)(function*(){return yield(0,z.n)(Q.httpService.updateMilestoneById(v,A))})()}deleteMilestoneById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.deleteMilestoneById(v))})()}getCustomFilterList(v){return"All"===v?this.allMilestones:this.allMilestones.filter(A=>A.status==v)}}return J.\u0275fac=function(v){return new(v||J)(le.LFG(K.O))},J.\u0275prov=le.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},9565:(Ee,fe,L)=>{L.d(fe,{f:()=>K});var O=L(2626),z=L(5e3),le=L(9808);let K=(()=>{class F{constructor(W,v){this.router=W,this.location=v,this.history=[],this.history.push(this.router.url),this.router.events.subscribe(A=>{A instanceof O.m2&&this.history.push(A.urlAfterRedirects)})}back(){this.history.pop(),this.history.length>0?this.location.back():this.router.navigateByUrl("/")}}return F.\u0275fac=function(W){return new(W||F)(z.LFG(O.F0),z.LFG(le.Ye))},F.\u0275prov=z.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},9854:(Ee,fe,L)=>{L.d(fe,{s:()=>F});var O=L(5861),z=L(4464),le=L(5e3),K=L(6858);let F=(()=>{class J{constructor(v){this.httpService=v,this.allRequests=[]}addNewRequest(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.addNewRequest({data:v}))})()}getAllRequestList(){var v=this;return(0,O.Z)(function*(){v.allRequests=yield(0,z.n)(v.httpService.getRequestList())})()}getRequestById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getRequestById(v))})()}getAllDetailsRequestById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getAllDetailsRequestById(v))})()}getUnlinkedRequestList(){var v=this;return(0,O.Z)(function*(){return yield(0,z.n)(v.httpService.getUnlinkedRequestList())})()}getFilteredRequestList(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getFilteredRequestList(v))})()}updateRequestById(v,A){var Q=this;return(0,O.Z)(function*(){return yield(0,z.n)(Q.httpService.updateRequestById(v,A))})()}deleteRequestById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.deleteRequestById(v))})()}getCustomFilterList(v){return"All"===v?this.allRequests:this.allRequests.filter(A=>A.status==v)}getRequest(v){let Q=v.data.attributes;return Q.id=v.data.id,console.log(Q),Q}}return J.\u0275fac=function(v){return new(v||J)(le.LFG(K.O))},J.\u0275prov=le.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},6138:(Ee,fe,L)=>{L.d(fe,{M:()=>F});var O=L(5861),z=L(4464),le=L(5e3),K=L(6858);let F=(()=>{class J{constructor(v){this.httpService=v,this.allTasks=[]}addNewTask(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.addNewTask(v))})()}getTaskList(){var v=this;return(0,O.Z)(function*(){v.allTasks=yield(0,z.n)(v.httpService.getTaskList())})()}getTaskById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getTaskById(v))})()}getAllDetailsTaskById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getAllDetailsTaskById(v))})()}getUnlinkedTaskList(){var v=this;return(0,O.Z)(function*(){return yield(0,z.n)(v.httpService.getUnlinkedTasks())})()}getFilteredTaskList(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.getFilteredTaskList(v))})()}updateTaskById(v,A){var Q=this;return(0,O.Z)(function*(){return yield(0,z.n)(Q.httpService.updateTaskById(v,A))})()}deleteTaskById(v){var A=this;return(0,O.Z)(function*(){return yield(0,z.n)(A.httpService.deleteTaskById(v))})()}getCustomFilterList(v){return"All"===v?this.allTasks:this.allTasks.filter(A=>A.status==v)}}return J.\u0275fac=function(v){return new(v||J)(le.LFG(K.O))},J.\u0275prov=le.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},8769:(Ee,fe,L)=>{L.r(fe),L.d(fe,{addMentionNodes:()=>Q,addTagNodes:()=>de,getMentionsPlugin:()=>W,mentionNode:()=>v,tagNode:()=>A});var O=L(6956),z=L(412);const F=(G=null,function(ne,ie,ue){return ue=ue||this,clearTimeout(G),G=setTimeout(function(){ne.apply(ue,arguments)},ie),G});var G;function W(ie){ie=Object.assign({},{mentionTrigger:"@",hashtagTrigger:"#",allowSpace:!0,getSuggestions:(se,Z,ae)=>{ae([])},getSuggestionsHTML:se=>'<div class="suggestion-item-list">'+se.map(Z=>'<div class="suggestion-item">'+Z.name+"</div>").join("")+"</div>",activeClass:"suggestion-item-active",suggestionTextClass:"prosemirror-suggestion",maxNoOfSuggestions:10,delay:500},ie);var ue=null,ee=document.createElement("div"),pe=function(){ee.style.display="none"},oe=function(se,Z){ee.querySelector(".suggestion-item-list").childNodes[se].classList.remove(Z)},me=function(se,Z){ee.querySelector(".suggestion-item-list").childNodes[se].classList.add(Z)},xe=function(se,Z,ae){oe(Z.index,ae.activeClass),Z.index=se,me(Z.index,ae.activeClass)},De=function(se,Z,ae){var ye=Z.suggestions[Z.index],$=se.state.schema.nodes[Z.type].create("mention"===Z.type?{name:ye.name,id:ye.id,email:ye.email}:{tag:ye.tag}),S=se.state.tr.replaceWith(Z.range.from,Z.range.to,$);se.dispatch(S)};return new O.Sy({key:new O.H$("autosuggestions"),state:{init:()=>({active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0}),apply(se,Z){var ae={active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0},ye=se.selection;if(ye.from!==ye.to)return ae;const $=function K(G,ne){var ie=G.before();const ue=G.doc.textBetween(ie,G.pos,"\n","\0");var me,ee=function le(G,ne,ie){return{mention:ie?new RegExp("(^|\\s)"+G+"([\\w-\\+]+\\s?[\\w-\\+]*)$"):new RegExp("(^|\\s)"+G+"([\\w-\\+]+)$"),tag:new RegExp("(^|\\s)"+ne+"([\\w-]+)$")}}(ne.mentionTrigger,ne.hashtagTrigger,ne.allowSpace),Oe=ue.match(ee.mention),pe=ue.match(ee.tag),oe=Oe||pe;if(Oe?me="mention":pe&&(me="tag"),oe){oe.index=oe[0].startsWith(" ")?oe.index+1:oe.index,oe[0]=oe[0].startsWith(" ")?oe[0].substring(1,oe[0].length):oe[0];var xe=G.start()+oe.index;return{range:{from:xe,to:xe+oe[0].length},queryText:oe[2],type:me}}}(ye.$from,ie);return $&&(ae.active=!0,ae.range=$.range,ae.type=$.type,ae.text=$.queryText),ae}},props:{handleKeyDown(se,Z){var be,$,S,ae=this.getState(se.state);return!(!ae.active&&!ae.suggestions.length||($=13===Z.keyCode,be=38===Z.keyCode,S=27===Z.keyCode,40===Z.keyCode?(function(se,Z,ae){oe(Z.index,ae.activeClass),Z.index++,Z.index=Z.index===Z.suggestions.length?0:Z.index,me(Z.index,ae.activeClass)}(0,ae,ie),0):be?(function(se,Z,ae){oe(Z.index,ae.activeClass),Z.index--,Z.index=-1===Z.index?Z.suggestions.length-1:Z.index,me(Z.index,ae.activeClass)}(0,ae,ie),0):$?(De(se,ae),0):!S||(clearTimeout(ue),pe(),this.state={active:!1,range:{from:0,to:0},type:"",text:"",suggestions:[],index:0},0)))},decorations(se){const{active:Z,range:ae}=this.getState(se);return Z?z.EH.create(se.doc,[z.p.inline(ae.from,ae.to,{nodeName:"span",class:ie.suggestionTextClass})]):null}},view(){return{update:se=>{var Z=this.key.getState(se.state);if(!Z.text)return pe(),void clearTimeout(ue);ue=F(function(){ie.getSuggestions(Z.type,Z.text,function(ae){Z.suggestions=ae,function(se,Z,ae,ye){ee.innerHTML=ye.getSuggestionsHTML(ae,Z.type),ee.querySelectorAll(".suggestion-item").forEach(function(q,Y){q.addEventListener("click",function(){De(se,Z),se.focus()}),q.addEventListener("mouseover",function(){xe(Y,Z,ye)}),q.addEventListener("mouseout",function(){xe(Y,Z,ye)})}),me(Z.index,ye.activeClass);var S=se.domAtPos(se.state.selection.$from.pos).node.querySelector("."+ye.suggestionTextClass),E=S.getBoundingClientRect();document.body.appendChild(ee),ee.classList.add("suggestion-item-container"),ee.style.position="fixed",ee.style.left=E.left+"px",ee.style.top=S.offsetHeight+E.top+"px",ee.style.display="block",ee.style.zIndex="999999"}(se,Z,ae,ie)})},ie.delay,this)}}}})}const v={group:"inline",inline:!0,atom:!0,attrs:{id:"",name:"",email:""},selectable:!1,draggable:!1,toDOM:G=>["span",{"data-mention-id":G.attrs.id,"data-mention-name":G.attrs.name,"data-mention-email":G.attrs.email,class:"prosemirror-mention-node"},"@"+G.attrs.name||0],parseDOM:[{tag:"span[data-mention-id][data-mention-name][data-mention-email]",getAttrs:G=>({id:G.getAttribute("data-mention-id"),name:G.getAttribute("data-mention-name"),email:G.getAttribute("data-mention-email")})}]},A={group:"inline",inline:!0,atom:!0,attrs:{tag:""},selectable:!1,draggable:!1,toDOM:G=>["span",{"data-tag":G.attrs.tag,class:"prosemirror-tag-node"},"#"+G.attrs.tag],parseDOM:[{tag:"span[data-tag]",getAttrs:G=>({tag:G.getAttribute("data-tag")})}]};function Q(G){return G.append({mention:v})}function de(G){return G.append({tag:A})}},4464:(Ee,fe,L)=>{L.d(fe,{n:()=>z});var O=L(6805);function z(le,K){const F="object"==typeof K;return new Promise((J,W)=>{let A,v=!1;le.subscribe({next:Q=>{A=Q,v=!0},error:W,complete:()=>{v?J(A):F?J(K.defaultValue):W(new O.K)}})})}},8197:(Ee,fe,L)=>{function O(y){this.content=y}L.d(fe,{aw:()=>ze,PW:()=>H,HY:()=>F,vc:()=>A,ZU:()=>we,NB:()=>$,Ts:()=>ye,e4:()=>Q,V_:()=>kt,p2:()=>de}),O.prototype={constructor:O,find:function(y){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===y)return i;return-1},get:function(y){var i=this.find(y);return-1==i?void 0:this.content[i+1]},update:function(y,i,s){var a=s&&s!=y?this.remove(s):this,d=a.find(y),p=a.content.slice();return-1==d?p.push(s||y,i):(p[d+1]=i,s&&(p[d]=s)),new O(p)},remove:function(y){var i=this.find(y);if(-1==i)return this;var s=this.content.slice();return s.splice(i,2),new O(s)},addToStart:function(y,i){return new O([y,i].concat(this.remove(y).content))},addToEnd:function(y,i){var s=this.remove(y).content.slice();return s.push(y,i),new O(s)},addBefore:function(y,i,s){var a=this.remove(i),d=a.content.slice(),p=a.find(y);return d.splice(-1==p?d.length:p,0,i,s),new O(d)},forEach:function(y){for(var i=0;i<this.content.length;i+=2)y(this.content[i],this.content[i+1])},prepend:function(y){return(y=O.from(y)).size?new O(y.content.concat(this.subtract(y).content)):this},append:function(y){return(y=O.from(y)).size?new O(this.subtract(y).content.concat(y.content)):this},subtract:function(y){var i=this;y=O.from(y);for(var s=0;s<y.content.length;s+=2)i=i.remove(y.content[s]);return i},get size(){return this.content.length>>1}},O.from=function(y){if(y instanceof O)return y;var i=[];if(y)for(var s in y)i.push(s,y[s]);return new O(i)};const z=O;function le(y,i,s){for(let a=0;;a++){if(a==y.childCount||a==i.childCount)return y.childCount==i.childCount?null:s;let d=y.child(a),p=i.child(a);if(d!=p){if(!d.sameMarkup(p))return s;if(d.isText&&d.text!=p.text){for(let x=0;d.text[x]==p.text[x];x++)s++;return s}if(d.content.size||p.content.size){let x=le(d.content,p.content,s+1);if(null!=x)return x}s+=d.nodeSize}else s+=d.nodeSize}}function K(y,i,s,a){for(let d=y.childCount,p=i.childCount;;){if(0==d||0==p)return d==p?null:{a:s,b:a};let x=y.child(--d),N=i.child(--p),_=x.nodeSize;if(x!=N){if(!x.sameMarkup(N))return{a:s,b:a};if(x.isText&&x.text!=N.text){let X=0,re=Math.min(x.text.length,N.text.length);for(;X<re&&x.text[x.text.length-X-1]==N.text[N.text.length-X-1];)X++,s--,a--;return{a:s,b:a}}if(x.content.size||N.content.size){let X=K(x.content,N.content,s-1,a-1);if(X)return X}s-=_,a-=_}else s-=_,a-=_}}class F{constructor(i,s){if(this.content=i,this.size=s||0,null==s)for(let a=0;a<i.length;a++)this.size+=i[a].nodeSize}nodesBetween(i,s,a,d=0,p){for(let x=0,N=0;N<s;x++){let _=this.content[x],X=N+_.nodeSize;if(X>i&&!1!==a(_,d+N,p||null,x)&&_.content.size){let re=N+1;_.nodesBetween(Math.max(0,i-re),Math.min(_.content.size,s-re),a,d+re)}N=X}}descendants(i){this.nodesBetween(0,this.size,i)}textBetween(i,s,a,d){let p="",x=!0;return this.nodesBetween(i,s,(N,_)=>{N.isText?(p+=N.text.slice(Math.max(i,_)-_,s-_),x=!a):N.isLeaf?(d?p+="function"==typeof d?d(N):d:N.type.spec.leafText&&(p+=N.type.spec.leafText(N)),x=!a):!x&&N.isBlock&&(p+=a,x=!0)},0),p}append(i){if(!i.size)return this;if(!this.size)return i;let s=this.lastChild,a=i.firstChild,d=this.content.slice(),p=0;for(s.isText&&s.sameMarkup(a)&&(d[d.length-1]=s.withText(s.text+a.text),p=1);p<i.content.length;p++)d.push(i.content[p]);return new F(d,this.size+i.size)}cut(i,s=this.size){if(0==i&&s==this.size)return this;let a=[],d=0;if(s>i)for(let p=0,x=0;x<s;p++){let N=this.content[p],_=x+N.nodeSize;_>i&&((x<i||_>s)&&(N=N.isText?N.cut(Math.max(0,i-x),Math.min(N.text.length,s-x)):N.cut(Math.max(0,i-x-1),Math.min(N.content.size,s-x-1))),a.push(N),d+=N.nodeSize),x=_}return new F(a,d)}cutByIndex(i,s){return i==s?F.empty:0==i&&s==this.content.length?this:new F(this.content.slice(i,s))}replaceChild(i,s){let a=this.content[i];if(a==s)return this;let d=this.content.slice(),p=this.size+s.nodeSize-a.nodeSize;return d[i]=s,new F(d,p)}addToStart(i){return new F([i].concat(this.content),this.size+i.nodeSize)}addToEnd(i){return new F(this.content.concat(i),this.size+i.nodeSize)}eq(i){if(this.content.length!=i.content.length)return!1;for(let s=0;s<this.content.length;s++)if(!this.content[s].eq(i.content[s]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(i){let s=this.content[i];if(!s)throw new RangeError("Index "+i+" out of range for "+this);return s}maybeChild(i){return this.content[i]||null}forEach(i){for(let s=0,a=0;s<this.content.length;s++){let d=this.content[s];i(d,a,s),a+=d.nodeSize}}findDiffStart(i,s=0){return le(this,i,s)}findDiffEnd(i,s=this.size,a=i.size){return K(this,i,s,a)}findIndex(i,s=-1){if(0==i)return W(0,i);if(i==this.size)return W(this.content.length,i);if(i>this.size||i<0)throw new RangeError(`Position ${i} outside of fragment (${this})`);for(let a=0,d=0;;a++){let x=d+this.child(a).nodeSize;if(x>=i)return x==i||s>0?W(a+1,x):W(a,d);d=x}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(i=>i.toJSON()):null}static fromJSON(i,s){if(!s)return F.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new F(s.map(i.nodeFromJSON))}static fromArray(i){if(!i.length)return F.empty;let s,a=0;for(let d=0;d<i.length;d++){let p=i[d];a+=p.nodeSize,d&&p.isText&&i[d-1].sameMarkup(p)?(s||(s=i.slice(0,d)),s[s.length-1]=p.withText(s[s.length-1].text+p.text)):s&&s.push(p)}return new F(s||i,a)}static from(i){if(!i)return F.empty;if(i instanceof F)return i;if(Array.isArray(i))return this.fromArray(i);if(i.attrs)return new F([i],i.nodeSize);throw new RangeError("Can not convert "+i+" to a Fragment"+(i.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}F.empty=new F([],0);const J={index:0,offset:0};function W(y,i){return J.index=y,J.offset=i,J}function v(y,i){if(y===i)return!0;if(!y||"object"!=typeof y||!i||"object"!=typeof i)return!1;let s=Array.isArray(y);if(Array.isArray(i)!=s)return!1;if(s){if(y.length!=i.length)return!1;for(let a=0;a<y.length;a++)if(!v(y[a],i[a]))return!1}else{for(let a in y)if(!(a in i)||!v(y[a],i[a]))return!1;for(let a in i)if(!(a in y))return!1}return!0}let A=(()=>{class y{constructor(s,a){this.type=s,this.attrs=a}addToSet(s){let a,d=!1;for(let p=0;p<s.length;p++){let x=s[p];if(this.eq(x))return s;if(this.type.excludes(x.type))a||(a=s.slice(0,p));else{if(x.type.excludes(this.type))return s;!d&&x.type.rank>this.type.rank&&(a||(a=s.slice(0,p)),a.push(this),d=!0),a&&a.push(x)}}return a||(a=s.slice()),d||a.push(this),a}removeFromSet(s){for(let a=0;a<s.length;a++)if(this.eq(s[a]))return s.slice(0,a).concat(s.slice(a+1));return s}isInSet(s){for(let a=0;a<s.length;a++)if(this.eq(s[a]))return!0;return!1}eq(s){return this==s||this.type==s.type&&v(this.attrs,s.attrs)}toJSON(){let s={type:this.type.name};for(let a in this.attrs){s.attrs=this.attrs;break}return s}static fromJSON(s,a){if(!a)throw new RangeError("Invalid input for Mark.fromJSON");let d=s.marks[a.type];if(!d)throw new RangeError(`There is no mark type ${a.type} in this schema`);return d.create(a.attrs)}static sameSet(s,a){if(s==a)return!0;if(s.length!=a.length)return!1;for(let d=0;d<s.length;d++)if(!s[d].eq(a[d]))return!1;return!0}static setFrom(s){if(!s||Array.isArray(s)&&0==s.length)return y.none;if(s instanceof y)return[s];let a=s.slice();return a.sort((d,p)=>d.type.rank-p.type.rank),a}}return y.none=[],y})();class Q extends Error{}class de{constructor(i,s,a){this.content=i,this.openStart=s,this.openEnd=a}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(i,s){let a=ne(this.content,i+this.openStart,s);return a&&new de(a,this.openStart,this.openEnd)}removeBetween(i,s){return new de(G(this.content,i+this.openStart,s+this.openStart),this.openStart,this.openEnd)}eq(i){return this.content.eq(i.content)&&this.openStart==i.openStart&&this.openEnd==i.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let i={content:this.content.toJSON()};return this.openStart>0&&(i.openStart=this.openStart),this.openEnd>0&&(i.openEnd=this.openEnd),i}static fromJSON(i,s){if(!s)return de.empty;let a=s.openStart||0,d=s.openEnd||0;if("number"!=typeof a||"number"!=typeof d)throw new RangeError("Invalid input for Slice.fromJSON");return new de(F.fromJSON(i,s.content),a,d)}static maxOpen(i,s=!0){let a=0,d=0;for(let p=i.firstChild;p&&!p.isLeaf&&(s||!p.type.spec.isolating);p=p.firstChild)a++;for(let p=i.lastChild;p&&!p.isLeaf&&(s||!p.type.spec.isolating);p=p.lastChild)d++;return new de(i,a,d)}}function G(y,i,s){let{index:a,offset:d}=y.findIndex(i),p=y.maybeChild(a),{index:x,offset:N}=y.findIndex(s);if(d==i||p.isText){if(N!=s&&!y.child(x).isText)throw new RangeError("Removing non-flat range");return y.cut(0,i).append(y.cut(s))}if(a!=x)throw new RangeError("Removing non-flat range");return y.replaceChild(a,p.copy(G(p.content,i-d-1,s-d-1)))}function ne(y,i,s,a){let{index:d,offset:p}=y.findIndex(i),x=y.maybeChild(d);if(p==i||x.isText)return a&&!a.canReplace(d,d,s)?null:y.cut(0,i).append(s).append(y.cut(i));let N=ne(x.content,i-p-1,s);return N&&y.replaceChild(d,x.copy(N))}function ie(y,i,s){if(s.openStart>y.depth)throw new Q("Inserted content deeper than insertion position");if(y.depth-s.openStart!=i.depth-s.openEnd)throw new Q("Inconsistent open depths");return ue(y,i,s,0)}function ue(y,i,s,a){let d=y.index(a),p=y.node(a);if(d==i.index(a)&&a<y.depth-s.openStart){let x=ue(y,i,s,a+1);return p.copy(p.content.replaceChild(d,x))}if(s.content.size){if(s.openStart||s.openEnd||y.depth!=a||i.depth!=a){let{start:x,end:N}=function Ie(y,i){let s=i.depth-y.openStart,d=i.node(s).copy(y.content);for(let p=s-1;p>=0;p--)d=i.node(p).copy(F.from(d));return{start:d.resolveNoCache(y.openStart+s),end:d.resolveNoCache(d.content.size-y.openEnd-s)}}(s,y);return me(p,xe(y,x,N,i,a))}{let x=y.parent,N=x.content;return me(x,N.cut(0,y.parentOffset).append(s.content).append(N.cut(i.parentOffset)))}}return me(p,Me(y,i,a))}function ee(y,i){if(!i.type.compatibleContent(y.type))throw new Q("Cannot join "+i.type.name+" onto "+y.type.name)}function Oe(y,i,s){let a=y.node(s);return ee(a,i.node(s)),a}function pe(y,i){let s=i.length-1;s>=0&&y.isText&&y.sameMarkup(i[s])?i[s]=y.withText(i[s].text+y.text):i.push(y)}function oe(y,i,s,a){let d=(i||y).node(s),p=0,x=i?i.index(s):d.childCount;y&&(p=y.index(s),y.depth>s?p++:y.textOffset&&(pe(y.nodeAfter,a),p++));for(let N=p;N<x;N++)pe(d.child(N),a);i&&i.depth==s&&i.textOffset&&pe(i.nodeBefore,a)}function me(y,i){if(!y.type.validContent(i))throw new Q("Invalid content for node "+y.type.name);return y.copy(i)}function xe(y,i,s,a,d){let p=y.depth>d&&Oe(y,i,d+1),x=a.depth>d&&Oe(s,a,d+1),N=[];return oe(null,y,d,N),p&&x&&i.index(d)==s.index(d)?(ee(p,x),pe(me(p,xe(y,i,s,a,d+1)),N)):(p&&pe(me(p,Me(y,i,d+1)),N),oe(i,s,d,N),x&&pe(me(x,Me(s,a,d+1)),N)),oe(a,null,d,N),new F(N)}function Me(y,i,s){let a=[];return oe(null,y,s,a),y.depth>s&&pe(me(Oe(y,i,s+1),Me(y,i,s+1)),a),oe(i,null,s,a),new F(a)}de.empty=new de(F.empty,0,0);class De{constructor(i,s,a){this.pos=i,this.path=s,this.parentOffset=a,this.depth=s.length/3-1}resolveDepth(i){return null==i?this.depth:i<0?this.depth+i:i}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(i){return this.path[3*this.resolveDepth(i)]}index(i){return this.path[3*this.resolveDepth(i)+1]}indexAfter(i){return i=this.resolveDepth(i),this.index(i)+(i!=this.depth||this.textOffset?1:0)}start(i){return 0==(i=this.resolveDepth(i))?0:this.path[3*i-1]+1}end(i){return i=this.resolveDepth(i),this.start(i)+this.node(i).content.size}before(i){if(!(i=this.resolveDepth(i)))throw new RangeError("There is no position before the top-level node");return i==this.depth+1?this.pos:this.path[3*i-1]}after(i){if(!(i=this.resolveDepth(i)))throw new RangeError("There is no position after the top-level node");return i==this.depth+1?this.pos:this.path[3*i-1]+this.path[3*i].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let i=this.parent,s=this.index(this.depth);if(s==i.childCount)return null;let a=this.pos-this.path[this.path.length-1],d=i.child(s);return a?i.child(s).cut(a):d}get nodeBefore(){let i=this.index(this.depth),s=this.pos-this.path[this.path.length-1];return s?this.parent.child(i).cut(0,s):0==i?null:this.parent.child(i-1)}posAtIndex(i,s){s=this.resolveDepth(s);let a=this.path[3*s],d=0==s?0:this.path[3*s-1]+1;for(let p=0;p<i;p++)d+=a.child(p).nodeSize;return d}marks(){let i=this.parent,s=this.index();if(0==i.content.size)return A.none;if(this.textOffset)return i.child(s).marks;let a=i.maybeChild(s-1),d=i.maybeChild(s);if(!a){let N=a;a=d,d=N}let p=a.marks;for(var x=0;x<p.length;x++)!1===p[x].type.spec.inclusive&&(!d||!p[x].isInSet(d.marks))&&(p=p[x--].removeFromSet(p));return p}marksAcross(i){let s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;let a=s.marks,d=i.parent.maybeChild(i.index());for(var p=0;p<a.length;p++)!1===a[p].type.spec.inclusive&&(!d||!a[p].isInSet(d.marks))&&(a=a[p--].removeFromSet(a));return a}sharedDepth(i){for(let s=this.depth;s>0;s--)if(this.start(s)<=i&&this.end(s)>=i)return s;return 0}blockRange(i=this,s){if(i.pos<this.pos)return i.blockRange(this);for(let a=this.depth-(this.parent.inlineContent||this.pos==i.pos?1:0);a>=0;a--)if(i.pos<=this.end(a)&&(!s||s(this.node(a))))return new ye(this,i,a);return null}sameParent(i){return this.pos-this.parentOffset==i.pos-i.parentOffset}max(i){return i.pos>this.pos?i:this}min(i){return i.pos<this.pos?i:this}toString(){let i="";for(let s=1;s<=this.depth;s++)i+=(i?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return i+":"+this.parentOffset}static resolve(i,s){if(!(s>=0&&s<=i.content.size))throw new RangeError("Position "+s+" out of range");let a=[],d=0,p=s;for(let x=i;;){let{index:N,offset:_}=x.content.findIndex(p),X=p-_;if(a.push(x,N,d+_),!X||(x=x.child(N),x.isText))break;p=X-1,d+=_+1}return new De(s,a,p)}static resolveCached(i,s){for(let d=0;d<se.length;d++){let p=se[d];if(p.pos==s&&p.doc==i)return p}let a=se[Z]=De.resolve(i,s);return Z=(Z+1)%ae,a}}let se=[],Z=0,ae=12;class ye{constructor(i,s,a){this.$from=i,this.$to=s,this.depth=a}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const be=Object.create(null);class ${constructor(i,s,a,d=A.none){this.type=i,this.attrs=s,this.marks=d,this.content=a||F.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(i){return this.content.child(i)}maybeChild(i){return this.content.maybeChild(i)}forEach(i){this.content.forEach(i)}nodesBetween(i,s,a,d=0){this.content.nodesBetween(i,s,a,d,this)}descendants(i){this.nodesBetween(0,this.content.size,i)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(i,s,a,d){return this.content.textBetween(i,s,a,d)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(i){return this==i||this.sameMarkup(i)&&this.content.eq(i.content)}sameMarkup(i){return this.hasMarkup(i.type,i.attrs,i.marks)}hasMarkup(i,s,a){return this.type==i&&v(this.attrs,s||i.defaultAttrs||be)&&A.sameSet(this.marks,a||A.none)}copy(i=null){return i==this.content?this:new $(this.type,this.attrs,i,this.marks)}mark(i){return i==this.marks?this:new $(this.type,this.attrs,this.content,i)}cut(i,s=this.content.size){return 0==i&&s==this.content.size?this:this.copy(this.content.cut(i,s))}slice(i,s=this.content.size,a=!1){if(i==s)return de.empty;let d=this.resolve(i),p=this.resolve(s),x=a?0:d.sharedDepth(s),N=d.start(x),X=d.node(x).content.cut(d.pos-N,p.pos-N);return new de(X,d.depth-x,p.depth-x)}replace(i,s,a){return ie(this.resolve(i),this.resolve(s),a)}nodeAt(i){for(let s=this;;){let{index:a,offset:d}=s.content.findIndex(i);if(s=s.maybeChild(a),!s)return null;if(d==i||s.isText)return s;i-=d+1}}childAfter(i){let{index:s,offset:a}=this.content.findIndex(i);return{node:this.content.maybeChild(s),index:s,offset:a}}childBefore(i){if(0==i)return{node:null,index:0,offset:0};let{index:s,offset:a}=this.content.findIndex(i);if(a<i)return{node:this.content.child(s),index:s,offset:a};let d=this.content.child(s-1);return{node:d,index:s-1,offset:a-d.nodeSize}}resolve(i){return De.resolveCached(this,i)}resolveNoCache(i){return De.resolve(this,i)}rangeHasMark(i,s,a){let d=!1;return s>i&&this.nodesBetween(i,s,p=>(a.isInSet(p.marks)&&(d=!0),!d)),d}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let i=this.type.name;return this.content.size&&(i+="("+this.content.toStringInner()+")"),E(this.marks,i)}contentMatchAt(i){let s=this.type.contentMatch.matchFragment(this.content,0,i);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s}canReplace(i,s,a=F.empty,d=0,p=a.childCount){let x=this.contentMatchAt(i).matchFragment(a,d,p),N=x&&x.matchFragment(this.content,s);if(!N||!N.validEnd)return!1;for(let _=d;_<p;_++)if(!this.type.allowsMarks(a.child(_).marks))return!1;return!0}canReplaceWith(i,s,a,d){if(d&&!this.type.allowsMarks(d))return!1;let p=this.contentMatchAt(i).matchType(a),x=p&&p.matchFragment(this.content,s);return!!x&&x.validEnd}canAppend(i){return i.content.size?this.canReplace(this.childCount,this.childCount,i.content):this.type.compatibleContent(i.type)}check(){if(!this.type.validContent(this.content))throw new RangeError(`Invalid content for node ${this.type.name}: ${this.content.toString().slice(0,50)}`);let i=A.none;for(let s=0;s<this.marks.length;s++)i=this.marks[s].addToSet(i);if(!A.sameSet(i,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(s=>s.type.name)}`);this.content.forEach(s=>s.check())}toJSON(){let i={type:this.type.name};for(let s in this.attrs){i.attrs=this.attrs;break}return this.content.size&&(i.content=this.content.toJSON()),this.marks.length&&(i.marks=this.marks.map(s=>s.toJSON())),i}static fromJSON(i,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");let a=null;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=s.marks.map(i.markFromJSON)}if("text"==s.type){if("string"!=typeof s.text)throw new RangeError("Invalid text node in JSON");return i.text(s.text,a)}let d=F.fromJSON(i,s.content);return i.nodeType(s.type).create(s.attrs,d,a)}}$.prototype.text=void 0;class S extends ${constructor(i,s,a,d){if(super(i,s,null,d),!a)throw new RangeError("Empty text nodes are not allowed");this.text=a}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):E(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(i,s){return this.text.slice(i,s)}get nodeSize(){return this.text.length}mark(i){return i==this.marks?this:new S(this.type,this.attrs,this.text,i)}withText(i){return i==this.text?this:new S(this.type,this.attrs,i,this.marks)}cut(i=0,s=this.text.length){return 0==i&&s==this.text.length?this:this.withText(this.text.slice(i,s))}eq(i){return this.sameMarkup(i)&&this.text==i.text}toJSON(){let i=super.toJSON();return i.text=this.text,i}}function E(y,i){for(let s=y.length-1;s>=0;s--)i=y[s].type.name+"("+i+")";return i}class w{constructor(i){this.validEnd=i,this.next=[],this.wrapCache=[]}static parse(i,s){let a=new q(i,s);if(null==a.next)return w.empty;let d=Y(a);a.next&&a.err("Unexpected trailing text");let p=function ut(y){let i=Object.create(null);return function s(a){let d=[];a.forEach(x=>{y[x].forEach(({term:N,to:_})=>{if(!N)return;let X;for(let re=0;re<d.length;re++)d[re][0]==N&&(X=d[re][1]);nt(y,_).forEach(re=>{X||d.push([N,X=[]]),-1==X.indexOf(re)&&X.push(re)})})});let p=i[a.join(",")]=new w(a.indexOf(y.length-1)>-1);for(let x=0;x<d.length;x++){let N=d[x][1].sort(ct);p.next.push({type:d[x][0],next:i[N.join(",")]||s(N)})}return p}(nt(y,0))}(function Ue(y){let i=[[]];return d(function p(x,N){if("choice"==x.type)return x.exprs.reduce((_,X)=>_.concat(p(X,N)),[]);if("seq"!=x.type){if("star"==x.type){let _=s();return a(N,_),d(p(x.expr,_),_),[a(_)]}if("plus"==x.type){let _=s();return d(p(x.expr,N),_),d(p(x.expr,_),_),[a(_)]}if("opt"==x.type)return[a(N)].concat(p(x.expr,N));if("range"==x.type){let _=N;for(let X=0;X<x.min;X++){let re=s();d(p(x.expr,_),re),_=re}if(-1==x.max)d(p(x.expr,_),_);else for(let X=x.min;X<x.max;X++){let re=s();a(_,re),d(p(x.expr,_),re),_=re}return[a(_)]}if("name"==x.type)return[a(N,void 0,x.value)];throw new Error("Unknown expr type")}for(let _=0;;_++){let X=p(x.exprs[_],N);if(_==x.exprs.length-1)return X;d(X,N=s())}}(y,0),s()),i;function s(){return i.push([])-1}function a(x,N,_){let X={term:_,to:N};return i[x].push(X),X}function d(x,N){x.forEach(_=>_.to=N)}}(d));return function Ze(y,i){for(let s=0,a=[y];s<a.length;s++){let d=a[s],p=!d.validEnd,x=[];for(let N=0;N<d.next.length;N++){let{type:_,next:X}=d.next[N];x.push(_.name),p&&!(_.isText||_.hasRequiredAttrs())&&(p=!1),-1==a.indexOf(X)&&a.push(X)}p&&i.err("Only non-generatable nodes ("+x.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(p,a),p}matchType(i){for(let s=0;s<this.next.length;s++)if(this.next[s].type==i)return this.next[s].next;return null}matchFragment(i,s=0,a=i.childCount){let d=this;for(let p=s;d&&p<a;p++)d=d.matchType(i.child(p).type);return d}get inlineContent(){return this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type:s}=this.next[i];if(!s.isText&&!s.hasRequiredAttrs())return s}return null}compatible(i){for(let s=0;s<this.next.length;s++)for(let a=0;a<i.next.length;a++)if(this.next[s].type==i.next[a].type)return!0;return!1}fillBefore(i,s=!1,a=0){let d=[this];return function p(x,N){let _=x.matchFragment(i,a);if(_&&(!s||_.validEnd))return F.from(N.map(X=>X.createAndFill()));for(let X=0;X<x.next.length;X++){let{type:re,next:Pe}=x.next[X];if(!re.isText&&!re.hasRequiredAttrs()&&-1==d.indexOf(Pe)){d.push(Pe);let rt=p(Pe,N.concat(re));if(rt)return rt}}return null}(this,[])}findWrapping(i){for(let a=0;a<this.wrapCache.length;a+=2)if(this.wrapCache[a]==i)return this.wrapCache[a+1];let s=this.computeWrapping(i);return this.wrapCache.push(i,s),s}computeWrapping(i){let s=Object.create(null),a=[{match:this,type:null,via:null}];for(;a.length;){let d=a.shift(),p=d.match;if(p.matchType(i)){let x=[];for(let N=d;N.type;N=N.via)x.push(N.type);return x.reverse()}for(let x=0;x<p.next.length;x++){let{type:N,next:_}=p.next[x];!N.isLeaf&&!N.hasRequiredAttrs()&&!(N.name in s)&&(!d.type||_.validEnd)&&(a.push({match:N.contentMatch,type:N,via:d}),s[N.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(i){if(i>=this.next.length)throw new RangeError(`There's no ${i}th edge in this content match`);return this.next[i]}toString(){let i=[];return function s(a){i.push(a);for(let d=0;d<a.next.length;d++)-1==i.indexOf(a.next[d].next)&&s(a.next[d].next)}(this),i.map((a,d)=>{let p=d+(a.validEnd?"*":" ")+" ";for(let x=0;x<a.next.length;x++)p+=(x?", ":"")+a.next[x].type.name+"->"+i.indexOf(a.next[x].next);return p}).join("\n")}}w.empty=new w(!0);class q{constructor(i,s){this.string=i,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=i.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(i){return this.next==i&&(this.pos++||!0)}err(i){throw new SyntaxError(i+" (in content expression '"+this.string+"')")}}function Y(y){let i=[];do{i.push(he(y))}while(y.eat("|"));return 1==i.length?i[0]:{type:"choice",exprs:i}}function he(y){let i=[];do{i.push(Se(y))}while(y.next&&")"!=y.next&&"|"!=y.next);return 1==i.length?i[0]:{type:"seq",exprs:i}}function Se(y){let i=function Ke(y){if(y.eat("(")){let i=Y(y);return y.eat(")")||y.err("Missing closing paren"),i}if(!/\W/.test(y.next)){let i=function Te(y,i){let s=y.nodeTypes,a=s[i];if(a)return[a];let d=[];for(let p in s){let x=s[p];x.groups.indexOf(i)>-1&&d.push(x)}return 0==d.length&&y.err("No node type or group '"+i+"' found"),d}(y,y.next).map(s=>(null==y.inline?y.inline=s.isInline:y.inline!=s.isInline&&y.err("Mixing inline and block content"),{type:"name",value:s}));return y.pos++,1==i.length?i[0]:{type:"choice",exprs:i}}y.err("Unexpected token '"+y.next+"'")}(y);for(;;)if(y.eat("+"))i={type:"plus",expr:i};else if(y.eat("*"))i={type:"star",expr:i};else if(y.eat("?"))i={type:"opt",expr:i};else{if(!y.eat("{"))break;i=ve(y,i)}return i}function Ce(y){/\D/.test(y.next)&&y.err("Expected number, got '"+y.next+"'");let i=Number(y.next);return y.pos++,i}function ve(y,i){let s=Ce(y),a=s;return y.eat(",")&&(a="}"!=y.next?Ce(y):-1),y.eat("}")||y.err("Unclosed braced range"),{type:"range",min:s,max:a,expr:i}}function ct(y,i){return i-y}function nt(y,i){let s=[];return function a(d){let p=y[d];if(1==p.length&&!p[0].term)return a(p[0].to);s.push(d);for(let x=0;x<p.length;x++){let{term:N,to:_}=p[x];!N&&-1==s.indexOf(_)&&a(_)}}(i),s.sort(ct)}function dt(y){let i=Object.create(null);for(let s in y){let a=y[s];if(!a.hasDefault)return null;i[s]=a.default}return i}function Je(y,i){let s=Object.create(null);for(let a in y){let d=i&&i[a];if(void 0===d){let p=y[a];if(!p.hasDefault)throw new RangeError("No value supplied for attribute "+a);d=p.default}s[a]=d}return s}function $e(y){let i=Object.create(null);if(y)for(let s in y)i[s]=new ft(y[s]);return i}class We{constructor(i,s,a){this.name=i,this.schema=s,this.spec=a,this.markSet=null,this.groups=a.group?a.group.split(" "):[],this.attrs=$e(a.attrs),this.defaultAttrs=dt(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(a.inline||"text"==i),this.isText="text"==i}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==w.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let i in this.attrs)if(this.attrs[i].isRequired)return!0;return!1}compatibleContent(i){return this==i||this.contentMatch.compatible(i.contentMatch)}computeAttrs(i){return!i&&this.defaultAttrs?this.defaultAttrs:Je(this.attrs,i)}create(i=null,s,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new $(this,this.computeAttrs(i),F.from(s),A.setFrom(a))}createChecked(i=null,s,a){if(s=F.from(s),!this.validContent(s))throw new RangeError("Invalid content for node "+this.name);return new $(this,this.computeAttrs(i),s,A.setFrom(a))}createAndFill(i=null,s,a){if(i=this.computeAttrs(i),(s=F.from(s)).size){let x=this.contentMatch.fillBefore(s);if(!x)return null;s=x.append(s)}let d=this.contentMatch.matchFragment(s),p=d&&d.fillBefore(F.empty,!0);return p?new $(this,i,s.append(p),A.setFrom(a)):null}validContent(i){let s=this.contentMatch.matchFragment(i);if(!s||!s.validEnd)return!1;for(let a=0;a<i.childCount;a++)if(!this.allowsMarks(i.child(a).marks))return!1;return!0}allowsMarkType(i){return null==this.markSet||this.markSet.indexOf(i)>-1}allowsMarks(i){if(null==this.markSet)return!0;for(let s=0;s<i.length;s++)if(!this.allowsMarkType(i[s].type))return!1;return!0}allowedMarks(i){if(null==this.markSet)return i;let s;for(let a=0;a<i.length;a++)this.allowsMarkType(i[a].type)?s&&s.push(i[a]):s||(s=i.slice(0,a));return s?s.length?s:A.none:i}static compile(i,s){let a=Object.create(null);i.forEach((p,x)=>a[p]=new We(p,s,x));let d=s.spec.topNode||"doc";if(!a[d])throw new RangeError("Schema is missing its top node type ('"+d+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(let p in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a}}class ft{constructor(i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default}get isRequired(){return!this.hasDefault}}class we{constructor(i,s,a,d){this.name=i,this.rank=s,this.schema=a,this.spec=d,this.attrs=$e(d.attrs),this.excluded=null;let p=dt(this.attrs);this.instance=p?new A(this,p):null}create(i=null){return!i&&this.instance?this.instance:new A(this,Je(this.attrs,i))}static compile(i,s){let a=Object.create(null),d=0;return i.forEach((p,x)=>a[p]=new we(p,d++,s,x)),a}removeFromSet(i){for(var s=0;s<i.length;s++)i[s].type==this&&(i=i.slice(0,s).concat(i.slice(s+1)),s--);return i}isInSet(i){for(let s=0;s<i.length;s++)if(i[s].type==this)return i[s]}excludes(i){return this.excluded.indexOf(i)>-1}}class kt{constructor(i){this.cached=Object.create(null),this.spec={nodes:z.from(i.nodes),marks:z.from(i.marks||{}),topNode:i.topNode},this.nodes=We.compile(this.spec.nodes,this),this.marks=we.compile(this.spec.marks,this);let s=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");let d=this.nodes[a],p=d.spec.content||"",x=d.spec.marks;d.contentMatch=s[p]||(s[p]=w.parse(p,this.nodes)),d.inlineContent=d.contentMatch.inlineContent,d.markSet="_"==x?null:x?it(this,x.split(" ")):""!=x&&d.inlineContent?null:[]}for(let a in this.marks){let d=this.marks[a],p=d.spec.excludes;d.excluded=null==p?[d]:""==p?[]:it(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(i,s=null,a,d){if("string"==typeof i)i=this.nodeType(i);else{if(!(i instanceof We))throw new RangeError("Invalid node type: "+i);if(i.schema!=this)throw new RangeError("Node type from different schema used ("+i.name+")")}return i.createChecked(s,a,d)}text(i,s){let a=this.nodes.text;return new S(a,a.defaultAttrs,i,A.setFrom(s))}mark(i,s){return"string"==typeof i&&(i=this.marks[i]),i.create(s)}nodeFromJSON(i){return $.fromJSON(this,i)}markFromJSON(i){return A.fromJSON(this,i)}nodeType(i){let s=this.nodes[i];if(!s)throw new RangeError("Unknown node type: "+i);return s}}function it(y,i){let s=[];for(let a=0;a<i.length;a++){let d=i[a],p=y.marks[d],x=p;if(p)s.push(p);else for(let N in y.marks){let _=y.marks[N];("_"==d||_.spec.group&&_.spec.group.split(" ").indexOf(d)>-1)&&s.push(x=_)}if(!x)throw new SyntaxError("Unknown mark type: '"+i[a]+"'")}return s}class ze{constructor(i,s){this.schema=i,this.rules=s,this.tags=[],this.styles=[],s.forEach(a=>{a.tag?this.tags.push(a):a.style&&this.styles.push(a)}),this.normalizeLists=!this.tags.some(a=>{if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;let d=i.nodes[a.node];return d.contentMatch.matchType(d)})}parse(i,s={}){let a=new f(this,s,!1);return a.addAll(i,s.from,s.to),a.finish()}parseSlice(i,s={}){let a=new f(this,s,!0);return a.addAll(i,s.from,s.to),de.maxOpen(a.finish())}matchTag(i,s,a){for(let d=a?this.tags.indexOf(a)+1:0;d<this.tags.length;d++){let p=this.tags[d];if(k(i,p.tag)&&(void 0===p.namespace||i.namespaceURI==p.namespace)&&(!p.context||s.matchesContext(p.context))){if(p.getAttrs){let x=p.getAttrs(i);if(!1===x)continue;p.attrs=x||void 0}return p}}}matchStyle(i,s,a,d){for(let p=d?this.styles.indexOf(d)+1:0;p<this.styles.length;p++){let x=this.styles[p],N=x.style;if(!(0!=N.indexOf(i)||x.context&&!a.matchesContext(x.context)||N.length>i.length&&(61!=N.charCodeAt(i.length)||N.slice(i.length+1)!=s))){if(x.getAttrs){let _=x.getAttrs(s);if(!1===_)continue;x.attrs=_||void 0}return x}}}static schemaRules(i){let s=[];function a(d){let p=null==d.priority?50:d.priority,x=0;for(;x<s.length;x++){let N=s[x];if((null==N.priority?50:N.priority)<p)break}s.splice(x,0,d)}for(let d in i.marks){let p=i.marks[d].spec.parseDOM;p&&p.forEach(x=>{a(x=T(x)),x.mark=d})}for(let d in i.nodes){let p=i.nodes[d].spec.parseDOM;p&&p.forEach(x=>{a(x=T(x)),x.node=d})}return s}static fromSchema(i){return i.cached.domParser||(i.cached.domParser=new ze(i,ze.schemaRules(i)))}}const Ye={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},pt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},mt={ol:!0,ul:!0};function D(y,i,s){return null!=i?(i?1:0)|("full"===i?2:0):y&&"pre"==y.whitespace?3:-5&s}class c{constructor(i,s,a,d,p,x,N){this.type=i,this.attrs=s,this.marks=a,this.pendingMarks=d,this.solid=p,this.options=N,this.content=[],this.activeMarks=A.none,this.stashMarks=[],this.match=x||(4&N?null:i.contentMatch)}findWrapping(i){if(!this.match){if(!this.type)return[];let s=this.type.contentMatch.fillBefore(F.from(i));if(!s){let d,a=this.type.contentMatch;return(d=a.findWrapping(i.type))?(this.match=a,d):null}this.match=this.type.contentMatch.matchFragment(s)}return this.match.findWrapping(i.type)}finish(i){if(!(1&this.options)){let d,a=this.content[this.content.length-1];if(a&&a.isText&&(d=/[ \t\r\n\u000c]+$/.exec(a.text))){let p=a;a.text.length==d[0].length?this.content.pop():this.content[this.content.length-1]=p.withText(p.text.slice(0,p.text.length-d[0].length))}}let s=F.from(this.content);return!i&&this.match&&(s=s.append(this.match.fillBefore(F.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}popFromStashMark(i){for(let s=this.stashMarks.length-1;s>=0;s--)if(i.eq(this.stashMarks[s]))return this.stashMarks.splice(s,1)[0]}applyPending(i){for(let s=0,a=this.pendingMarks;s<a.length;s++){let d=a[s];(this.type?this.type.allowsMarkType(d.type):R(d.type,i))&&!d.isInSet(this.activeMarks)&&(this.activeMarks=d.addToSet(this.activeMarks),this.pendingMarks=d.removeFromSet(this.pendingMarks))}}inlineContext(i){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:i.parentNode&&!Ye.hasOwnProperty(i.parentNode.nodeName.toLowerCase())}}class f{constructor(i,s,a){this.parser=i,this.options=s,this.isOpen=a,this.open=0;let p,d=s.topNode,x=D(null,s.preserveWhitespace,0)|(a?4:0);p=d?new c(d.type,d.attrs,A.none,A.none,!0,s.topMatch||d.type.contentMatch,x):new c(a?null:i.schema.topNodeType,null,A.none,A.none,!0,null,x),this.nodes=[p],this.find=s.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(i){if(3==i.nodeType)this.addTextNode(i);else if(1==i.nodeType){let s=i.getAttribute("style"),a=s?this.readStyles(function C(y){let s,i=/\s*([\w-]+)\s*:\s*([^;]+)/g,a=[];for(;s=i.exec(y);)a.push(s[1],s[2].trim());return a}(s)):null,d=this.top;if(null!=a)for(let p=0;p<a.length;p++)this.addPendingMark(a[p]);if(this.addElement(i),null!=a)for(let p=0;p<a.length;p++)this.removePendingMark(a[p],d)}}addTextNode(i){let s=i.nodeValue,a=this.top;if(2&a.options||a.inlineContext(i)||/[^ \t\r\n\u000c]/.test(s)){if(1&a.options)s=2&a.options?s.replace(/\r\n?/g,"\n"):s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let d=a.content[a.content.length-1],p=i.previousSibling;(!d||p&&"BR"==p.nodeName||d.isText&&/[ \t\r\n\u000c]$/.test(d.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s)),this.findInText(i)}else this.findInside(i)}addElement(i,s){let d,a=i.nodeName.toLowerCase();mt.hasOwnProperty(a)&&this.parser.normalizeLists&&function g(y){for(let i=y.firstChild,s=null;i;i=i.nextSibling){let a=1==i.nodeType?i.nodeName.toLowerCase():null;a&&mt.hasOwnProperty(a)&&s?(s.appendChild(i),i=s):"li"==a?s=i:a&&(s=null)}}(i);let p=this.options.ruleFromNode&&this.options.ruleFromNode(i)||(d=this.parser.matchTag(i,this,s));if(p?p.ignore:pt.hasOwnProperty(a))this.findInside(i),this.ignoreFallback(i);else if(!p||p.skip||p.closeParent){p&&p.closeParent?this.open=Math.max(0,this.open-1):p&&p.skip.nodeType&&(i=p.skip);let x,N=this.top,_=this.needsBlock;if(Ye.hasOwnProperty(a))x=!0,N.type||(this.needsBlock=!0);else if(!i.firstChild)return void this.leafFallback(i);this.addAll(i),x&&this.sync(N),this.needsBlock=_}else this.addElementByRule(i,p,!1===p.consuming?d:void 0)}leafFallback(i){"BR"==i.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(i.ownerDocument.createTextNode("\n"))}ignoreFallback(i){"BR"==i.nodeName&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(i){let s=A.none;e:for(let a=0;a<i.length;a+=2)for(let d;;){let p=this.parser.matchStyle(i[a],i[a+1],this,d);if(!p)continue e;if(p.ignore)return null;if(s=this.parser.schema.marks[p.mark].create(p.attrs).addToSet(s),!1!==p.consuming)break;d=p}return s}addElementByRule(i,s,a){let d,p,x;s.node?(p=this.parser.schema.nodes[s.node],p.isLeaf?this.insertNode(p.create(s.attrs))||this.leafFallback(i):d=this.enter(p,s.attrs||null,s.preserveWhitespace)):(x=this.parser.schema.marks[s.mark].create(s.attrs),this.addPendingMark(x));let N=this.top;if(p&&p.isLeaf)this.findInside(i);else if(a)this.addElement(i,a);else if(s.getContent)this.findInside(i),s.getContent(i,this.parser.schema).forEach(_=>this.insertNode(_));else{let _=i;"string"==typeof s.contentElement?_=i.querySelector(s.contentElement):"function"==typeof s.contentElement?_=s.contentElement(i):s.contentElement&&(_=s.contentElement),this.findAround(i,_,!0),this.addAll(_)}d&&this.sync(N)&&this.open--,x&&this.removePendingMark(x,N)}addAll(i,s,a){let d=s||0;for(let p=s?i.childNodes[s]:i.firstChild,x=null==a?null:i.childNodes[a];p!=x;p=p.nextSibling,++d)this.findAtPoint(i,d),this.addDOM(p);this.findAtPoint(i,d)}findPlace(i){let s,a;for(let d=this.open;d>=0;d--){let p=this.nodes[d],x=p.findWrapping(i);if(x&&(!s||s.length>x.length)&&(s=x,a=p,!x.length)||p.solid)break}if(!s)return!1;this.sync(a);for(let d=0;d<s.length;d++)this.enterInner(s[d],null,!1);return!0}insertNode(i){if(i.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&this.enterInner(s)}if(this.findPlace(i)){this.closeExtra();let s=this.top;s.applyPending(i.type),s.match&&(s.match=s.match.matchType(i.type));let a=s.activeMarks;for(let d=0;d<i.marks.length;d++)(!s.type||s.type.allowsMarkType(i.marks[d].type))&&(a=i.marks[d].addToSet(a));return s.content.push(i.mark(a)),!0}return!1}enter(i,s,a){let d=this.findPlace(i.create(s));return d&&this.enterInner(i,s,!0,a),d}enterInner(i,s=null,a=!1,d){this.closeExtra();let p=this.top;p.applyPending(i),p.match=p.match&&p.match.matchType(i);let x=D(i,d,p.options);4&p.options&&0==p.content.length&&(x|=4),this.nodes.push(new c(i,s,p.activeMarks,p.pendingMarks,a,null,x)),this.open++}closeExtra(i=!1){let s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(i));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(i){for(let s=this.open;s>=0;s--)if(this.nodes[s]==i)return this.open=s,!0;return!1}get currentPos(){this.closeExtra();let i=0;for(let s=this.open;s>=0;s--){let a=this.nodes[s].content;for(let d=a.length-1;d>=0;d--)i+=a[d].nodeSize;s&&i++}return i}findAtPoint(i,s){if(this.find)for(let a=0;a<this.find.length;a++)this.find[a].node==i&&this.find[a].offset==s&&(this.find[a].pos=this.currentPos)}findInside(i){if(this.find)for(let s=0;s<this.find.length;s++)null==this.find[s].pos&&1==i.nodeType&&i.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)}findAround(i,s,a){if(i!=s&&this.find)for(let d=0;d<this.find.length;d++)null==this.find[d].pos&&1==i.nodeType&&i.contains(this.find[d].node)&&s.compareDocumentPosition(this.find[d].node)&(a?2:4)&&(this.find[d].pos=this.currentPos)}findInText(i){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==i&&(this.find[s].pos=this.currentPos-(i.nodeValue.length-this.find[s].offset))}matchesContext(i){if(i.indexOf("|")>-1)return i.split(/\s*\|\s*/).some(this.matchesContext,this);let s=i.split("/"),a=this.options.context,d=!(this.isOpen||a&&a.parent.type!=this.nodes[0].type),p=(d?0:1)-(a?a.depth+1:0),x=(N,_)=>{for(;N>=0;N--){let X=s[N];if(""==X){if(N==s.length-1||0==N)continue;for(;_>=p;_--)if(x(N-1,_))return!0;return!1}{let re=_>0||0==_&&d?this.nodes[_].type:a&&_>=p?a.node(_-p).type:null;if(!re||re.name!=X&&-1==re.groups.indexOf(X))return!1;_--}}return!0};return x(s.length-1,this.open)}textblockFromContext(){let i=this.options.context;if(i)for(let s=i.depth;s>=0;s--){let a=i.node(s).contentMatchAt(i.indexAfter(s)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(let s in this.parser.schema.nodes){let a=this.parser.schema.nodes[s];if(a.isTextblock&&a.defaultAttrs)return a}}addPendingMark(i){let s=function V(y,i){for(let s=0;s<i.length;s++)if(y.eq(i[s]))return i[s]}(i,this.top.pendingMarks);s&&this.top.stashMarks.push(s),this.top.pendingMarks=i.addToSet(this.top.pendingMarks)}removePendingMark(i,s){for(let a=this.open;a>=0;a--){let d=this.nodes[a];if(d.pendingMarks.lastIndexOf(i)>-1)d.pendingMarks=i.removeFromSet(d.pendingMarks);else{d.activeMarks=i.removeFromSet(d.activeMarks);let x=d.popFromStashMark(i);x&&d.type&&d.type.allowsMarkType(x.type)&&(d.activeMarks=x.addToSet(d.activeMarks))}if(d==s)break}}}function k(y,i){return(y.matches||y.msMatchesSelector||y.webkitMatchesSelector||y.mozMatchesSelector).call(y,i)}function T(y){let i={};for(let s in y)i[s]=y[s];return i}function R(y,i){let s=i.schema.nodes;for(let a in s){let d=s[a];if(!d.allowsMarkType(y))continue;let p=[],x=N=>{p.push(N);for(let _=0;_<N.edgeCount;_++){let{type:X,next:re}=N.edge(_);if(X==i||p.indexOf(re)<0&&x(re))return!0}};if(x(d.contentMatch))return!0}}class H{constructor(i,s){this.nodes=i,this.marks=s}serializeFragment(i,s={},a){a||(a=te(s).createDocumentFragment());let d=a,p=[];return i.forEach(x=>{if(p.length||x.marks.length){let N=0,_=0;for(;N<p.length&&_<x.marks.length;){let X=x.marks[_];if(this.marks[X.type.name]){if(!X.eq(p[N][0])||!1===X.type.spec.spanning)break;N++,_++}else _++}for(;N<p.length;)d=p.pop()[1];for(;_<x.marks.length;){let X=x.marks[_++],re=this.serializeMark(X,x.isInline,s);re&&(p.push([X,d]),d.appendChild(re.dom),d=re.contentDOM||re.dom)}}d.appendChild(this.serializeNodeInner(x,s))}),a}serializeNodeInner(i,s){let{dom:a,contentDOM:d}=H.renderSpec(te(s),this.nodes[i.type.name](i));if(d){if(i.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(i.content,s,d)}return a}serializeNode(i,s={}){let a=this.serializeNodeInner(i,s);for(let d=i.marks.length-1;d>=0;d--){let p=this.serializeMark(i.marks[d],i.isInline,s);p&&((p.contentDOM||p.dom).appendChild(a),a=p.dom)}return a}serializeMark(i,s,a={}){let d=this.marks[i.type.name];return d&&H.renderSpec(te(a),d(i,s))}static renderSpec(i,s,a=null){if("string"==typeof s)return{dom:i.createTextNode(s)};if(null!=s.nodeType)return{dom:s};if(s.dom&&null!=s.dom.nodeType)return s;let d=s[0],p=d.indexOf(" ");p>0&&(a=d.slice(0,p),d=d.slice(p+1));let x,N=a?i.createElementNS(a,d):i.createElement(d),_=s[1],X=1;if(_&&"object"==typeof _&&null==_.nodeType&&!Array.isArray(_)){X=2;for(let re in _)if(null!=_[re]){let Pe=re.indexOf(" ");Pe>0?N.setAttributeNS(re.slice(0,Pe),re.slice(Pe+1),_[re]):N.setAttribute(re,_[re])}}for(let re=X;re<s.length;re++){let Pe=s[re];if(0===Pe){if(re<s.length-1||re>X)throw new RangeError("Content hole must be the only child of its parent node");return{dom:N,contentDOM:N}}{let{dom:rt,contentDOM:bt}=H.renderSpec(i,Pe,a);if(N.appendChild(rt),bt){if(x)throw new RangeError("Multiple content holes");x=bt}}}return{dom:N,contentDOM:x}}static fromSchema(i){return i.cached.domSerializer||(i.cached.domSerializer=new H(this.nodesFromSchema(i),this.marksFromSchema(i)))}static nodesFromSchema(i){let s=j(i.nodes);return s.text||(s.text=a=>a.text),s}static marksFromSchema(i){return j(i.marks)}}function j(y){let i={};for(let s in y){let a=y[s].spec.toDOM;a&&(i[s]=a)}return i}function te(y){return y.document||window.document}},3981:(Ee,fe,L)=>{L.d(fe,{fK:()=>G});var O=L(8197);const z=["p",0],le=["blockquote",0],K=["hr"],F=["pre",["code",0]],J=["br"],v=["em",0],A=["strong",0],Q=["code",0],G=new O.V_({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>z},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>le},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>K},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:ne=>["h"+ne.attrs.level,0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>F},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:ne=>({src:ne.getAttribute("src"),title:ne.getAttribute("title"),alt:ne.getAttribute("alt")})}],toDOM(ne){let{src:ie,alt:ue,title:ee}=ne.attrs;return["img",{src:ie,alt:ue,title:ee}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>J}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:ne=>({href:ne.getAttribute("href"),title:ne.getAttribute("title")})}],toDOM(ne){let{href:ie,title:ue}=ne.attrs;return["a",{href:ie,title:ue},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>v},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:ne=>"normal"!=ne.style.fontWeight&&null},{style:"font-weight",getAttrs:ne=>/^(bold(er)?|[5-9]\d{2,})$/.test(ne)&&null}],toDOM:()=>A},code:{parseDOM:[{tag:"code"}],toDOM:()=>Q}}})},6956:(Ee,fe,L)=>{L.d(fe,{Bs:()=>v,C1:()=>G,H$:()=>be,Sy:()=>Z,Y1:()=>K,qv:()=>Q,yy:()=>De});var O=L(8197),z=L(3060);const le=Object.create(null);class K{constructor(S,E,w){this.$anchor=S,this.$head=E,this.ranges=w||[new F(S.min(E),S.max(E))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let S=this.ranges;for(let E=0;E<S.length;E++)if(S[E].$from.pos!=S[E].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(S,E=O.p2.empty){let w=E.content.lastChild,q=null;for(let Se=0;Se<E.openEnd;Se++)q=w,w=w.lastChild;let Y=S.steps.length,he=this.ranges;for(let Se=0;Se<he.length;Se++){let{$from:Ce,$to:ve}=he[Se],Te=S.mapping.slice(Y);S.replaceRange(Te.map(Ce.pos),Te.map(ve.pos),Se?O.p2.empty:E),0==Se&&ue(S,Y,(w?w.isInline:q&&q.isTextblock)?-1:1)}}replaceWith(S,E){let w=S.steps.length,q=this.ranges;for(let Y=0;Y<q.length;Y++){let{$from:he,$to:Se}=q[Y],Ce=S.mapping.slice(w),ve=Ce.map(he.pos),Te=Ce.map(Se.pos);Y?S.deleteRange(ve,Te):(S.replaceRangeWith(ve,Te,E),ue(S,w,E.isInline?-1:1))}}static findFrom(S,E,w=!1){let q=S.parent.inlineContent?new v(S):ie(S.node(0),S.parent,S.pos,S.index(),E,w);if(q)return q;for(let Y=S.depth-1;Y>=0;Y--){let he=E<0?ie(S.node(0),S.node(Y),S.before(Y+1),S.index(Y),E,w):ie(S.node(0),S.node(Y),S.after(Y+1),S.index(Y)+1,E,w);if(he)return he}return null}static near(S,E=1){return this.findFrom(S,E)||this.findFrom(S,-E)||new G(S.node(0))}static atStart(S){return ie(S,S,0,0,1)||new G(S)}static atEnd(S){return ie(S,S,S.content.size,S.childCount,-1)||new G(S)}static fromJSON(S,E){if(!E||!E.type)throw new RangeError("Invalid input for Selection.fromJSON");let w=le[E.type];if(!w)throw new RangeError(`No selection type ${E.type} defined`);return w.fromJSON(S,E)}static jsonID(S,E){if(S in le)throw new RangeError("Duplicate use of selection JSON ID "+S);return le[S]=E,E.prototype.jsonID=S,E}getBookmark(){return v.between(this.$anchor,this.$head).getBookmark()}}K.prototype.visible=!0;class F{constructor(S,E){this.$from=S,this.$to=E}}let J=!1;function W($){!J&&!$.parent.inlineContent&&(J=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+$.parent.type.name+")"))}class v extends K{constructor(S,E=S){W(S),W(E),super(S,E)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(S,E){let w=S.resolve(E.map(this.head));if(!w.parent.inlineContent)return K.near(w);let q=S.resolve(E.map(this.anchor));return new v(q.parent.inlineContent?q:w,w)}replace(S,E=O.p2.empty){if(super.replace(S,E),E==O.p2.empty){let w=this.$from.marksAcross(this.$to);w&&S.ensureMarks(w)}}eq(S){return S instanceof v&&S.anchor==this.anchor&&S.head==this.head}getBookmark(){return new A(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(S,E){if("number"!=typeof E.anchor||"number"!=typeof E.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new v(S.resolve(E.anchor),S.resolve(E.head))}static create(S,E,w=E){let q=S.resolve(E);return new this(q,w==E?q:S.resolve(w))}static between(S,E,w){let q=S.pos-E.pos;if((!w||q)&&(w=q>=0?1:-1),!E.parent.inlineContent){let Y=K.findFrom(E,w,!0)||K.findFrom(E,-w,!0);if(!Y)return K.near(E,w);E=Y.$head}return S.parent.inlineContent||(0==q||(S=(K.findFrom(S,-w,!0)||K.findFrom(S,w,!0)).$anchor).pos<E.pos!=q<0)&&(S=E),new v(S,E)}}K.jsonID("text",v);class A{constructor(S,E){this.anchor=S,this.head=E}map(S){return new A(S.map(this.anchor),S.map(this.head))}resolve(S){return v.between(S.resolve(this.anchor),S.resolve(this.head))}}class Q extends K{constructor(S){let E=S.nodeAfter,w=S.node(0).resolve(S.pos+E.nodeSize);super(S,w),this.node=E}map(S,E){let{deleted:w,pos:q}=E.mapResult(this.anchor),Y=S.resolve(q);return w?K.near(Y):new Q(Y)}content(){return new O.p2(O.HY.from(this.node),0,0)}eq(S){return S instanceof Q&&S.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new de(this.anchor)}static fromJSON(S,E){if("number"!=typeof E.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Q(S.resolve(E.anchor))}static create(S,E){return new Q(S.resolve(E))}static isSelectable(S){return!S.isText&&!1!==S.type.spec.selectable}}Q.prototype.visible=!1,K.jsonID("node",Q);class de{constructor(S){this.anchor=S}map(S){let{deleted:E,pos:w}=S.mapResult(this.anchor);return E?new A(w,w):new de(w)}resolve(S){let E=S.resolve(this.anchor),w=E.nodeAfter;return w&&Q.isSelectable(w)?new Q(E):K.near(E)}}class G extends K{constructor(S){super(S.resolve(0),S.resolve(S.content.size))}replace(S,E=O.p2.empty){if(E==O.p2.empty){S.delete(0,S.doc.content.size);let w=K.atStart(S.doc);w.eq(S.selection)||S.setSelection(w)}else super.replace(S,E)}toJSON(){return{type:"all"}}static fromJSON(S){return new G(S)}map(S){return new G(S)}eq(S){return S instanceof G}getBookmark(){return ne}}K.jsonID("all",G);const ne={map(){return this},resolve:$=>new G($)};function ie($,S,E,w,q,Y=!1){if(S.inlineContent)return v.create($,E);for(let he=w-(q>0?0:1);q>0?he<S.childCount:he>=0;he+=q){let Se=S.child(he);if(Se.isAtom){if(!Y&&Q.isSelectable(Se))return Q.create($,E-(q<0?Se.nodeSize:0))}else{let Ce=ie($,Se,E+q,q<0?Se.childCount:0,q,Y);if(Ce)return Ce}E+=Se.nodeSize*q}return null}function ue($,S,E){let w=$.steps.length-1;if(w<S)return;let he,q=$.steps[w];(q instanceof z.Pu||q instanceof z.FC)&&($.mapping.maps[w].forEach((Se,Ce,ve,Te)=>{null==he&&(he=Te)}),$.setSelection(K.near($.doc.resolve(he),E)))}class oe extends z.wx{constructor(S){super(S.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=S.selection,this.storedMarks=S.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(S){if(S.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=S,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(S){return this.storedMarks=S,this.updated|=2,this}ensureMarks(S){return O.vc.sameSet(this.storedMarks||this.selection.$from.marks(),S)||this.setStoredMarks(S),this}addStoredMark(S){return this.ensureMarks(S.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(S){return this.ensureMarks(S.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(S,E){super.addStep(S,E),this.updated=-3&this.updated,this.storedMarks=null}setTime(S){return this.time=S,this}replaceSelection(S){return this.selection.replace(this,S),this}replaceSelectionWith(S,E=!0){let w=this.selection;return E&&(S=S.mark(this.storedMarks||(w.empty?w.$from.marks():w.$from.marksAcross(w.$to)||O.vc.none))),w.replaceWith(this,S),this}deleteSelection(){return this.selection.replace(this),this}insertText(S,E,w){let q=this.doc.type.schema;if(null==E)return S?this.replaceSelectionWith(q.text(S),!0):this.deleteSelection();{if(null==w&&(w=E),w=null==w?E:w,!S)return this.deleteRange(E,w);let Y=this.storedMarks;if(!Y){let he=this.doc.resolve(E);Y=w==E?he.marks():he.marksAcross(this.doc.resolve(w))}return this.replaceRangeWith(E,w,q.text(S,Y)),this.selection.empty||this.setSelection(K.near(this.selection.$to)),this}}setMeta(S,E){return this.meta["string"==typeof S?S:S.key]=E,this}getMeta(S){return this.meta["string"==typeof S?S:S.key]}get isGeneric(){for(let S in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function me($,S){return S&&$?$.bind(S):$}class xe{constructor(S,E,w){this.name=S,this.init=me(E.init,w),this.apply=me(E.apply,w)}}const Me=[new xe("doc",{init:$=>$.doc||$.schema.topNodeType.createAndFill(),apply:$=>$.doc}),new xe("selection",{init:($,S)=>$.selection||K.atStart(S.doc),apply:$=>$.selection}),new xe("storedMarks",{init:$=>$.storedMarks||null,apply:($,S,E,w)=>w.selection.$cursor?$.storedMarks:null}),new xe("scrollToSelection",{init:()=>0,apply:($,S)=>$.scrolledIntoView?S+1:S})];class Ie{constructor(S,E){this.schema=S,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Me.slice(),E&&E.forEach(w=>{if(this.pluginsByKey[w.key])throw new RangeError("Adding different instances of a keyed plugin ("+w.key+")");this.plugins.push(w),this.pluginsByKey[w.key]=w,w.spec.state&&this.fields.push(new xe(w.key,w.spec.state,w))})}}class De{constructor(S){this.config=S}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(S){return this.applyTransaction(S).state}filterTransaction(S,E=-1){for(let w=0;w<this.config.plugins.length;w++)if(w!=E){let q=this.config.plugins[w];if(q.spec.filterTransaction&&!q.spec.filterTransaction.call(q,S,this))return!1}return!0}applyTransaction(S){if(!this.filterTransaction(S))return{state:this,transactions:[]};let E=[S],w=this.applyInner(S),q=null;for(;;){let Y=!1;for(let he=0;he<this.config.plugins.length;he++){let Se=this.config.plugins[he];if(Se.spec.appendTransaction){let Ce=q?q[he].n:0,ve=q?q[he].state:this,Te=Ce<E.length&&Se.spec.appendTransaction.call(Se,Ce?E.slice(Ce):E,ve,w);if(Te&&w.filterTransaction(Te,he)){if(Te.setMeta("appendedTransaction",S),!q){q=[];for(let Ke=0;Ke<this.config.plugins.length;Ke++)q.push(Ke<he?{state:w,n:E.length}:{state:this,n:0})}E.push(Te),w=w.applyInner(Te),Y=!0}q&&(q[he]={state:w,n:E.length})}}if(!Y)return{state:w,transactions:E}}}applyInner(S){if(!S.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let E=new De(this.config),w=this.config.fields;for(let q=0;q<w.length;q++){let Y=w[q];E[Y.name]=Y.apply(S,this[Y.name],this,E)}return E}get tr(){return new oe(this)}static create(S){let E=new Ie(S.doc?S.doc.type.schema:S.schema,S.plugins),w=new De(E);for(let q=0;q<E.fields.length;q++)w[E.fields[q].name]=E.fields[q].init(S,w);return w}reconfigure(S){let E=new Ie(this.schema,S.plugins),w=E.fields,q=new De(E);for(let Y=0;Y<w.length;Y++){let he=w[Y].name;q[he]=this.hasOwnProperty(he)?this[he]:w[Y].init(S,q)}return q}toJSON(S){let E={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(E.storedMarks=this.storedMarks.map(w=>w.toJSON())),S&&"object"==typeof S)for(let w in S){if("doc"==w||"selection"==w)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let q=S[w],Y=q.spec.state;Y&&Y.toJSON&&(E[w]=Y.toJSON.call(q,this[q.key]))}return E}static fromJSON(S,E,w){if(!E)throw new RangeError("Invalid input for EditorState.fromJSON");if(!S.schema)throw new RangeError("Required config field 'schema' missing");let q=new Ie(S.schema,S.plugins),Y=new De(q);return q.fields.forEach(he=>{if("doc"==he.name)Y.doc=O.NB.fromJSON(S.schema,E.doc);else if("selection"==he.name)Y.selection=K.fromJSON(Y.doc,E.selection);else if("storedMarks"==he.name)E.storedMarks&&(Y.storedMarks=E.storedMarks.map(S.schema.markFromJSON));else{if(w)for(let Se in w){let Ce=w[Se],ve=Ce.spec.state;if(Ce.key==he.name&&ve&&ve.fromJSON&&Object.prototype.hasOwnProperty.call(E,Se))return void(Y[he.name]=ve.fromJSON.call(Ce,S,E[Se],Y))}Y[he.name]=he.init(S,Y)}}),Y}}function se($,S,E){for(let w in $){let q=$[w];q instanceof Function?q=q.bind(S):"handleDOMEvents"==w&&(q=se(q,S,{})),E[w]=q}return E}class Z{constructor(S){this.spec=S,this.props={},S.props&&se(S.props,this,this.props),this.key=S.key?S.key.key:ye("plugin")}getState(S){return S[this.key]}}const ae=Object.create(null);function ye($){return $ in ae?$+"$"+ ++ae[$]:(ae[$]=0,$+"$")}class be{constructor(S="key"){this.key=ye(S)}get(S){return S.config.pluginsByKey[this.key]}getState(S){return S[this.key]}}},3060:(Ee,fe,L)=>{L.d(fe,{Ax:()=>Se,FC:()=>xe,GJ:()=>Ke,Mn:()=>ve,Pu:()=>me,dR:()=>ut,k9:()=>ae,nd:()=>be,nj:()=>nt,vs:()=>ne,wx:()=>He});var O=L(8197);const le=Math.pow(2,16);function K(D,c){return D+c*le}function F(D){return 65535&D}class de{constructor(c,f,g){this.pos=c,this.delInfo=f,this.recover=g}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class G{constructor(c,f=!1){if(this.ranges=c,this.inverted=f,!c.length&&G.empty)return G.empty}recover(c){let f=0,g=F(c);if(!this.inverted)for(let k=0;k<g;k++)f+=this.ranges[3*k+2]-this.ranges[3*k+1];return this.ranges[3*g]+f+function J(D){return(D-(65535&D))/le}(c)}mapResult(c,f=1){return this._map(c,f,!1)}map(c,f=1){return this._map(c,f,!0)}_map(c,f,g){let k=0,C=this.inverted?2:1,T=this.inverted?1:2;for(let R=0;R<this.ranges.length;R+=3){let V=this.ranges[R]-(this.inverted?k:0);if(V>c)break;let H=this.ranges[R+C],j=this.ranges[R+T],te=V+H;if(c<=te){let i=V+k+((H?c==V?-1:c==te?1:f:f)<0?0:j);if(g)return i;let s=c==(f<0?V:te)?null:K(R/3,c-V),a=c==V?2:c==te?1:4;return(f<0?c!=V:c!=te)&&(a|=8),new de(i,a,s)}k+=j-H}return g?c+k:new de(c+k,0,null)}touches(c,f){let g=0,k=F(f),C=this.inverted?2:1,T=this.inverted?1:2;for(let R=0;R<this.ranges.length;R+=3){let V=this.ranges[R]-(this.inverted?g:0);if(V>c)break;let H=this.ranges[R+C];if(c<=V+H&&R==3*k)return!0;g+=this.ranges[R+T]-H}return!1}forEach(c){let f=this.inverted?2:1,g=this.inverted?1:2;for(let k=0,C=0;k<this.ranges.length;k+=3){let T=this.ranges[k],R=T-(this.inverted?C:0),V=T+(this.inverted?0:C),H=this.ranges[k+f],j=this.ranges[k+g];c(R,R+H,V,V+j),C+=j-H}}invert(){return new G(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(c){return 0==c?G.empty:new G(c<0?[0,-c,0]:[0,0,c])}}G.empty=new G([]);class ne{constructor(c=[],f,g=0,k=c.length){this.maps=c,this.mirror=f,this.from=g,this.to=k}slice(c=0,f=this.maps.length){return new ne(this.maps,this.mirror,c,f)}copy(){return new ne(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(c,f){this.to=this.maps.push(c),null!=f&&this.setMirror(this.maps.length-1,f)}appendMapping(c){for(let f=0,g=this.maps.length;f<c.maps.length;f++){let k=c.getMirror(f);this.appendMap(c.maps[f],null!=k&&k<f?g+k:void 0)}}getMirror(c){if(this.mirror)for(let f=0;f<this.mirror.length;f++)if(this.mirror[f]==c)return this.mirror[f+(f%2?-1:1)]}setMirror(c,f){this.mirror||(this.mirror=[]),this.mirror.push(c,f)}appendMappingInverted(c){for(let f=c.maps.length-1,g=this.maps.length+c.maps.length;f>=0;f--){let k=c.getMirror(f);this.appendMap(c.maps[f].invert(),null!=k&&k>f?g-k-1:void 0)}}invert(){let c=new ne;return c.appendMappingInverted(this),c}map(c,f=1){if(this.mirror)return this._map(c,f,!0);for(let g=this.from;g<this.to;g++)c=this.maps[g].map(c,f);return c}mapResult(c,f=1){return this._map(c,f,!1)}_map(c,f,g){let k=0;for(let C=this.from;C<this.to;C++){let R=this.maps[C].mapResult(c,f);if(null!=R.recover){let V=this.getMirror(C);if(null!=V&&V>C&&V<this.to){C=V,c=this.maps[V].recover(R.recover);continue}}k|=R.delInfo,c=R.pos}return g?c:new de(c,k,null)}}const ie=Object.create(null);class ue{getMap(){return G.empty}merge(c){return null}static fromJSON(c,f){if(!f||!f.stepType)throw new RangeError("Invalid input for Step.fromJSON");let g=ie[f.stepType];if(!g)throw new RangeError(`No step type ${f.stepType} defined`);return g.fromJSON(c,f)}static jsonID(c,f){if(c in ie)throw new RangeError("Duplicate use of step JSON ID "+c);return ie[c]=f,f.prototype.jsonID=c,f}}class ee{constructor(c,f){this.doc=c,this.failed=f}static ok(c){return new ee(c,null)}static fail(c){return new ee(null,c)}static fromReplace(c,f,g,k){try{return ee.ok(c.replace(f,g,k))}catch(C){if(C instanceof O.e4)return ee.fail(C.message);throw C}}}function Oe(D,c,f){let g=[];for(let k=0;k<D.childCount;k++){let C=D.child(k);C.content.size&&(C=C.copy(Oe(C.content,c,C))),C.isInline&&(C=c(C,f,k)),g.push(C)}return O.HY.fromArray(g)}class pe extends ue{constructor(c,f,g){super(),this.from=c,this.to=f,this.mark=g}apply(c){let f=c.slice(this.from,this.to),g=c.resolve(this.from),k=g.node(g.sharedDepth(this.to)),C=new O.p2(Oe(f.content,(T,R)=>T.isAtom&&R.type.allowsMarkType(this.mark.type)?T.mark(this.mark.addToSet(T.marks)):T,k),f.openStart,f.openEnd);return ee.fromReplace(c,this.from,this.to,C)}invert(){return new oe(this.from,this.to,this.mark)}map(c){let f=c.mapResult(this.from,1),g=c.mapResult(this.to,-1);return f.deleted&&g.deleted||f.pos>=g.pos?null:new pe(f.pos,g.pos,this.mark)}merge(c){return c instanceof pe&&c.mark.eq(this.mark)&&this.from<=c.to&&this.to>=c.from?new pe(Math.min(this.from,c.from),Math.max(this.to,c.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(c,f){if("number"!=typeof f.from||"number"!=typeof f.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new pe(f.from,f.to,c.markFromJSON(f.mark))}}ue.jsonID("addMark",pe);class oe extends ue{constructor(c,f,g){super(),this.from=c,this.to=f,this.mark=g}apply(c){let f=c.slice(this.from,this.to),g=new O.p2(Oe(f.content,k=>k.mark(this.mark.removeFromSet(k.marks)),c),f.openStart,f.openEnd);return ee.fromReplace(c,this.from,this.to,g)}invert(){return new pe(this.from,this.to,this.mark)}map(c){let f=c.mapResult(this.from,1),g=c.mapResult(this.to,-1);return f.deleted&&g.deleted||f.pos>=g.pos?null:new oe(f.pos,g.pos,this.mark)}merge(c){return c instanceof oe&&c.mark.eq(this.mark)&&this.from<=c.to&&this.to>=c.from?new oe(Math.min(this.from,c.from),Math.max(this.to,c.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(c,f){if("number"!=typeof f.from||"number"!=typeof f.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new oe(f.from,f.to,c.markFromJSON(f.mark))}}ue.jsonID("removeMark",oe);class me extends ue{constructor(c,f,g,k=!1){super(),this.from=c,this.to=f,this.slice=g,this.structure=k}apply(c){return this.structure&&Me(c,this.from,this.to)?ee.fail("Structure replace would overwrite content"):ee.fromReplace(c,this.from,this.to,this.slice)}getMap(){return new G([this.from,this.to-this.from,this.slice.size])}invert(c){return new me(this.from,this.from+this.slice.size,c.slice(this.from,this.to))}map(c){let f=c.mapResult(this.from,1),g=c.mapResult(this.to,-1);return f.deletedAcross&&g.deletedAcross?null:new me(f.pos,Math.max(f.pos,g.pos),this.slice)}merge(c){if(!(c instanceof me)||c.structure||this.structure)return null;if(this.from+this.slice.size!=c.from||this.slice.openEnd||c.slice.openStart){if(c.to!=this.from||this.slice.openStart||c.slice.openEnd)return null;{let f=this.slice.size+c.slice.size==0?O.p2.empty:new O.p2(c.slice.content.append(this.slice.content),c.slice.openStart,this.slice.openEnd);return new me(c.from,this.to,f,this.structure)}}{let f=this.slice.size+c.slice.size==0?O.p2.empty:new O.p2(this.slice.content.append(c.slice.content),this.slice.openStart,c.slice.openEnd);return new me(this.from,this.to+(c.to-c.from),f,this.structure)}}toJSON(){let c={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(c.slice=this.slice.toJSON()),this.structure&&(c.structure=!0),c}static fromJSON(c,f){if("number"!=typeof f.from||"number"!=typeof f.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new me(f.from,f.to,O.p2.fromJSON(c,f.slice),!!f.structure)}}ue.jsonID("replace",me);class xe extends ue{constructor(c,f,g,k,C,T,R=!1){super(),this.from=c,this.to=f,this.gapFrom=g,this.gapTo=k,this.slice=C,this.insert=T,this.structure=R}apply(c){if(this.structure&&(Me(c,this.from,this.gapFrom)||Me(c,this.gapTo,this.to)))return ee.fail("Structure gap-replace would overwrite content");let f=c.slice(this.gapFrom,this.gapTo);if(f.openStart||f.openEnd)return ee.fail("Gap is not a flat range");let g=this.slice.insertAt(this.insert,f.content);return g?ee.fromReplace(c,this.from,this.to,g):ee.fail("Content does not fit in gap")}getMap(){return new G([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(c){let f=this.gapTo-this.gapFrom;return new xe(this.from,this.from+this.slice.size+f,this.from+this.insert,this.from+this.insert+f,c.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(c){let f=c.mapResult(this.from,1),g=c.mapResult(this.to,-1),k=c.map(this.gapFrom,-1),C=c.map(this.gapTo,1);return f.deletedAcross&&g.deletedAcross||k<f.pos||C>g.pos?null:new xe(f.pos,g.pos,k,C,this.slice,this.insert,this.structure)}toJSON(){let c={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(c.slice=this.slice.toJSON()),this.structure&&(c.structure=!0),c}static fromJSON(c,f){if("number"!=typeof f.from||"number"!=typeof f.to||"number"!=typeof f.gapFrom||"number"!=typeof f.gapTo||"number"!=typeof f.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new xe(f.from,f.to,f.gapFrom,f.gapTo,O.p2.fromJSON(c,f.slice),f.insert,!!f.structure)}}function Me(D,c,f){let g=D.resolve(c),k=f-c,C=g.depth;for(;k>0&&C>0&&g.indexAfter(C)==g.node(C).childCount;)C--,k--;if(k>0){let T=g.node(C).maybeChild(g.indexAfter(C));for(;k>0;){if(!T||T.isLeaf)return!0;T=T.firstChild,k--}}return!1}function Z(D,c,f){return(0==c||D.canReplace(c,D.childCount))&&(f==D.childCount||D.canReplace(0,f))}function ae(D){let f=D.parent.content.cutByIndex(D.startIndex,D.endIndex);for(let g=D.depth;;--g){let k=D.$from.node(g),C=D.$from.index(g),T=D.$to.indexAfter(g);if(g<D.depth&&k.canReplace(C,T,f))return g;if(0==g||k.type.spec.isolating||!Z(k,C,T))break}return null}function be(D,c,f=null,g=D){let k=function S(D,c){let{parent:f,startIndex:g,endIndex:k}=D,C=f.contentMatchAt(g).findWrapping(c);return C&&f.canReplaceWith(g,k,C.length?C[0]:c)?C:null}(D,c),C=k&&function E(D,c){let{parent:f,startIndex:g,endIndex:k}=D,C=f.child(g),T=c.contentMatch.findWrapping(C.type);if(!T)return null;let V=(T.length?T[T.length-1]:c).contentMatch;for(let H=g;V&&H<k;H++)V=V.matchType(f.child(H).type);return V&&V.validEnd?T:null}(g,c);return C?k.map($).concat({type:c,attrs:f}).concat(C.map($)):null}function $(D){return{type:D,attrs:null}}function Se(D,c,f=1,g){let k=D.resolve(c),C=k.depth-f,T=g&&g[g.length-1]||k.parent;if(C<0||k.parent.type.spec.isolating||!k.parent.canReplace(k.index(),k.parent.childCount)||!T.type.validContent(k.parent.content.cutByIndex(k.index(),k.parent.childCount)))return!1;for(let H=k.depth-1,j=f-2;H>C;H--,j--){let te=k.node(H),y=k.index(H);if(te.type.spec.isolating)return!1;let i=te.content.cutByIndex(y,te.childCount),s=g&&g[j]||te;if(s!=te&&(i=i.replaceChild(0,s.type.create(s.attrs))),!te.canReplace(y+1,te.childCount)||!s.type.validContent(i))return!1}let R=k.indexAfter(C),V=g&&g[0];return k.node(C).canReplaceWith(R,R,V?V.type:k.node(C+1).type)}function ve(D,c){let f=D.resolve(c),g=f.index();return Te(f.nodeBefore,f.nodeAfter)&&f.parent.canReplace(g,g+1)}function Te(D,c){return!(!D||!c||D.isLeaf||!D.canAppend(c))}function Ke(D,c,f=-1){let g=D.resolve(c);for(let k=g.depth;;k--){let C,T,R=g.index(k);if(k==g.depth?(C=g.nodeBefore,T=g.nodeAfter):f>0?(C=g.node(k+1),R++,T=g.node(k).maybeChild(R)):(C=g.node(k).maybeChild(R-1),T=g.node(k+1)),C&&!C.isTextblock&&Te(C,T)&&g.node(k).canReplace(R,R+1))return c;if(0==k)break;c=f<0?g.before(k):g.after(k)}}function nt(D,c,f){let g=D.resolve(c);if(!f.content.size)return c;let k=f.content;for(let C=0;C<f.openStart;C++)k=k.firstChild.content;for(let C=1;C<=(0==f.openStart&&f.size?2:1);C++)for(let T=g.depth;T>=0;T--){let R=T==g.depth?0:g.pos<=(g.start(T+1)+g.end(T+1))/2?-1:1,V=g.index(T)+(R>0?1:0),H=g.node(T),j=!1;if(1==C)j=H.canReplace(V,V,k);else{let te=H.contentMatchAt(V).findWrapping(k.firstChild.type);j=te&&H.canReplaceWith(V,V,te[0])}if(j)return 0==R?g.pos:R<0?g.before(T+1):g.after(T+1)}return null}function ut(D,c,f=c,g=O.p2.empty){if(c==f&&!g.size)return null;let k=D.resolve(c),C=D.resolve(f);return Ze(k,C,g)?new me(c,f,g):new dt(k,C,g).fit()}function Ze(D,c,f){return!f.openStart&&!f.openEnd&&D.start()==c.start()&&D.parent.canReplace(D.index(),c.index(),f.content)}ue.jsonID("replaceAround",xe);class dt{constructor(c,f,g){this.$from=c,this.$to=f,this.unplaced=g,this.frontier=[],this.placed=O.HY.empty;for(let k=0;k<=c.depth;k++){let C=c.node(k);this.frontier.push({type:C.type,match:C.contentMatchAt(c.indexAfter(k))})}for(let k=c.depth;k>0;k--)this.placed=O.HY.from(c.node(k).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let H=this.findFittable();H?this.placeNodes(H):this.openMore()||this.dropNode()}let c=this.mustMoveInline(),f=this.placed.size-this.depth-this.$from.depth,g=this.$from,k=this.close(c<0?this.$to:g.doc.resolve(c));if(!k)return null;let C=this.placed,T=g.depth,R=k.depth;for(;T&&R&&1==C.childCount;)C=C.firstChild.content,T--,R--;let V=new O.p2(C,T,R);return c>-1?new xe(g.pos,c,this.$to.pos,this.$to.end(),V,f):V.size||g.pos!=this.$to.pos?new me(g.pos,k.pos,V):null}findFittable(){for(let c=1;c<=2;c++)for(let f=this.unplaced.openStart;f>=0;f--){let g,k=null;f?(k=We(this.unplaced.content,f-1).firstChild,g=k.content):g=this.unplaced.content;let C=g.firstChild;for(let T=this.depth;T>=0;T--){let H,{type:R,match:V}=this.frontier[T],j=null;if(1==c&&(C?V.matchType(C.type)||(j=V.fillBefore(O.HY.from(C),!1)):k&&R.compatibleContent(k.type)))return{sliceDepth:f,frontierDepth:T,parent:k,inject:j};if(2==c&&C&&(H=V.findWrapping(C.type)))return{sliceDepth:f,frontierDepth:T,parent:k,wrap:H};if(k&&V.matchType(k.type))break}}}openMore(){let{content:c,openStart:f,openEnd:g}=this.unplaced,k=We(c,f);return!(!k.childCount||k.firstChild.isLeaf||(this.unplaced=new O.p2(c,f+1,Math.max(g,k.size+f>=c.size-g?f+1:0)),0))}dropNode(){let{content:c,openStart:f,openEnd:g}=this.unplaced,k=We(c,f);if(k.childCount<=1&&f>0){let C=c.size-f<=f+k.size;this.unplaced=new O.p2(Je(c,f-1,1),f-1,C?f-1:g)}else this.unplaced=new O.p2(Je(c,f,1),f,g)}placeNodes({sliceDepth:c,frontierDepth:f,parent:g,inject:k,wrap:C}){for(;this.depth>f;)this.closeFrontierNode();if(C)for(let a=0;a<C.length;a++)this.openFrontierNode(C[a]);let T=this.unplaced,R=g?g.content:T.content,V=T.openStart-c,H=0,j=[],{match:te,type:y}=this.frontier[f];if(k){for(let a=0;a<k.childCount;a++)j.push(k.child(a));te=te.matchFragment(k)}let i=R.size+c-(T.content.size-T.openEnd);for(;H<R.childCount;){let a=R.child(H),d=te.matchType(a.type);if(!d)break;H++,(H>1||0==V||a.content.size)&&(te=d,j.push(ft(a.mark(y.allowedMarks(a.marks)),1==H?V:0,H==R.childCount?i:-1)))}let s=H==R.childCount;s||(i=-1),this.placed=$e(this.placed,f,O.HY.from(j)),this.frontier[f].match=te,s&&i<0&&g&&g.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let a=0,d=R;a<i;a++){let p=d.lastChild;this.frontier.push({type:p.type,match:p.contentMatchAt(p.childCount)}),d=p.content}this.unplaced=s?0==c?O.p2.empty:new O.p2(Je(T.content,c-1,1),c-1,i<0?T.openEnd:c-1):new O.p2(Je(T.content,c,H),T.openStart,T.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let f,c=this.frontier[this.depth];if(!c.type.isTextblock||!we(this.$to,this.$to.depth,c.type,c.match,!1)||this.$to.depth==this.depth&&(f=this.findCloseLevel(this.$to))&&f.depth==this.depth)return-1;let{depth:g}=this.$to,k=this.$to.after(g);for(;g>1&&k==this.$to.end(--g);)++k;return k}findCloseLevel(c){e:for(let f=Math.min(this.depth,c.depth);f>=0;f--){let{match:g,type:k}=this.frontier[f],C=f<c.depth&&c.end(f+1)==c.pos+(c.depth-(f+1)),T=we(c,f,k,g,C);if(T){for(let R=f-1;R>=0;R--){let{match:V,type:H}=this.frontier[R],j=we(c,R,H,V,!0);if(!j||j.childCount)continue e}return{depth:f,fit:T,move:C?c.doc.resolve(c.after(f+1)):c}}}}close(c){let f=this.findCloseLevel(c);if(!f)return null;for(;this.depth>f.depth;)this.closeFrontierNode();f.fit.childCount&&(this.placed=$e(this.placed,f.depth,f.fit)),c=f.move;for(let g=f.depth+1;g<=c.depth;g++){let k=c.node(g),C=k.type.contentMatch.fillBefore(k.content,!0,c.index(g));this.openFrontierNode(k.type,k.attrs,C)}return c}openFrontierNode(c,f=null,g){let k=this.frontier[this.depth];k.match=k.match.matchType(c),this.placed=$e(this.placed,this.depth,O.HY.from(c.create(f,g))),this.frontier.push({type:c,match:c.contentMatch})}closeFrontierNode(){let f=this.frontier.pop().match.fillBefore(O.HY.empty,!0);f.childCount&&(this.placed=$e(this.placed,this.frontier.length,f))}}function Je(D,c,f){return 0==c?D.cutByIndex(f,D.childCount):D.replaceChild(0,D.firstChild.copy(Je(D.firstChild.content,c-1,f)))}function $e(D,c,f){return 0==c?D.append(f):D.replaceChild(D.childCount-1,D.lastChild.copy($e(D.lastChild.content,c-1,f)))}function We(D,c){for(let f=0;f<c;f++)D=D.firstChild.content;return D}function ft(D,c,f){if(c<=0)return D;let g=D.content;return c>1&&(g=g.replaceChild(0,ft(g.firstChild,c-1,1==g.childCount?f-1:0))),c>0&&(g=D.type.contentMatch.fillBefore(g).append(g),f<=0&&(g=g.append(D.type.contentMatch.matchFragment(g).fillBefore(O.HY.empty,!0)))),D.copy(g)}function we(D,c,f,g,k){let C=D.node(c),T=k?D.indexAfter(c):D.index(c);if(T==C.childCount&&!f.compatibleContent(C.type))return null;let R=g.fillBefore(C.content,!0,T);return R&&!function kt(D,c,f){for(let g=f;g<c.childCount;g++)if(!D.allowsMarks(c.child(g).marks))return!0;return!1}(f,C.content,T)?R:null}function it(D){return D.spec.defining||D.spec.definingForContent}function Ye(D,c,f,g,k){if(c<f){let C=D.firstChild;D=D.replaceChild(0,C.copy(Ye(C.content,c+1,f,g,C)))}if(c>g){let C=k.contentMatchAt(0),T=C.fillBefore(D).append(D);D=T.append(C.matchFragment(T).fillBefore(O.HY.empty,!0))}return D}function Ge(D,c){let f=[];for(let k=Math.min(D.depth,c.depth);k>=0;k--){let C=D.start(k);if(C<D.pos-(D.depth-k)||c.end(k)>c.pos+(c.depth-k)||D.node(k).type.spec.isolating||c.node(k).type.spec.isolating)break;(C==c.start(k)||k==D.depth&&k==c.depth&&D.parent.inlineContent&&c.parent.inlineContent&&k&&c.start(k-1)==C-1)&&f.push(k)}return f}let Fe=class extends Error{};Fe=function D(c){let f=Error.call(this,c);return f.__proto__=D.prototype,f},(Fe.prototype=Object.create(Error.prototype)).constructor=Fe,Fe.prototype.name="TransformError";class He{constructor(c){this.doc=c,this.steps=[],this.docs=[],this.mapping=new ne}get before(){return this.docs.length?this.docs[0]:this.doc}step(c){let f=this.maybeStep(c);if(f.failed)throw new Fe(f.failed);return this}maybeStep(c){let f=c.apply(this.doc);return f.failed||this.addStep(c,f.doc),f}get docChanged(){return this.steps.length>0}addStep(c,f){this.docs.push(this.doc),this.steps.push(c),this.mapping.appendMap(c.getMap()),this.doc=f}replace(c,f=c,g=O.p2.empty){let k=ut(this.doc,c,f,g);return k&&this.step(k),this}replaceWith(c,f,g){return this.replace(c,f,new O.p2(O.HY.from(g),0,0))}delete(c,f){return this.replace(c,f,O.p2.empty)}insert(c,f){return this.replaceWith(c,c,f)}replaceRange(c,f,g){return function ze(D,c,f,g){if(!g.size)return D.deleteRange(c,f);let k=D.doc.resolve(c),C=D.doc.resolve(f);if(Ze(k,C,g))return D.step(new me(c,f,g));let T=Ge(k,D.doc.resolve(f));0==T[T.length-1]&&T.pop();let R=-(k.depth+1);T.unshift(R);for(let y=k.depth,i=k.pos-1;y>0;y--,i--){let s=k.node(y).type.spec;if(s.defining||s.definingAsContext||s.isolating)break;T.indexOf(y)>-1?R=y:k.before(y)==i&&T.splice(1,0,-y)}let V=T.indexOf(R),H=[],j=g.openStart;for(let y=g.content,i=0;;i++){let s=y.firstChild;if(H.push(s),i==g.openStart)break;y=s.content}for(let y=j-1;y>=0;y--){let i=H[y].type,s=it(i);if(s&&k.node(V).type!=i)j=y;else if(s||!i.isTextblock)break}for(let y=g.openStart;y>=0;y--){let i=(y+j+1)%(g.openStart+1),s=H[i];if(s)for(let a=0;a<T.length;a++){let d=T[(a+V)%T.length],p=!0;d<0&&(p=!1,d=-d);let x=k.node(d-1),N=k.index(d-1);if(x.canReplaceWith(N,N,s.type,s.marks))return D.replace(k.before(d),p?C.after(d):f,new O.p2(Ye(g.content,0,g.openStart,i),i,g.openEnd))}}let te=D.steps.length;for(let y=T.length-1;y>=0&&(D.replace(c,f,g),!(D.steps.length>te));y--){let i=T[y];i<0||(c=k.before(i),f=C.after(i))}}(this,c,f,g),this}replaceRangeWith(c,f,g){return function pt(D,c,f,g){if(!g.isInline&&c==f&&D.doc.resolve(c).parent.content.size){let k=function ct(D,c,f){let g=D.resolve(c);if(g.parent.canReplaceWith(g.index(),g.index(),f))return c;if(0==g.parentOffset)for(let k=g.depth-1;k>=0;k--){let C=g.index(k);if(g.node(k).canReplaceWith(C,C,f))return g.before(k+1);if(C>0)return null}if(g.parentOffset==g.parent.content.size)for(let k=g.depth-1;k>=0;k--){let C=g.indexAfter(k);if(g.node(k).canReplaceWith(C,C,f))return g.after(k+1);if(C<g.node(k).childCount)return null}return null}(D.doc,c,g.type);null!=k&&(c=f=k)}D.replaceRange(c,f,new O.p2(O.HY.from(g),0,0))}(this,c,f,g),this}deleteRange(c,f){return function mt(D,c,f){let g=D.doc.resolve(c),k=D.doc.resolve(f),C=Ge(g,k);for(let T=0;T<C.length;T++){let R=C[T],V=T==C.length-1;if(V&&0==R||g.node(R).type.contentMatch.validEnd)return D.delete(g.start(R),k.end(R));if(R>0&&(V||g.node(R-1).canReplace(g.index(R-1),k.indexAfter(R-1))))return D.delete(g.before(R),k.after(R))}for(let T=1;T<=g.depth&&T<=k.depth;T++)if(c-g.start(T)==g.depth-T&&f>g.end(T)&&k.end(T)-f!=k.depth-T)return D.delete(g.before(T),f);D.delete(c,f)}(this,c,f),this}lift(c,f){return function ye(D,c,f){let{$from:g,$to:k,depth:C}=c,T=g.before(C+1),R=k.after(C+1),V=T,H=R,j=O.HY.empty,te=0;for(let s=C,a=!1;s>f;s--)a||g.index(s)>0?(a=!0,j=O.HY.from(g.node(s).copy(j)),te++):V--;let y=O.HY.empty,i=0;for(let s=C,a=!1;s>f;s--)a||k.after(s+1)<k.end(s)?(a=!0,y=O.HY.from(k.node(s).copy(y)),i++):H++;D.step(new xe(V,H,T,R,new O.p2(j.append(y),te,i),j.size-te,!0))}(this,c,f),this}join(c,f=1){return function Ue(D,c,f){let g=new me(c-f,c+f,O.p2.empty,!0);D.step(g)}(this,c,f),this}wrap(c,f){return function w(D,c,f){let g=O.HY.empty;for(let T=f.length-1;T>=0;T--){if(g.size){let R=f[T].type.contentMatch.matchFragment(g);if(!R||!R.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}g=O.HY.from(f[T].type.create(f[T].attrs,g))}let k=c.start,C=c.end;D.step(new xe(k,C,k,C,new O.p2(g,0,0),f.length,!0))}(this,c,f),this}setBlockType(c,f=c,g,k=null){return function q(D,c,f,g,k){if(!g.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let C=D.steps.length;D.doc.nodesBetween(c,f,(T,R)=>{if(T.isTextblock&&!T.hasMarkup(g,k)&&function Y(D,c,f){let g=D.resolve(c),k=g.index();return g.parent.canReplaceWith(k,k+1,f)}(D.doc,D.mapping.slice(C).map(R),g)){D.clearIncompatible(D.mapping.slice(C).map(R,1),g);let V=D.mapping.slice(C),H=V.map(R,1),j=V.map(R+T.nodeSize,1);return D.step(new xe(H,j,H+1,j-1,new O.p2(O.HY.from(g.create(k,null,T.marks)),0,0),1,!0)),!1}})}(this,c,f,g,k),this}setNodeMarkup(c,f,g=null,k=[]){return function he(D,c,f,g,k){let C=D.doc.nodeAt(c);if(!C)throw new RangeError("No node at given position");f||(f=C.type);let T=f.create(g,null,k||C.marks);if(C.isLeaf)return D.replaceWith(c,c+C.nodeSize,T);if(!f.validContent(C.content))throw new RangeError("Invalid content for node type "+f.name);D.step(new xe(c,c+C.nodeSize,c+1,c+C.nodeSize-1,new O.p2(O.HY.from(T),0,0),1,!0))}(this,c,f,g,k),this}split(c,f=1,g){return function Ce(D,c,f=1,g){let k=D.doc.resolve(c),C=O.HY.empty,T=O.HY.empty;for(let R=k.depth,V=k.depth-f,H=f-1;R>V;R--,H--){C=O.HY.from(k.node(R).copy(C));let j=g&&g[H];T=O.HY.from(j?j.type.create(j.attrs,T):k.node(R).copy(T))}D.step(new me(c,c,new O.p2(C.append(T),f,f),!0))}(this,c,f,g),this}addMark(c,f,g){return function Ie(D,c,f,g){let T,R,k=[],C=[];D.doc.nodesBetween(c,f,(V,H,j)=>{if(!V.isInline)return;let te=V.marks;if(!g.isInSet(te)&&j.type.allowsMarkType(g.type)){let y=Math.max(H,c),i=Math.min(H+V.nodeSize,f),s=g.addToSet(te);for(let a=0;a<te.length;a++)te[a].isInSet(s)||(T&&T.to==y&&T.mark.eq(te[a])?T.to=i:k.push(T=new oe(y,i,te[a])));R&&R.to==y?R.to=i:C.push(R=new pe(y,i,g))}}),k.forEach(V=>D.step(V)),C.forEach(V=>D.step(V))}(this,c,f,g),this}removeMark(c,f,g){return function De(D,c,f,g){let k=[],C=0;D.doc.nodesBetween(c,f,(T,R)=>{if(!T.isInline)return;C++;let V=null;if(g instanceof O.ZU){let j,H=T.marks;for(;j=g.isInSet(H);)(V||(V=[])).push(j),H=j.removeFromSet(H)}else g?g.isInSet(T.marks)&&(V=[g]):V=T.marks;if(V&&V.length){let H=Math.min(R+T.nodeSize,f);for(let j=0;j<V.length;j++){let y,te=V[j];for(let i=0;i<k.length;i++){let s=k[i];s.step==C-1&&te.eq(k[i].style)&&(y=s)}y?(y.to=H,y.step=C):k.push({style:te,from:Math.max(R,c),to:H,step:C})}}}),k.forEach(T=>D.step(new oe(T.from,T.to,T.style)))}(this,c,f,g),this}clearIncompatible(c,f,g){return function se(D,c,f,g=f.contentMatch){let k=D.doc.nodeAt(c),C=[],T=c+1;for(let R=0;R<k.childCount;R++){let V=k.child(R),H=T+V.nodeSize,j=g.matchType(V.type);if(j){g=j;for(let te=0;te<V.marks.length;te++)f.allowsMarkType(V.marks[te].type)||D.step(new oe(T,H,V.marks[te]))}else C.push(new me(T,H,O.p2.empty));T=H}if(!g.validEnd){let R=g.fillBefore(O.HY.empty,!0);D.replace(T,T,new O.p2(R,0,0))}for(let R=C.length-1;R>=0;R--)D.step(C[R])}(this,c,f,g),this}}},412:(Ee,fe,L)=>{L.d(fe,{EH:()=>_e,p:()=>Le,tk:()=>vi});var O=L(6956),z=L(8197),le=L(3060);const K="undefined"!=typeof navigator?navigator:null,F="undefined"!=typeof document?document:null,J=K&&K.userAgent||"",W=/Edge\/(\d+)/.exec(J),v=/MSIE \d/.exec(J),A=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(J),Q=!!(v||A||W),de=v?document.documentMode:A?+A[1]:W?+W[1]:0,G=!Q&&/gecko\/(\d+)/i.test(J);G&&/Firefox\/(\d+)/.exec(J);const ne=!Q&&/Chrome\/(\d+)/.exec(J),ie=!!ne,ue=ne?+ne[1]:0,ee=!Q&&!!K&&/Apple Computer/.test(K.vendor),Oe=ee&&(/Mobile\/\w+/.test(J)||!!K&&K.maxTouchPoints>2),pe=Oe||!!K&&/Mac/.test(K.platform),oe=/Android \d/.test(J),me=!!F&&"webkitFontSmoothing"in F.documentElement.style,xe=me?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,Me=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},Ie=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let De=null;const se=function(t,e,n){let r=De||(De=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},Z=function(t,e,n,r){return n&&(ye(t,e,n,r,-1)||ye(t,e,n,r,1))},ae=/^(img|br|input|textarea|hr)$/i;function ye(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:be(t))){let l=t.parentNode;if(!l||1!=l.nodeType||S(t)||ae.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Me(t)+(o<0?0:1),t=l}else{if(1!=t.nodeType)return!1;if("false"==(t=t.childNodes[e+(o<0?-1:0)]).contentEditable)return!1;e=o<0?be(t):0}}}function be(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function S(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const E=function(t){let e=t.isCollapsed;return e&&ie&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function w(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function q(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Y(t,e){return"number"==typeof t?t:t[e]}function he(t){let e=t.getBoundingClientRect();return{left:e.left,right:e.left+t.clientWidth*(e.width/t.offsetWidth||1),top:e.top,bottom:e.top+t.clientHeight*(e.height/t.offsetHeight||1)}}function Se(t,e,n){let r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,l=t.dom.ownerDocument;for(let h=n||t.dom;h;h=Ie(h)){if(1!=h.nodeType)continue;let u=h,m=u==l.body,M=m?q(l):he(u),b=0,B=0;if(e.top<M.top+Y(r,"top")?B=-(M.top-e.top+Y(o,"top")):e.bottom>M.bottom-Y(r,"bottom")&&(B=e.bottom-M.bottom+Y(o,"bottom")),e.left<M.left+Y(r,"left")?b=-(M.left-e.left+Y(o,"left")):e.right>M.right-Y(r,"right")&&(b=e.right-M.right+Y(o,"right")),b||B)if(m)l.defaultView.scrollBy(b,B);else{let P=u.scrollLeft,I=u.scrollTop;B&&(u.scrollTop+=B),b&&(u.scrollLeft+=b);let U=u.scrollLeft-P,ce=u.scrollTop-I;e={left:e.left-U,top:e.top-ce,right:e.right-U,bottom:e.bottom-ce}}if(m)break}}function ve(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Ie(r));return e}function Ke(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:o,left:l}=t[n];r.scrollTop!=o+e&&(r.scrollTop=o+e),r.scrollLeft!=l&&(r.scrollLeft=l)}}let Ue=null;function nt(t,e){let n,o,r=2e8,l=0,h=e.top,u=e.top;for(let m=t.firstChild,M=0;m;m=m.nextSibling,M++){let b;if(1==m.nodeType)b=m.getClientRects();else{if(3!=m.nodeType)continue;b=se(m).getClientRects()}for(let B=0;B<b.length;B++){let P=b[B];if(P.top<=h&&P.bottom>=u){h=Math.max(P.bottom,h),u=Math.min(P.top,u);let I=P.left>e.left?P.left-e.left:P.right<e.left?e.left-P.right:0;if(I<r){n=m,r=I,o=I&&3==n.nodeType?{left:P.right<e.left?P.right:P.left,top:e.top}:e,1==m.nodeType&&I&&(l=M+(e.left>=(P.left+P.right)/2?1:0));continue}}!n&&(e.left>=P.right&&e.top>=P.top||e.left>=P.left&&e.top>=P.bottom)&&(l=M+1)}}return n&&3==n.nodeType?function ut(t,e){let n=t.nodeValue.length,r=document.createRange();for(let o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);let l=we(r,1);if(l.top!=l.bottom&&Ze(e,l))return{node:t,offset:o+(e.left>=(l.left+l.right)/2?1:0)}}return{node:t,offset:0}}(n,o):!n||r&&1==n.nodeType?{node:t,offset:l}:nt(n,o)}function Ze(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function We(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),l=o;;){let h=t.childNodes[l];if(1==h.nodeType){let u=h.getClientRects();for(let m=0;m<u.length;m++){let M=u[m];if(Ze(e,M))return We(h,e,M)}}if((l=(l+1)%r)==o)break}return t}function ft(t,e){let r,n=t.dom.ownerDocument,o=0;if(n.caretPositionFromPoint)try{let m=n.caretPositionFromPoint(e.left,e.top);m&&({offsetNode:r,offset:o}=m)}catch(m){}if(!r&&n.caretRangeFromPoint){let m=n.caretRangeFromPoint(e.left,e.top);m&&({startContainer:r,startOffset:o}=m)}let h,l=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top);if(!l||!t.dom.contains(1!=l.nodeType?l.parentNode:l)){let m=t.dom.getBoundingClientRect();if(!Ze(e,m)||(l=We(t.dom,e,m),!l))return null}if(ee)for(let m=l;r&&m;m=Ie(m))m.draggable&&(r=void 0);if(l=function dt(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(l,e),r){if(G&&1==r.nodeType&&(o=Math.min(o,r.childNodes.length),o<r.childNodes.length)){let M,m=r.childNodes[o];"IMG"==m.nodeName&&(M=m.getBoundingClientRect()).right<=e.left&&M.bottom>e.top&&o++}r==t.dom&&o==r.childNodes.length-1&&1==r.lastChild.nodeType&&e.top>r.lastChild.getBoundingClientRect().bottom?h=t.state.doc.content.size:(0==o||1!=r.nodeType||"BR"!=r.childNodes[o-1].nodeName)&&(h=function $e(t,e,n,r){let o=-1;for(let l=e;l!=t.dom;){let h=t.docView.nearestDesc(l,!0);if(!h)return null;if(h.node.isBlock&&h.parent){let u=h.dom.getBoundingClientRect();if(u.left>r.left||u.top>r.top)o=h.posBefore;else{if(!(u.right<r.left||u.bottom<r.top))break;o=h.posAfter}}l=h.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,1)}(t,r,o,e))}null==h&&(h=function Je(t,e,n){let{node:r,offset:o}=nt(e,n),l=-1;if(1==r.nodeType&&!r.firstChild){let h=r.getBoundingClientRect();l=h.left!=h.right&&n.left>(h.left+h.right)/2?1:-1}return t.docView.posFromDOM(r,o,l)}(t,l,e));let u=t.docView.nearestDesc(l,!0);return{pos:h,inside:u?u.posAtStart-u.border:-1}}function we(t,e){let n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}const kt=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function it(t,e,n){let{node:r,offset:o,atom:l}=t.docView.domFromPos(e,n<0?-1:1),h=me||G;if(3==r.nodeType){if(!h||!kt.test(r.nodeValue)&&(n<0?o:o!=r.nodeValue.length)){let m=o,M=o,b=n<0?1:-1;return n<0&&!o?(M++,b=-1):n>=0&&o==r.nodeValue.length?(m--,b=1):n<0?m--:M++,ze(we(se(r,m,M),b),b<0)}{let m=we(se(r,o,o),n);if(G&&o&&/\s/.test(r.nodeValue[o-1])&&o<r.nodeValue.length){let M=we(se(r,o-1,o-1),-1);if(M.top==m.top){let b=we(se(r,o,o+1),-1);if(b.top!=m.top)return ze(b,b.left<M.left)}}return m}}if(!t.state.doc.resolve(e-(l||0)).parent.inlineContent){if(null==l&&o&&(n<0||o==be(r))){let m=r.childNodes[o-1];if(1==m.nodeType)return Ye(m.getBoundingClientRect(),!1)}if(null==l&&o<be(r)){let m=r.childNodes[o];if(1==m.nodeType)return Ye(m.getBoundingClientRect(),!0)}return Ye(r.getBoundingClientRect(),n>=0)}if(null==l&&o&&(n<0||o==be(r))){let m=r.childNodes[o-1],M=3==m.nodeType?se(m,be(m)-(h?0:1)):1!=m.nodeType||"BR"==m.nodeName&&m.nextSibling?null:m;if(M)return ze(we(M,1),!1)}if(null==l&&o<be(r)){let m=r.childNodes[o];for(;m.pmViewDesc&&m.pmViewDesc.ignoreForCoords;)m=m.nextSibling;let M=m?3==m.nodeType?se(m,0,h?0:1):1==m.nodeType?m:null:null;if(M)return ze(we(M,-1),!0)}return ze(we(3==r.nodeType?se(r):r,-n),n>=0)}function ze(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Ye(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function pt(t,e,n){let r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}const Ge=/[\u0590-\u08ac]/;let He=null,D=null,c=!1;class R{constructor(e,n,r,o){this.parent=e,this.children=n,this.dom=r,this.contentDOM=o,this.dirty=0,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let o=this.children[n];if(o==e)return r;r+=o.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(r<0){let l,h;if(e==this.contentDOM)l=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;l=e.previousSibling}for(;l&&(!(h=l.pmViewDesc)||h.parent!=this);)l=l.previousSibling;return l?this.posBeforeChild(h)+h.size:this.posAtStart}{let l,h;if(e==this.contentDOM)l=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;l=e.nextSibling}for(;l&&(!(h=l.pmViewDesc)||h.parent!=this);)l=l.nextSibling;return l?this.posBeforeChild(h):this.posAtEnd}}let o;if(e==this.dom&&this.contentDOM)o=n>Me(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))o=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==n)for(let l=e;;l=l.parentNode){if(l==this.dom){o=!1;break}if(l.previousSibling)break}if(null==o&&n==e.childNodes.length)for(let l=e;;l=l.parentNode){if(l==this.dom){o=!0;break}if(l.nextSibling)break}}return(null==o?r>0:o)?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,o=e;o;o=o.parentNode){let h,l=this.getDesc(o);if(l&&(!n||l.node)){if(!r||!(h=l.nodeDOM)||(1==h.nodeType?h.contains(1==e.nodeType?e:e.parentNode):h==e))return l;r=!1}}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let o=e;o;o=o.parentNode){let l=this.getDesc(o);if(l)return l.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.size;if(r==e&&l!=r){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(e<l)return o.descAt(e-r-o.border);r=l}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let l,r=0,o=0;for(let l=0;r<this.children.length;r++){let h=this.children[r],u=l+h.size;if(u>e||h instanceof s){o=e-l;break}l=u}if(o)return this.children[r].domFromPos(o-this.children[r].border,n);for(;r&&!(l=this.children[r-1]).size&&l instanceof V&&l.side>=0;r--);if(n<=0){let l,h=!0;for(;l=r?this.children[r-1]:null,l&&l.dom.parentNode!=this.contentDOM;r--,h=!1);return l&&n&&h&&!l.border&&!l.domAtom?l.domFromPos(l.size,n):{node:this.contentDOM,offset:l?Me(l.dom)+1:0}}{let l,h=!0;for(;l=r<this.children.length?this.children[r]:null,l&&l.dom.parentNode!=this.contentDOM;r++,h=!1);return l&&h&&!l.border&&!l.domAtom?l.domFromPos(0,n):{node:this.contentDOM,offset:l?Me(l.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let o=-1,l=-1;for(let h=r,u=0;;u++){let m=this.children[u],M=h+m.size;if(-1==o&&e<=M){let b=h+m.border;if(e>=b&&n<=M-m.border&&m.node&&m.contentDOM&&this.contentDOM.contains(m.contentDOM))return m.parseRange(e,n,b);e=h;for(let B=u;B>0;B--){let P=this.children[B-1];if(P.size&&P.dom.parentNode==this.contentDOM&&!P.emptyChildAt(1)){o=Me(P.dom)+1;break}e-=P.size}-1==o&&(o=0)}if(o>-1&&(M>n||u==this.children.length-1)){n=M;for(let b=u+1;b<this.children.length;b++){let B=this.children[b];if(B.size&&B.dom.parentNode==this.contentDOM&&!B.emptyChildAt(-1)){l=Me(B.dom);break}n+=B.size}-1==l&&(l=this.contentDOM.childNodes.length);break}h=M}return{node:this.contentDOM,from:e,to:n,fromOffset:o,toOffset:l}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return 0==n.size||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,o=!1){let l=Math.min(e,n),h=Math.max(e,n);for(let P=0,I=0;P<this.children.length;P++){let U=this.children[P],ce=I+U.size;if(l>I&&h<ce)return U.setSelection(e-I-U.border,n-I-U.border,r,o);I=ce}let u=this.domFromPos(e,e?-1:1),m=n==e?u:this.domFromPos(n,n?-1:1),M=r.getSelection(),b=!1;if((G||ee)&&e==n){let{node:P,offset:I}=u;if(3==P.nodeType){if(b=!(!I||"\n"!=P.nodeValue[I-1]),b&&I==P.nodeValue.length)for(let ce,U=P;U;U=U.parentNode){if(ce=U.nextSibling){"BR"==ce.nodeName&&(u=m={node:ce.parentNode,offset:Me(ce)+1});break}let ke=U.pmViewDesc;if(ke&&ke.node&&ke.node.isBlock)break}}else{let U=P.childNodes[I-1];b=U&&("BR"==U.nodeName||"false"==U.contentEditable)}}if(G&&M.focusNode&&M.focusNode!=m.node&&1==M.focusNode.nodeType){let P=M.focusNode.childNodes[M.focusOffset];P&&"false"==P.contentEditable&&(o=!0)}if(!(o||b&&ee)&&Z(u.node,u.offset,M.anchorNode,M.anchorOffset)&&Z(m.node,m.offset,M.focusNode,M.focusOffset))return;let B=!1;if((M.extend||e==n)&&!b){M.collapse(u.node,u.offset);try{e!=n&&M.extend(m.node,m.offset),B=!0}catch(P){if(!(P instanceof DOMException))throw P}}if(!B){if(e>n){let I=u;u=m,m=I}let P=document.createRange();P.setEnd(m.node,m.offset),P.setStart(u.node,u.offset),M.removeAllRanges(),M.addRange(P)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,o=0;o<this.children.length;o++){let l=this.children[o],h=r+l.size;if(r==h?e<=h&&n>=r:e<h&&n>r){let u=r+l.border,m=h-l.border;if(e>=u&&n<=m)return this.dirty=e==r||n==h?2:1,void(e!=u||n!=m||!l.contentLost&&l.dom.parentNode==this.contentDOM?l.markDirty(e-u,n-u):l.dirty=3);l.dirty=l.dom!=l.contentDOM||l.dom.parentNode!=this.contentDOM||l.children.length?3:2}r=h}this.dirty=2}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=1==e?2:1;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class V extends R{constructor(e,n,r,o){let l,h=n.type.toDOM;if("function"==typeof h&&(h=h(r,()=>l?l.parent?l.parent.posBeforeChild(l):void 0:o)),!n.type.spec.raw){if(1!=h.nodeType){let u=document.createElement("span");u.appendChild(h),h=u}h.contentEditable="false",h.classList.add("ProseMirror-widget")}super(e,[],h,null),this.widget=n,this.widget=n,l=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return!!n&&n(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class H extends R{constructor(e,n,r,o){super(e,[],n,null),this.textDOM=r,this.text=o}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class j extends R{constructor(e,n,r,o){super(e,[],r,o),this.mark=n}static create(e,n,r,o){let l=o.nodeViews[n.type.name],h=l&&l(n,o,r);return(!h||!h.dom)&&(h=z.PW.renderSpec(document,n.type.spec.toDOM(n,r))),new j(e,n,h.dom,h.contentDOM||h.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),0!=this.dirty){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=0}}slice(e,n,r){let o=j.create(this.parent,this.mark,!0,r),l=this.children,h=this.size;n<h&&(l=Nt(l,n,h,r)),e>0&&(l=Nt(l,0,e,r));for(let u=0;u<l.length;u++)l[u].parent=o;return o.children=l,o}}class te extends R{constructor(e,n,r,o,l,h,u,m,M){super(e,[],l,h),this.node=n,this.outerDeco=r,this.innerDeco=o,this.nodeDOM=u,h&&this.updateChildren(m,M)}static create(e,n,r,o,l,h){let m,u=l.nodeViews[n.type.name],M=u&&u(n,l,()=>m?m.parent?m.parent.posBeforeChild(m):void 0:h,r,o),b=M&&M.dom,B=M&&M.contentDOM;if(n.isText)if(b){if(3!=b.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else b=document.createTextNode(n.text);else b||({dom:b,contentDOM:B}=z.PW.renderSpec(document,n.type.spec.toDOM(n)));!B&&!n.isText&&"BR"!=b.nodeName&&(b.hasAttribute("contenteditable")||(b.contentEditable="false"),n.type.spec.draggable&&(b.draggable=!0));let P=b;return b=re(b,r,n),M?m=new a(e,n,r,o,b,B||null,P,M,l,h+1):n.isText?new i(e,n,r,o,b,P,l):new te(e,n,r,o,b,B||null,P,l,h+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.HY.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,n,r){return 0==this.dirty&&e.eq(this.node)&&Pe(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,o=n,l=e.composing?this.localCompositionInfo(e,n):null,h=l&&l.pos>-1?l:null,u=l&&l.pos<0,m=new bt(this,h&&h.node);(function Bn(t,e,n,r){let o=e.locals(t),l=0;if(0==o.length){for(let M=0;M<t.childCount;M++){let b=t.child(M);r(b,o,e.forChild(l,b),M),l+=b.nodeSize}return}let h=0,u=[],m=null;for(let M=0;;){if(h<o.length&&o[h].to==l){let ce,U=o[h++];for(;h<o.length&&o[h].to==l;)(ce||(ce=[U])).push(o[h++]);if(ce){ce.sort(Pn);for(let ke=0;ke<ce.length;ke++)n(ce[ke],M,!!m)}else n(U,M,!!m)}let b,B;if(m)B=-1,b=m,m=null;else{if(!(M<t.childCount))break;B=M,b=t.child(M++)}for(let U=0;U<u.length;U++)u[U].to<=l&&u.splice(U--,1);for(;h<o.length&&o[h].from<=l&&o[h].to>l;)u.push(o[h++]);let P=l+b.nodeSize;if(b.isText){let U=P;h<o.length&&o[h].from<U&&(U=o[h].from);for(let ce=0;ce<u.length;ce++)u[ce].to<U&&(U=u[ce].to);U<P&&(m=b.cut(U-l),b=b.cut(0,U-l),P=U,B=-1)}r(b,b.isInline&&!b.isLeaf?u.filter(U=>!U.inline):u.slice(),e.forChild(l,b),B),l=P}})(this.node,this.innerDeco,(M,b,B)=>{M.spec.marks?m.syncToMarks(M.spec.marks,r,e):M.type.side>=0&&!B&&m.syncToMarks(b==this.node.childCount?z.vc.none:this.node.child(b).marks,r,e),m.placeWidget(M,e,o)},(M,b,B,P)=>{let I;m.syncToMarks(M.marks,r,e),m.findNodeMatch(M,b,B,P)||u&&e.state.selection.from>o&&e.state.selection.to<o+M.nodeSize&&(I=m.findIndexWithChild(l.node))>-1&&m.updateNodeAt(M,b,B,I,e)||m.updateNextNode(M,b,B,e,P)||m.addNode(M,b,B,e,o),o+=M.nodeSize}),m.syncToMarks([],r,e),this.node.isTextblock&&m.addTextblockHacks(),m.destroyRest(),(m.changed||2==this.dirty)&&(h&&this.protectLocalComposition(e,h),d(this.contentDOM,this.children,e),Oe&&function Fn(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t),t.style.cssText=e}}(this.dom))}localCompositionInfo(e,n){let{from:r,to:o}=e.state.selection;if(!(e.state.selection instanceof O.Bs)||r<n||o>n+this.node.content.size)return null;let l=e.domSelection(),h=function zn(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];e=be(t=t.childNodes[e-1])}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}(l.focusNode,l.focusOffset);if(!h||!this.dom.contains(h.parentNode))return null;if(this.node.inlineContent){let u=h.nodeValue,m=function Ln(t,e,n,r){for(let o=0,l=0;o<t.childCount&&l<=r;){let h=t.child(o++),u=l;if(l+=h.nodeSize,!h.isText)continue;let m=h.text;for(;o<t.childCount;){let M=t.child(o++);if(l+=M.nodeSize,!M.isText)break;m+=M.text}if(l>=n){let M=u<r?m.lastIndexOf(e,r-u-1):-1;if(M>=0&&M+e.length+u>=n)return u+M;if(n==r&&m.length>=r+e.length-u&&m.slice(r-u,r-u+e.length)==e)return r}}return-1}(this.node.content,u,r-n,o-n);return m<0?null:{node:h,pos:m,text:u}}return{node:h,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:o}){if(this.getDesc(n))return;let l=n;for(;l.parentNode!=this.contentDOM;l=l.parentNode){for(;l.previousSibling;)l.parentNode.removeChild(l.previousSibling);for(;l.nextSibling;)l.parentNode.removeChild(l.nextSibling);l.pmViewDesc&&(l.pmViewDesc=void 0)}let h=new H(this,l,n,o);e.input.compositionNodes.push(h),this.children=Nt(this.children,r,r+o.length,e,h)}update(e,n,r,o){return!(3==this.dirty||!e.sameMarkup(this.node)||(this.updateInner(e,n,r,o),0))}updateInner(e,n,r,o){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(o,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(Pe(e,this.outerDeco))return;let n=1!=this.nodeDOM.nodeType,r=this.dom;this.dom=_(this.dom,this.nodeDOM,N(this.outerDeco,this.node,n),N(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function y(t,e,n,r,o){return re(r,e,t),new te(void 0,t,e,n,r,r,r,o,0)}class i extends te{constructor(e,n,r,o,l,h,u){super(e,n,r,o,l,null,h,u,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,o){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node)||(this.updateOuterDeco(n),(0!=this.dirty||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,o.trackWrites==this.nodeDOM&&(o.trackWrites=null)),this.node=e,this.dirty=0,0))}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,n,r){let o=this.node.cut(e,n),l=document.createTextNode(o.text);return new i(this.parent,o,this.outerDeco,this.innerDeco,l,l,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(0==e||n==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}}class s extends R{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class a extends te{constructor(e,n,r,o,l,h,u,m,M,b){super(e,n,r,o,l,h,u,M,b),this.spec=m}update(e,n,r,o){if(3==this.dirty)return!1;if(this.spec.update){let l=this.spec.update(e,n,r);return l&&this.updateInner(e,n,r,o),l}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,n,r,o)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r):super.setSelection(e,n,r,o)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function d(t,e,n){let r=t.firstChild,o=!1;for(let l=0;l<e.length;l++){let h=e[l],u=h.dom;if(u.parentNode==t){for(;u!=r;)r=rt(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(u,r);if(h instanceof j){let m=r?r.previousSibling:t.lastChild;d(h.contentDOM,h.children,n),r=m?m.nextSibling:t.firstChild}}for(;r;)r=rt(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}const p=function(t){t&&(this.nodeName=t)};p.prototype=Object.create(null);const x=[new p];function N(t,e,n){if(0==t.length)return x;let r=n?x[0]:new p,o=[r];for(let l=0;l<t.length;l++){let h=t[l].type.attrs;if(h){h.nodeName&&o.push(r=new p(h.nodeName));for(let u in h){let m=h[u];null!=m&&(n&&1==o.length&&o.push(r=new p(e.isInline?"span":"div")),"class"==u?r.class=(r.class?r.class+" ":"")+m:"style"==u?r.style=(r.style?r.style+";":"")+m:"nodeName"!=u&&(r[u]=m))}}}return o}function _(t,e,n,r){if(n==x&&r==x)return e;let o=e;for(let l=0;l<r.length;l++){let h=r[l],u=n[l];if(l){let m;u&&u.nodeName==h.nodeName&&o!=t&&(m=o.parentNode)&&m.nodeName.toLowerCase()==h.nodeName||(m=document.createElement(h.nodeName),m.pmIsDeco=!0,m.appendChild(o),u=x[0]),o=m}X(o,u||x[0],h)}return o}function X(t,e,n){for(let r in e)"class"!=r&&"style"!=r&&"nodeName"!=r&&!(r in n)&&t.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let l=0;l<r.length;l++)-1==o.indexOf(r[l])&&t.classList.remove(r[l]);for(let l=0;l<o.length;l++)-1==r.indexOf(o[l])&&t.classList.add(o[l]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let o,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;o=r.exec(e.style);)t.style.removeProperty(o[1])}n.style&&(t.style.cssText+=n.style)}}function re(t,e,n){return _(t,t,x,N(e,n,1!=t.nodeType))}function Pe(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rt(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class bt{constructor(e,n){this.lock=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function Rn(t,e){let n=e,r=n.children.length,o=t.childCount,l=new Map,h=[];e:for(;o>0;){let u;for(;;)if(r){let M=n.children[r-1];if(!(M instanceof j)){u=M,r--;break}n=M,r=M.children.length}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let m=u.node;if(m){if(m!=t.child(o-1))break;--o,l.set(u,o),h.push(u)}}return{index:o,matched:l,matches:h.reverse()}}(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let o=0,l=this.stack.length>>1,h=Math.min(l,e.length);for(;o<h&&(o==l-1?this.top:this.stack[o+1<<1]).matchesMark(e[o])&&!1!==e[o].type.spec.spanning;)o++;for(;o<l;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),l--;for(;l<e.length;){this.stack.push(this.top,this.index+1);let u=-1;for(let m=this.index;m<Math.min(this.index+3,this.top.children.length);m++)if(this.top.children[m].matchesMark(e[l])){u=m;break}if(u>-1)u>this.index&&(this.changed=!0,this.destroyBetween(this.index,u)),this.top=this.top.children[this.index];else{let m=j.create(this.top,e[l],n,r);this.top.children.splice(this.index,0,m),this.top=m,this.changed=!0}this.index=0,l++}}findNodeMatch(e,n,r,o){let h,l=-1;if(o>=this.preMatch.index&&(h=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&h.matchesNode(e,n,r))l=this.top.children.indexOf(h,this.index);else for(let u=this.index,m=Math.min(this.top.children.length,u+5);u<m;u++){let M=this.top.children[u];if(M.matchesNode(e,n,r)&&!this.preMatch.matched.has(M)){l=u;break}}return!(l<0||(this.destroyBetween(this.index,l),this.index++,0))}updateNodeAt(e,n,r,o,l){let h=this.top.children[o];return 3==h.dirty&&h.dom==h.contentDOM&&(h.dirty=2),!!h.update(e,n,r,l)&&(this.destroyBetween(this.index,o),this.index++,!0)}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r)for(let o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==r)return o;return-1}e=n}}updateNextNode(e,n,r,o,l){for(let h=this.index;h<this.top.children.length;h++){let u=this.top.children[h];if(u instanceof te){let m=this.preMatch.matched.get(u);if(null!=m&&m!=l)return!1;let M=u.dom;if((!this.lock||!(M==this.lock||1==M.nodeType&&M.contains(this.lock.parentNode))||e.isText&&u.node&&u.node.isText&&u.nodeDOM.nodeValue==e.text&&3!=u.dirty&&Pe(n,u.outerDeco))&&u.update(e,n,r,o))return this.destroyBetween(this.index,h),u.dom!=M&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,n,r,o,l){this.top.children.splice(this.index++,0,te.create(this.top,e,n,r,o,l)),this.changed=!0}placeWidget(e,n,r){let o=this.index<this.top.children.length?this.top.children[this.index]:null;if(!o||!o.matchesWidget(e)||e!=o.widget&&o.widget.type.toDOM.parentNode){let l=new V(this.top,e,n,r);this.top.children.splice(this.index++,0,l),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof j;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof i)||/\n$/.test(e.node.text))&&((ee||ie)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);"IMG"==e&&(r.className="ProseMirror-separator",r.alt=""),"BR"==e&&(r.className="ProseMirror-trailingBreak");let o=new s(this.top,[],r,null);n!=this.top?n.children.push(o):n.children.splice(this.index++,0,o),this.changed=!0}}}function Pn(t,e){return t.type.side-e.type.side}function Nt(t,e,n,r,o){let l=[];for(let h=0,u=0;h<t.length;h++){let m=t[h],M=u,b=u+=m.size;M>=n||b<=e?l.push(m):(M<e&&l.push(m.slice(0,e-M,r)),o&&(l.push(o),o=void 0),b>n&&l.push(m.slice(n-M,m.size,r)))}return l}function Yt(t,e=null){let n=t.domSelection(),r=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),l=o&&0==o.size,h=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(h<0)return null;let m,M,u=r.resolve(h);if(E(n)){for(m=u;o&&!o.node;)o=o.parent;let b=o.node;if(o&&b.isAtom&&O.qv.isSelectable(b)&&o.parent&&(!b.isInline||!function $(t,e,n){for(let r=0==e,o=e==be(t);r||o;){if(t==n)return!0;let l=Me(t);if(!(t=t.parentNode))return!1;r=r&&0==l,o=o&&l==be(t)}}(n.focusNode,n.focusOffset,o.dom))){let B=o.posBefore;M=new O.qv(h==B?u:r.resolve(B))}}else{let b=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(b<0)return null;m=r.resolve(b)}return M||(M=wt(t,m,u,"pointer"==e||t.state.selection.head<u.pos&&!l?1:-1)),M}function Gt(t){return t.editable?t.hasFocus():nn(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function je(t,e=!1){let n=t.state.selection;if(Qt(t,n),Gt(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&ie){let r=t.domSelection(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&Z(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function Wn(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,Me(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&Q&&de<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{let l,h,{anchor:r,head:o}=n;Zt&&!(n instanceof O.Bs)&&(n.$from.parent.inlineContent||(l=jt(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(h=jt(t,n.to))),t.docView.setSelection(r,o,t.root,e),Zt&&(l&&Xt(l),h&&Xt(h)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function Vn(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Gt(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Zt=ee||ie&&ue<63;function jt(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),o=r<n.childNodes.length?n.childNodes[r]:null,l=r?n.childNodes[r-1]:null;if(ee&&o&&"false"==o.contentEditable)return vt(o);if(!(o&&"false"!=o.contentEditable||l&&"false"!=l.contentEditable)){if(o)return vt(o);if(l)return vt(l)}}function vt(t){return t.contentEditable="true",ee&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Xt(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Qt(t,e){if(e instanceof O.qv){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(en(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else en(t)}function en(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function wt(t,e,n,r){return t.someProp("createSelectionBetween",o=>o(t,e,n))||O.Bs.between(e,n,r)}function tn(t){return(!t.editable||t.root.activeElement==t.dom)&&nn(t)}function nn(t){let e=t.domSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function _t(t,e){let{$anchor:n,$head:r}=t.selection,o=e>0?n.max(r):n.min(r),l=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return l&&O.Y1.findFrom(l,e)}function st(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function rn(t,e,n){let r=t.state.selection;if(!(r instanceof O.Bs)){if(r instanceof O.qv&&r.node.isInline)return st(t,new O.Bs(e>0?r.$to:r.$from));{let o=_t(t.state,e);return!!o&&st(t,o)}}if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let o=_t(t.state,e);return!!(o&&o instanceof O.qv)&&st(t,o)}if(!(pe&&n.indexOf("m")>-1)){let h,o=r.$head,l=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!l||l.isText)return!1;let u=e<0?o.pos-l.nodeSize:o.pos;return!!(l.isAtom||(h=t.docView.descAt(u))&&!h.contentDOM)&&(O.qv.isSelectable(l)?st(t,new O.qv(e<0?t.state.doc.resolve(o.pos-l.nodeSize):o)):!!me&&st(t,new O.Bs(t.state.doc.resolve(e<0?u:u+l.nodeSize))))}}function Ot(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function xt(t){let e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function At(t){let e=t.domSelection(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,l,h=!1;for(G&&1==n.nodeType&&r<Ot(n)&&xt(n.childNodes[r])&&(h=!0);;)if(r>0){if(1!=n.nodeType)break;{let u=n.childNodes[r-1];if(xt(u))o=n,l=--r;else{if(3!=u.nodeType)break;n=u,r=n.nodeValue.length}}}else{if(sn(n))break;{let u=n.previousSibling;for(;u&&xt(u);)o=n.parentNode,l=Me(u),u=u.previousSibling;if(u)n=u,r=Ot(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}h?Rt(t,e,n,r):o&&Rt(t,e,o,l)}function It(t){let e=t.domSelection(),n=e.focusNode,r=e.focusOffset;if(!n)return;let l,h,o=Ot(n);for(;;)if(r<o){if(1!=n.nodeType)break;if(!xt(n.childNodes[r]))break;l=n,h=++r}else{if(sn(n))break;{let u=n.nextSibling;for(;u&&xt(u);)l=u.parentNode,h=Me(u)+1,u=u.nextSibling;if(u)n=u,r=0,o=Ot(n);else{if(n=n.parentNode,n==t.dom)break;r=o=0}}}l&&Rt(t,e,l,h)}function sn(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Rt(t,e,n,r){if(E(e)){let l=document.createRange();l.setEnd(n,r),l.setStart(n,r),e.removeAllRanges(),e.addRange(l)}else e.extend&&e.extend(n,r);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&je(t)},50)}function on(t,e,n){let r=t.state.selection;if(r instanceof O.Bs&&!r.empty||n.indexOf("s")>-1||pe&&n.indexOf("m")>-1)return!1;let{$from:o,$to:l}=r;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let h=_t(t.state,e);if(h&&h instanceof O.qv)return st(t,h)}if(!o.parent.inlineContent){let h=e<0?o:l,u=r instanceof O.C1?O.Y1.near(h,e):O.Y1.findFrom(h,e);return!!u&&st(t,u)}return!1}function ln(t,e){if(!(t.state.selection instanceof O.Bs))return!0;let{$head:n,$anchor:r,empty:o}=t.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let l=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(l&&!l.isText){let h=t.state.tr;return e<0?h.delete(n.pos-l.nodeSize,n.pos):h.delete(n.pos,n.pos+l.nodeSize),t.dispatch(h),!0}return!1}function an(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function hn(t,e){let n=[],{content:r,openStart:o,openEnd:l}=e;for(;o>1&&l>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,l--;let I=r.firstChild;n.push(I.type.name,I.attrs!=I.type.defaultAttrs?I.attrs:null),r=I.content}let h=t.someProp("clipboardSerializer")||z.PW.fromSchema(t.state.schema),u=yn(),m=u.createElement("div");m.appendChild(h.serializeFragment(r,{document:u}));let b,M=m.firstChild,B=0;for(;M&&1==M.nodeType&&(b=mn[M.nodeName.toLowerCase()]);){for(let I=b.length-1;I>=0;I--){let U=u.createElement(b[I]);for(;m.firstChild;)U.appendChild(m.firstChild);m.appendChild(U),B++}M=m.firstChild}return M&&1==M.nodeType&&M.setAttribute("data-pm-slice",`${o} ${l}${B?` -${B}`:""} ${JSON.stringify(n)}`),{dom:m,text:t.someProp("clipboardTextSerializer",I=>I(e))||e.content.textBetween(0,e.content.size,"\n\n")}}function cn(t,e,n,r,o){let h,u,l=o.parent.type.spec.code;if(!n&&!e)return null;let m=e&&(r||l||!n);if(m){if(t.someProp("transformPastedText",P=>{e=P(e,l||r)}),l)return e?new z.p2(z.HY.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):z.p2.empty;let B=t.someProp("clipboardTextParser",P=>P(e,o,r));if(B)u=B;else{let P=o.marks(),{schema:I}=t.state,U=z.PW.fromSchema(I);h=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(ce=>{let ke=h.appendChild(document.createElement("p"));ce&&ke.appendChild(U.serializeNode(I.text(ce,P)))})}}else t.someProp("transformPastedHTML",B=>{n=B(n)}),h=function Yn(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let o,n=yn().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t);if((o=r&&mn[r[1].toLowerCase()])&&(t=o.map(l=>"<"+l+">").join("")+t+o.map(l=>"</"+l+">").reverse().join("")),n.innerHTML=t,o)for(let l=0;l<o.length;l++)n=n.querySelector(o[l])||n;return n}(n),me&&function Gn(t){let e=t.querySelectorAll(ie?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];1==r.childNodes.length&&"\xa0"==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(h);let M=h&&h.querySelector("[data-pm-slice]"),b=M&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(M.getAttribute("data-pm-slice")||"");if(b&&b[3])for(let B=+b[3];B>0&&h.firstChild;B--)h=h.firstChild;if(u||(u=(t.someProp("clipboardParser")||t.someProp("domParser")||z.aw.fromSchema(t.state.schema)).parseSlice(h,{preserveWhitespace:!(!m&&!b),context:o,ruleFromNode:P=>"BR"!=P.nodeName||P.nextSibling||!P.parentNode||$n.test(P.parentNode.nodeName)?null:{ignore:!0}})),b)u=function Zn(t,e){if(!t.size)return t;let r,n=t.content.firstChild.type.schema;try{r=JSON.parse(e)}catch(u){return t}let{content:o,openStart:l,openEnd:h}=t;for(let u=r.length-2;u>=0;u-=2){let m=n.nodes[r[u]];if(!m||m.hasRequiredAttrs())break;o=z.HY.from(m.create(r[u+1],o)),l++,h++}return new z.p2(o,l,h)}(pn(u,+b[1],+b[2]),b[4]);else if(u=z.p2.maxOpen(function Hn(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let l,o=e.node(n).contentMatchAt(e.index(n)),h=[];if(t.forEach(u=>{if(!h)return;let M,m=o.findWrapping(u.type);if(!m)return h=null;if(M=h.length&&l.length&&dn(m,l,u,h[h.length-1],0))h[h.length-1]=M;else{h.length&&(h[h.length-1]=fn(h[h.length-1],l.length));let b=un(u,m);h.push(b),o=o.matchType(b.type),l=m}}),h)return z.HY.from(h)}return t}(u.content,o),!0),u.openStart||u.openEnd){let B=0,P=0;for(let I=u.content.firstChild;B<u.openStart&&!I.type.spec.isolating;B++,I=I.firstChild);for(let I=u.content.lastChild;P<u.openEnd&&!I.type.spec.isolating;P++,I=I.lastChild);u=pn(u,B,P)}return t.someProp("transformPasted",B=>{u=B(u)}),u}const $n=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function un(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,z.HY.from(t));return t}function dn(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let l=dn(t,e,n,r.lastChild,o+1);if(l)return r.copy(r.content.replaceChild(r.childCount-1,l));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(z.HY.from(un(n,t,o+1))))}}function fn(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,fn(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(z.HY.empty,!0);return t.copy(n.append(r))}function Pt(t,e,n,r,o,l){let h=e<0?t.firstChild:t.lastChild,u=h.content;return o<r-1&&(u=Pt(u,e,n,r,o+1,l)),o>=n&&(u=e<0?h.contentMatchAt(0).fillBefore(u,t.childCount>1||l<=o).append(u):u.append(h.contentMatchAt(h.childCount).fillBefore(z.HY.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,h.copy(u))}function pn(t,e,n){return e<t.openStart&&(t=new z.p2(Pt(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new z.p2(Pt(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const mn={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let gn=null;function yn(){return gn||(gn=document.implementation.createHTMLDocument("title"))}const Be={};let Re={};class jn{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ot(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Bt(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Ft(t,r))})}function Ft(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function ei(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Ct(t){return{left:t.clientX,top:t.clientY}}function zt(t,e,n,r,o){if(-1==r)return!1;let l=t.state.doc.resolve(r);for(let h=l.depth+1;h>0;h--)if(t.someProp(e,u=>h>l.depth?u(t,n,l.nodeAfter,l.before(h),o,!0):u(t,n,l.node(h),l.before(h),o,!1)))return!0;return!1}function gt(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function oi(t,e,n,r){return zt(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",o=>o(t,e,r))}function li(t,e,n,r){return zt(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",o=>o(t,e,r))||function ai(t,e,n){if(0!=n.button)return!1;let r=t.state.doc;if(-1==e)return!!r.inlineContent&&(gt(t,O.Bs.create(r,0,r.content.size),"pointer"),!0);let o=r.resolve(e);for(let l=o.depth+1;l>0;l--){let h=l>o.depth?o.nodeAfter:o.node(l),u=o.before(l);if(h.inlineContent)gt(t,O.Bs.create(r,u+1,u+1+h.content.size),"pointer");else{if(!O.qv.isSelectable(h))continue;gt(t,O.qv.create(r,u),"pointer")}return!0}}(t,n,r)}function Lt(t){return Dt(t)}Re.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!kn(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!oe||!ie||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!Oe||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",r=>r(t,n))||function Jn(t,e){let n=e.keyCode,r=function Un(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);return 8==n||pe&&72==n&&"c"==r?ln(t,-1)||At(t):46==n||pe&&68==n&&"c"==r?ln(t,1)||It(t):13==n||27==n||(37==n||pe&&66==n&&"c"==r?rn(t,-1,r)||At(t):39==n||pe&&70==n&&"c"==r?rn(t,1,r)||It(t):38==n||pe&&80==n&&"c"==r?on(t,-1,r)||At(t):40==n||pe&&78==n&&"c"==r?function Kn(t){if(!ee||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelection();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let r=e.firstChild;an(t,r,"true"),setTimeout(()=>an(t,r,"false"),20)}return!1}(t)||on(t,1,r)||It(t):r==(pe?"m":"c")&&(66==n||73==n||89==n||90==n))}(t,n)?n.preventDefault():ot(t,"key");else{let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",o=>o(t,w(13,"Enter"))),t.input.lastIOSEnter=0)},200)}},Re.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},Re.keypress=(t,e)=>{let n=e;if(kn(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||pe&&n.metaKey)return;if(t.someProp("handleKeyPress",o=>o(t,n)))return void n.preventDefault();let r=t.state.selection;if(!(r instanceof O.Bs&&r.$from.sameParent(r.$to))){let o=String.fromCharCode(n.charCode);t.someProp("handleTextInput",l=>l(t,r.$from.pos,r.$to.pos,o))||t.dispatch(t.state.tr.insertText(o).scrollIntoView()),n.preventDefault()}};const Sn=pe?"metaKey":"ctrlKey";Be.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Lt(t),o=Date.now(),l="singleClick";o-t.input.lastClick.time<500&&function ni(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[Sn]&&("singleClick"==t.input.lastClick.type?l="doubleClick":"doubleClick"==t.input.lastClick.type&&(l="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:l};let h=t.posAtCoords(Ct(n));!h||("singleClick"==l?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new hi(t,h,n,!!r)):("doubleClick"==l?oi:li)(t,h.pos,h.inside,n)?n.preventDefault():ot(t,"pointer"))};class hi{constructor(e,n,r,o){let l,h;if(this.view=e,this.pos=n,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Sn],this.allowDefault=r.shiftKey,n.inside>-1)l=e.state.doc.nodeAt(n.inside),h=n.inside;else{let b=e.state.doc.resolve(n.pos);l=b.parent,h=b.depth?b.before():0}const u=o?null:r.target,m=u?e.docView.nearestDesc(u,!0):null;this.target=m?m.dom:null;let{selection:M}=e.state;(0==r.button&&l.type.spec.draggable&&!1!==l.type.spec.selectable||M instanceof O.qv&&M.from<=h&&M.to>h)&&(this.mightDrag={node:l,pos:h,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!G||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ot(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>je(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Ct(e))),this.allowDefault||!n?ot(this.view,"pointer"):function si(t,e,n,r,o){return zt(t,"handleClickOn",e,n,r)||t.someProp("handleClick",l=>l(t,e,r))||(o?function ri(t,e){if(-1==e)return!1;let r,o,n=t.state.selection;n instanceof O.qv&&(r=n.node);let l=t.state.doc.resolve(e);for(let h=l.depth+1;h>0;h--){let u=h>l.depth?l.nodeAfter:l.node(h);if(O.qv.isSelectable(u)){o=r&&n.$from.depth>0&&h>=n.$from.depth&&l.before(n.$from.depth+1)==n.$from.pos?l.before(n.$from.depth):l.before(h);break}}return null!=o&&(gt(t,O.qv.create(t.state.doc,o),"pointer"),!0)}(t,n):function ii(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&O.qv.isSelectable(r))&&(gt(t,new O.qv(n),"pointer"),!0)}(t,n))}(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||ee&&this.mightDrag&&!this.mightDrag.node.isAtom||ie&&!(this.view.state.selection instanceof O.Bs)&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(gt(this.view,O.Y1.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):ot(this.view,"pointer")}move(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),ot(this.view,"pointer"),0==e.buttons&&this.done()}}function kn(t,e){return!!t.composing||!!(ee&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}Be.touchdown=t=>{Lt(t),ot(t,"pointer")},Be.contextmenu=t=>Lt(t);const ci=oe?5e3:-1;function xn(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Dt(t),e))}function Mn(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function ui(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Dt(t,e=!1){if(!(oe&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Mn(t),e||t.docView&&t.docView.dirty){let n=Yt(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}}Re.compositionstart=Re.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>!1===r.type.spec.inclusive)))t.markCursor=t.state.storedMarks||n.marks(),Dt(t,!0),t.markCursor=null;else if(Dt(t),G&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelection();for(let o=r.focusNode,l=r.focusOffset;o&&1==o.nodeType&&0!=l;){let h=l<0?o.lastChild:o.childNodes[l-1];if(!h)break;if(3==h.nodeType){r.collapse(h,h.nodeValue.length);break}o=h,l=-1}}t.input.composing=!0}xn(t,ci)},Re.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,xn(t,20))};const yt=Q&&de<15||Oe&&xe<604;function Vt(t,e,n,r){let o=cn(t,e,n,t.input.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",u=>u(t,r,o||z.p2.empty)))return!0;if(!o)return!1;let l=function fi(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(o),h=l?t.state.tr.replaceSelectionWith(l,t.input.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(h.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Be.copy=Re.cut=(t,e)=>{let n=e,r=t.state.selection,o="cut"==n.type;if(r.empty)return;let l=yt?null:n.clipboardData,h=r.content(),{dom:u,text:m}=hn(t,h);l?(n.preventDefault(),l.clearData(),l.setData("text/html",u.innerHTML),l.setData("text/plain",m)):function di(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}(t,u),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Re.paste=(t,e)=>{let n=e;if(t.composing&&!oe)return;let r=yt?null:n.clipboardData;r&&Vt(t,r.getData("text/plain"),r.getData("text/html"),n)?n.preventDefault():function pi(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Vt(t,r.value,null,e):Vt(t,r.textContent,r.innerHTML,e)},50)}(t,n)};class mi{constructor(e,n){this.slice=e,this.move=n}}const bn=pe?"altKey":"ctrlKey";Be.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o=t.state.selection,l=o.empty?null:t.posAtCoords(Ct(n));if(!(l&&l.pos>=o.from&&l.pos<=(o instanceof O.qv?o.to-1:o.to)))if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(O.qv.create(t.state.doc,r.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let M=t.docView.nearestDesc(n.target,!0);M&&M.node.type.spec.draggable&&M!=t.docView&&t.dispatch(t.state.tr.setSelection(O.qv.create(t.state.doc,M.posBefore)))}let h=t.state.selection.content(),{dom:u,text:m}=hn(t,h);n.dataTransfer.clearData(),n.dataTransfer.setData(yt?"Text":"text/html",u.innerHTML),n.dataTransfer.effectAllowed="copyMove",yt||n.dataTransfer.setData("text/plain",m),t.dragging=new mi(h,!n[bn])},Be.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},Re.dragover=Re.dragenter=(t,e)=>e.preventDefault(),Re.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let o=t.posAtCoords(Ct(n));if(!o)return;let l=t.state.doc.resolve(o.pos);if(!l)return;let h=r&&r.slice;h?t.someProp("transformPasted",U=>{h=U(h)}):h=cn(t,n.dataTransfer.getData(yt?"Text":"text/plain"),yt?null:n.dataTransfer.getData("text/html"),!1,l);let u=!(!r||n[bn]);if(t.someProp("handleDrop",U=>U(t,n,h||z.p2.empty,u)))return void n.preventDefault();if(!h)return;n.preventDefault();let m=h?(0,le.nj)(t.state.doc,l.pos,h):l.pos;null==m&&(m=l.pos);let M=t.state.tr;u&&M.deleteSelection();let b=M.mapping.map(m),B=0==h.openStart&&0==h.openEnd&&1==h.content.childCount,P=M.doc;if(B?M.replaceRangeWith(b,b,h.content.firstChild):M.replaceRange(b,b,h),M.doc.eq(P))return;let I=M.doc.resolve(b);if(B&&O.qv.isSelectable(h.content.firstChild)&&I.nodeAfter&&I.nodeAfter.sameMarkup(h.content.firstChild))M.setSelection(new O.qv(I));else{let U=M.mapping.map(m);M.mapping.maps[M.mapping.maps.length-1].forEach((ce,ke,Ne,qe)=>U=qe),M.setSelection(wt(t,I,M.doc.resolve(U)))}t.focus(),t.dispatch(M.setMeta("uiEvent","drop"))},Be.focus=t=>{t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelection())&&je(t)},20))},Be.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},Be.beforeinput=(t,e)=>{if(ie&&oe&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",l=>l(t,w(8,"Backspace")))))return;let{$cursor:o}=t.state.selection;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let t in Re)Be[t]=Re[t];function Mt(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Wt{constructor(e,n){this.toDOM=e,this.spec=n||lt,this.side=this.spec.side||0}map(e,n,r,o){let{pos:l,deleted:h}=e.mapResult(n.from+o,this.side<0?-1:1);return h?null:new Le(l-r,l-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Wt&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Mt(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Xe{constructor(e,n){this.attrs=e,this.spec=n||lt}map(e,n,r,o){let l=e.map(n.from+o,this.spec.inclusiveStart?-1:1)-r,h=e.map(n.to+o,this.spec.inclusiveEnd?1:-1)-r;return l>=h?null:new Le(l,h,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Xe&&Mt(this.attrs,e.attrs)&&Mt(this.spec,e.spec)}static is(e){return e.type instanceof Xe}destroy(){}}class qt{constructor(e,n){this.attrs=e,this.spec=n||lt}map(e,n,r,o){let l=e.mapResult(n.from+o,1);if(l.deleted)return null;let h=e.mapResult(n.to+o,-1);return h.deleted||h.pos<=l.pos?null:new Le(l.pos-r,h.pos-r,this)}valid(e,n){let l,{index:r,offset:o}=e.content.findIndex(n.from);return o==n.from&&!(l=e.child(r)).isText&&o+l.nodeSize==n.to}eq(e){return this==e||e instanceof qt&&Mt(this.attrs,e.attrs)&&Mt(this.spec,e.spec)}destroy(){}}class Le{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Le(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Le(e,e,new Wt(n,r))}static inline(e,n,r,o){return new Le(e,n,new Xe(r,o))}static node(e,n,r,o){return new Le(e,n,new qt(r,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xe}}const St=[],lt={};class _e{constructor(e,n){this.local=e.length?e:St,this.children=n.length?n:St}static create(e,n){return n.length?Tt(n,e,0,lt):Ae}find(e,n,r){let o=[];return this.findInner(null==e?0:e,null==n?1e9:n,o,0,r),o}findInner(e,n,r,o,l){for(let h=0;h<this.local.length;h++){let u=this.local[h];u.from<=n&&u.to>=e&&(!l||l(u.spec))&&r.push(u.copy(u.from+o,u.to+o))}for(let h=0;h<this.children.length;h+=3)if(this.children[h]<n&&this.children[h+1]>e){let u=this.children[h]+1;this.children[h+2].findInner(e-u,n-u,r,o+u,l)}}map(e,n,r){return this==Ae||0==e.maps.length?this:this.mapInner(e,n,0,0,r||lt)}mapInner(e,n,r,o,l){let h;for(let u=0;u<this.local.length;u++){let m=this.local[u].map(e,r,o);m&&m.type.valid(n,m)?(h||(h=[])).push(m):l.onRemove&&l.onRemove(this.local[u].spec)}return this.children.length?function gi(t,e,n,r,o,l,h){let u=t.slice(),m=(b,B,P,I)=>{for(let U=0;U<u.length;U+=3){let ke,ce=u[U+1];if(ce<0||b>ce+l)continue;let Ne=u[U]+l;B>=Ne?u[U+1]=b<=Ne?-2:-1:P>=o&&(ke=I-P-(B-b))&&(u[U]+=ke,u[U+1]+=ke)}};for(let b=0;b<n.maps.length;b++)n.maps[b].forEach(m);let M=!1;for(let b=0;b<u.length;b+=3)if(u[b+1]<0){if(-2==u[b+1]){M=!0,u[b+1]=-1;continue}let B=n.map(t[b]+l),P=B-o;if(P<0||P>=r.content.size){M=!0;continue}let U=n.map(t[b+1]+l,-1)-o,{index:ce,offset:ke}=r.content.findIndex(P),Ne=r.maybeChild(ce);if(Ne&&ke==P&&ke+Ne.nodeSize==U){let qe=u[b+2].mapInner(n,Ne,B+1,t[b]+l+1,h);qe!=Ae?(u[b]=P,u[b+1]=U,u[b+2]=qe):(u[b+1]=-2,M=!0)}else M=!0}if(M){let b=function yi(t,e,n,r,o,l,h){function u(m,M){for(let b=0;b<m.local.length;b++){let B=m.local[b].map(r,o,M);B?n.push(B):h.onRemove&&h.onRemove(m.local[b].spec)}for(let b=0;b<m.children.length;b+=3)u(m.children[b+2],m.children[b]+M+1)}for(let m=0;m<t.length;m+=3)-1==t[m+1]&&u(t[m+2],e[m]+l+1);return n}(u,t,e,n,o,l,h),B=Tt(b,r,0,h);e=B.local;for(let P=0;P<u.length;P+=3)u[P+1]<0&&(u.splice(P,3),P-=3);for(let P=0,I=0;P<B.children.length;P+=3){let U=B.children[P];for(;I<u.length&&u[I]<U;)I+=3;u.splice(I,0,B.children[P],B.children[P+1],B.children[P+2])}}return new _e(e.sort(at),u)}(this.children,h||[],e,n,r,o,l):h?new _e(h.sort(at),St):Ae}add(e,n){return n.length?this==Ae?_e.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let o,l=0;e.forEach((u,m)=>{let b,M=m+r;if(b=Cn(n,u,M)){for(o||(o=this.children.slice());l<o.length&&o[l]<m;)l+=3;o[l]==m?o[l+2]=o[l+2].addInner(u,b,M+1):o.splice(l,0,m,m+u.nodeSize,Tt(b,u,M+1,lt)),l+=3}});let h=On(l?Dn(n):n,-r);for(let u=0;u<h.length;u++)h[u].type.valid(e,h[u])||h.splice(u--,1);return new _e(h.length?this.local.concat(h).sort(at):this.local,o||this.children)}remove(e){return 0==e.length||this==Ae?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,o=this.local;for(let l=0;l<r.length;l+=3){let h,u=r[l]+n,m=r[l+1]+n;for(let B,b=0;b<e.length;b++)(B=e[b])&&B.from>u&&B.to<m&&(e[b]=null,(h||(h=[])).push(B));if(!h)continue;r==this.children&&(r=this.children.slice());let M=r[l+2].removeInner(h,u+1);M!=Ae?r[l+2]=M:(r.splice(l,3),l-=3)}if(o.length)for(let h,l=0;l<e.length;l++)if(h=e[l])for(let u=0;u<o.length;u++)o[u].eq(h,n)&&(o==this.local&&(o=this.local.slice()),o.splice(u--,1));return r==this.children&&o==this.local?this:o.length||r.length?new _e(o,r):Ae}forChild(e,n){if(this==Ae)return this;if(n.isLeaf)return _e.empty;let r,o;for(let u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(r=this.children[u+2]);break}let l=e+1,h=l+n.content.size;for(let u=0;u<this.local.length;u++){let m=this.local[u];if(m.from<h&&m.to>l&&m.type instanceof Xe){let M=Math.max(l,m.from)-l,b=Math.min(h,m.to)-l;M<b&&(o||(o=[])).push(m.copy(M,b))}}if(o){let u=new _e(o.sort(at),St);return r?new Qe([u,r]):u}return r||Ae}eq(e){if(this==e)return!0;if(!(e instanceof _e)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Kt(this.localsInner(e))}localsInner(e){if(this==Ae)return St;if(e.inlineContent||!this.local.some(Xe.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Xe||n.push(this.local[r]);return n}}_e.empty=new _e([],[]),_e.removeOverlap=Kt;const Ae=_e.empty;class Qe{constructor(e){this.members=e}map(e,n){const r=this.members.map(o=>o.map(e,n,lt));return Qe.from(r)}forChild(e,n){if(n.isLeaf)return _e.empty;let r=[];for(let o=0;o<this.members.length;o++){let l=this.members[o].forChild(e,n);l!=Ae&&(l instanceof Qe?r=r.concat(l.members):r.push(l))}return Qe.from(r)}eq(e){if(!(e instanceof Qe)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let o=0;o<this.members.length;o++){let l=this.members[o].localsInner(e);if(l.length)if(n){r&&(n=n.slice(),r=!1);for(let h=0;h<l.length;h++)n.push(l[h])}else n=l}return n?Kt(r?n:n.sort(at)):St}static from(e){switch(e.length){case 0:return Ae;case 1:return e[0];default:return new Qe(e)}}}function On(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(new Le(o.from+e,o.to+e,o.type))}return n}function Cn(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,o=null;for(let h,l=0;l<t.length;l++)(h=t[l])&&h.from>n&&h.to<r&&((o||(o=[])).push(h),t[l]=null);return o}function Dn(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function Tt(t,e,n,r){let o=[],l=!1;e.forEach((u,m)=>{let M=Cn(t,u,m+n);if(M){l=!0;let b=Tt(M,u,n+m+1,r);b!=Ae&&o.push(m,m+u.nodeSize,b)}});let h=On(l?Dn(t):t,-n).sort(at);for(let u=0;u<h.length;u++)h[u].type.valid(e,h[u])||(r.onRemove&&r.onRemove(h[u].spec),h.splice(u--,1));return h.length||o.length?new _e(h,o):Ae}function at(t,e){return t.from-e.from||t.to-e.to}function Kt(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let o=n+1;o<e.length;o++){let l=e[o];if(l.from!=r.from){l.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,l.from),Tn(e,o,r.copy(l.from,r.to)));break}l.to!=r.to&&(e==t&&(e=t.slice()),e[o]=l.copy(l.from,r.to),Tn(e,o+1,l.copy(r.to,l.to)))}}return e}function Tn(t,e,n){for(;e<t.length&&at(n,t[e])>0;)e++;t.splice(e,0,n)}function Ut(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Ae&&e.push(r)}),t.cursorWrapper&&e.push(_e.create(t.state.doc,[t.cursorWrapper.deco])),Qe.from(e)}const Si={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ki=Q&&de<=11;class xi{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Mi{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new xi,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let o=0;o<r.length;o++)this.queue.push(r[o]);Q&&de<=11&&r.some(o=>"childList"==o.type&&o.removedNodes.length||"characterData"==o.type&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),ki&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Si)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(tn(this.view)){if(this.suppressingSelectionUpdates)return je(this.view);if(Q&&de<=11&&!this.view.state.selection.empty){let e=this.view.domSelection();if(e.focusNode&&Z(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelection())}ignoreSelectionChange(e){if(0==e.rangeCount)return!0;let n=e.getRangeAt(0).commonAncestorContainer,r=this.view.docView.nearestDesc(n);return r&&r.ignoreMutation({type:"selection",target:3==n.nodeType?n.parentNode:n})?(this.setCurSelection(),!0):void 0}flush(){if(!this.view.docView||this.flushingSoon>-1)return;let e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);let n=this.view.domSelection(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&tn(this.view)&&!this.ignoreSelectionChange(n),o=-1,l=-1,h=!1,u=[];if(this.view.editable)for(let m=0;m<e.length;m++){let M=this.registerMutation(e[m],u);M&&(o=o<0?M.from:Math.min(M.from,o),l=l<0?M.to:Math.max(M.to,l),M.typeOver&&(h=!0))}if(G&&u.length>1){let m=u.filter(M=>"BR"==M.nodeName);if(2==m.length){let M=m[0],b=m[1];M.parentNode&&M.parentNode.parentNode==b.parentNode?b.remove():M.remove()}}(o>-1||r)&&(o>-1&&(this.view.docView.markDirty(o,l),function bi(t){En||(En=!0,"normal"==getComputedStyle(t.dom).whiteSpace&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}(this.view)),this.handleDOMChange(o,l,h,u),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(n)||je(this.view),this.currentSelection.set(n))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(r==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if("childList"==e.type){for(let b=0;b<e.addedNodes.length;b++)n.push(e.addedNodes[b]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let o=e.previousSibling,l=e.nextSibling;if(Q&&de<=11&&e.addedNodes.length)for(let b=0;b<e.addedNodes.length;b++){let{previousSibling:B,nextSibling:P}=e.addedNodes[b];(!B||Array.prototype.indexOf.call(e.addedNodes,B)<0)&&(o=B),(!P||Array.prototype.indexOf.call(e.addedNodes,P)<0)&&(l=P)}let h=o&&o.parentNode==e.target?Me(o)+1:0,u=r.localPosFromDOM(e.target,h,-1),m=l&&l.parentNode==e.target?Me(l):e.target.childNodes.length;return{from:u,to:r.localPosFromDOM(e.target,m,1)}}return"attributes"==e.type?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let En=!1;function Ci(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(ee&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||ee&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}function Nn(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:wt(t,e.resolve(n.anchor),e.resolve(n.head))}function Jt(t,e,n){let r=t.depth,o=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n){let l=t.node(r).maybeChild(t.indexAfter(r));for(;l&&!l.isLeaf;)l=l.firstChild,o++}return o}class vi{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new jn,this.prevDirectPlugins=[],this.pluginViews=[],this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(In),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=_n(this),wn(this),this.nodeViews=An(this),this.docView=y(this.state.doc,vn(this),Ut(this),this.dom,this),this.domObserver=new Mi(this,(r,o,l,h)=>function Di(t,e,n,r,o){if(e<0){let ge=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,tt=Yt(t,ge);if(tt&&!t.state.selection.eq(tt)){let Ht=t.state.tr.setSelection(tt);"pointer"==ge?Ht.setMeta("pointer",!0):"key"==ge&&Ht.scrollIntoView(),t.dispatch(Ht)}return}let l=t.state.doc.resolve(e),h=l.sharedDepth(n);e=l.before(h+1),n=t.state.doc.resolve(n).after(h+1);let u=t.state.selection,m=function Oi(t,e,n){let M,{node:r,fromOffset:o,toOffset:l,from:h,to:u}=t.docView.parseRange(e,n),m=t.domSelection(),b=m.anchorNode;if(b&&t.dom.contains(1==b.nodeType?b:b.parentNode)&&(M=[{node:b,offset:m.anchorOffset}],E(m)||M.push({node:m.focusNode,offset:m.focusOffset})),ie&&8===t.input.lastKeyCode)for(let ke=l;ke>o;ke--){let Ne=r.childNodes[ke-1],qe=Ne.pmViewDesc;if("BR"==Ne.nodeName&&!qe){l=ke;break}if(!qe||qe.size)break}let B=t.state.doc,P=t.someProp("domParser")||z.aw.fromSchema(t.state.schema),I=B.resolve(h),U=null,ce=P.parse(r,{topNode:I.parent,topMatch:I.parent.contentMatchAt(I.index()),topOpen:!0,from:o,to:l,preserveWhitespace:"pre"!=I.parent.type.whitespace||"full",findPositions:M,ruleFromNode:Ci,context:I});if(M&&null!=M[0].pos){let ke=M[0].pos,Ne=M[1]&&M[1].pos;null==Ne&&(Ne=ke),U={anchor:ke+h,head:Ne+h}}return{doc:ce,sel:U,from:h,to:u}}(t,e,n);if(ie&&t.cursorWrapper&&m.sel&&m.sel.anchor==t.cursorWrapper.deco.from&&m.sel.head==m.sel.anchor){let ge=t.cursorWrapper.deco.type.toDOM.nextSibling,tt=ge&&ge.nodeValue?ge.nodeValue.length:1;m.sel={anchor:m.sel.anchor+tt,head:m.sel.anchor+tt}}let B,P,M=t.state.doc,b=M.slice(m.from,m.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(B=t.state.selection.to,P="end"):(B=t.state.selection.from,P="start"),t.input.lastKeyCode=null;let I=function Ni(t,e,n,r,o){let l=t.findDiffStart(e,n);if(null==l)return null;let{a:h,b:u}=t.findDiffEnd(e,n+t.size,n+e.size);return"end"==o&&(r-=h+Math.max(0,l-Math.min(h,u))-l),h<l&&t.size<e.size?(l-=r<=l&&r>=h?l-r:0,u=l+(u-h),h=l):u<l&&(l-=r<=l&&r>=u?l-r:0,h=l+(h-u),u=l),{start:l,endA:h,endB:u}}(b.content,m.doc.content,m.from,B,P);if((Oe&&t.input.lastIOSEnter>Date.now()-225||oe)&&o.some(ge=>"DIV"==ge.nodeName||"P"==ge.nodeName)&&(!I||I.endA>=I.endB)&&t.someProp("handleKeyDown",ge=>ge(t,w(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(!I){if(!(r&&u instanceof O.Bs&&!u.empty&&u.$head.sameParent(u.$anchor))||t.composing||m.sel&&m.sel.anchor!=m.sel.head){if(m.sel){let ge=Nn(t,t.state.doc,m.sel);ge&&!ge.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(ge))}return}I={start:u.from,endA:u.to,endB:u.to}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&I.start==I.endB&&t.state.selection instanceof O.Bs&&(I.start>t.state.selection.from&&I.start<=t.state.selection.from+2&&t.state.selection.from>=m.from?I.start=t.state.selection.from:I.endA<t.state.selection.to&&I.endA>=t.state.selection.to-2&&t.state.selection.to<=m.to&&(I.endB+=t.state.selection.to-I.endA,I.endA=t.state.selection.to)),Q&&de<=11&&I.endB==I.start+1&&I.endA==I.start&&I.start>m.from&&" \xa0"==m.doc.textBetween(I.start-m.from-1,I.start-m.from+1)&&(I.start--,I.endA--,I.endB--);let qe,U=m.doc.resolveNoCache(I.start-m.from),ce=m.doc.resolveNoCache(I.endB-m.from),ke=M.resolve(I.start),Ne=U.sameParent(ce)&&U.parent.inlineContent&&ke.end()>=I.endA;if((Oe&&t.input.lastIOSEnter>Date.now()-225&&(!Ne||o.some(ge=>"DIV"==ge.nodeName||"P"==ge.nodeName))||!Ne&&U.pos<m.doc.content.size&&(qe=O.Y1.findFrom(m.doc.resolve(U.pos+1),1,!0))&&qe.head==ce.pos)&&t.someProp("handleKeyDown",ge=>ge(t,w(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>I.start&&function Ei(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||Jt(r,!0,!1)<o.pos)return!1;let l=t.resolve(e);if(l.parentOffset<l.parent.content.size||!l.parent.isTextblock)return!1;let h=t.resolve(Jt(l,!0,!0));return!(!h.parent.isTextblock||h.pos>n||Jt(h,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(h.parent.content)}(M,I.start,I.endA,U,ce)&&t.someProp("handleKeyDown",ge=>ge(t,w(8,"Backspace"))))return void(oe&&ie&&t.domObserver.suppressSelectionUpdates());ie&&oe&&I.endB==I.start&&(t.input.lastAndroidDelete=Date.now()),oe&&!Ne&&U.start()!=ce.start()&&0==ce.parentOffset&&U.depth==ce.depth&&m.sel&&m.sel.anchor==m.sel.head&&m.sel.head==I.endA&&(I.endB-=2,ce=m.doc.resolveNoCache(I.endB-m.from),setTimeout(()=>{t.someProp("handleKeyDown",function(ge){return ge(t,w(13,"Enter"))})},20));let Ve,$t,Et,et=I.start,ht=I.endA;if(Ne)if(U.pos==ce.pos)Q&&de<=11&&0==U.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>je(t),20)),Ve=t.state.tr.delete(et,ht),$t=M.resolve(I.start).marksAcross(M.resolve(I.endA));else if(I.endA==I.endB&&(Et=function Ti(t,e){let h,u,m,n=t.firstChild.marks,r=e.firstChild.marks,o=n,l=r;for(let b=0;b<r.length;b++)o=r[b].removeFromSet(o);for(let b=0;b<n.length;b++)l=n[b].removeFromSet(l);if(1==o.length&&0==l.length)u=o[0],h="add",m=b=>b.mark(u.addToSet(b.marks));else{if(0!=o.length||1!=l.length)return null;u=l[0],h="remove",m=b=>b.mark(u.removeFromSet(b.marks))}let M=[];for(let b=0;b<e.childCount;b++)M.push(m(e.child(b)));if(z.HY.from(M).eq(t))return{mark:u,type:h}}(U.parent.content.cut(U.parentOffset,ce.parentOffset),ke.parent.content.cut(ke.parentOffset,I.endA-ke.start()))))Ve=t.state.tr,"add"==Et.type?Ve.addMark(et,ht,Et.mark):Ve.removeMark(et,ht,Et.mark);else if(U.parent.child(U.index()).isText&&U.index()==ce.index()-(ce.textOffset?0:1)){let ge=U.parent.textBetween(U.parentOffset,ce.parentOffset);if(t.someProp("handleTextInput",tt=>tt(t,et,ht,ge)))return;Ve=t.state.tr.insertText(ge,et,ht)}if(Ve||(Ve=t.state.tr.replace(et,ht,m.doc.slice(I.start-m.from,I.endB-m.from))),m.sel){let ge=Nn(t,Ve.doc,m.sel);ge&&!(ie&&oe&&t.composing&&ge.empty&&(I.start!=I.endB||t.input.lastAndroidDelete<Date.now()-100)&&(ge.head==et||ge.head==Ve.mapping.map(ht)-1)||Q&&ge.empty&&ge.head==et)&&Ve.setSelection(ge)}$t&&Ve.ensureMarks($t),t.dispatch(Ve.scrollIntoView())}(this,r,o,l,h)),this.domObserver.start(),function Xn(t){for(let e in Be){let n=Be[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{ei(t,r)&&!Ft(t,r)&&(t.editable||!(r.type in Re))&&n(t,r)})}ee&&t.dom.addEventListener("input",()=>null),Bt(t)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Bt(this),this._props=e,e.plugins&&(e.plugins.forEach(In),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this.state.plugins!=e.plugins)}updateStateInner(e,n){let r=this.state,o=!1,l=!1;if(e.storedMarks&&this.composing&&(Mn(this),l=!0),this.state=e,n){let B=An(this);(function _i(t,e){let n=0,r=0;for(let o in t){if(t[o]!=e[o])return!0;n++}for(let o in e)r++;return n!=r})(B,this.nodeViews)&&(this.nodeViews=B,o=!0),Bt(this)}this.editable=_n(this),wn(this);let h=Ut(this),u=vn(this),m=n?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",M=o||!this.docView.matchesNode(e.doc,u,h);(M||!e.selection.eq(r.selection))&&(l=!0);let b="preserve"==m&&l&&null==this.dom.style.overflowAnchor&&function Ce(t){let r,o,e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top);for(let l=(e.left+e.right)/2,h=n+1;h<Math.min(innerHeight,e.bottom);h+=5){let u=t.root.elementFromPoint(l,h);if(!u||u==t.dom||!t.dom.contains(u))continue;let m=u.getBoundingClientRect();if(m.top>=n-20){r=u,o=m.top;break}}return{refDOM:r,refTop:o,stack:ve(t.dom)}}(this);if(l){this.domObserver.stop();let B=M&&(Q||ie)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&function wi(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}(r.selection,e.selection);if(M){let P=ie?this.trackWrites=this.domSelection().focusNode:null;(o||!this.docView.update(e.doc,u,h,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=y(e.doc,u,h,this.dom,this)),P&&!this.trackWrites&&(B=!0)}B||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelection())&&function qn(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelection();return Z(e.node,e.offset,n.anchorNode,n.anchorOffset)}(this))?je(this,B):(Qt(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(r),"reset"==m)this.dom.scrollTop=0;else if("to selection"==m){let B=this.domSelection().focusNode;if(!this.someProp("handleScrollToSelection",P=>P(this)))if(e.selection instanceof O.qv){let P=this.docView.domAfterPos(e.selection.from);1==P.nodeType&&Se(this,P.getBoundingClientRect(),B)}else Se(this,this.coordsAtPos(e.selection.head,1),B)}else b&&function Te({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;Ke(n,0==r?0:r-e)}(b)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}}someProp(e,n){let o,r=this._props&&this._props[e];if(null!=r&&(o=n?n(r):r))return o;for(let h=0;h<this.directPlugins.length;h++){let u=this.directPlugins[h].props[e];if(null!=u&&(o=n?n(u):u))return o}let l=this.state.plugins;if(l)for(let h=0;h<l.length;h++){let u=l[h].props[e];if(null!=u&&(o=n?n(u):u))return o}}hasFocus(){return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function ct(t){if(t.setActive)return t.setActive();if(Ue)return t.focus(Ue);let e=ve(t);t.focus(null==Ue?{get preventScroll(){return Ue={preventScroll:!0},!0}}:void 0),Ue||(Ue=!1,Ke(e,0))}(this.dom),je(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let n=this.dom.parentNode;n;n=n.parentNode)if(9==n.nodeType||11==n.nodeType&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n;return e||document}posAtCoords(e){return ft(this,e)}coordsAtPos(e,n=1){return it(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let o=this.docView.posFromDOM(e,n,r);if(null==o)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(e,n){return function f(t,e,n){return He==e&&D==n?c:(He=e,D=n,c="up"==n||"down"==n?function mt(t,e,n){let r=e.selection,o="up"==n?r.$from:r.$to;return pt(t,e,()=>{let{node:l}=t.docView.domFromPos(o.pos,"up"==n?-1:1);for(;;){let u=t.docView.nearestDesc(l,!0);if(!u)break;if(u.node.isBlock){l=u.dom;break}l=u.dom.parentNode}let h=it(t,o.pos,1);for(let u=l.firstChild;u;u=u.nextSibling){let m;if(1==u.nodeType)m=u.getClientRects();else{if(3!=u.nodeType)continue;m=se(u,0,u.nodeValue.length).getClientRects()}for(let M=0;M<m.length;M++){let b=m[M];if(b.bottom>b.top+1&&("up"==n?h.top-b.top>2*(b.bottom-h.top):b.bottom-h.bottom>2*(h.bottom-b.top)))return!1}}return!0})}(t,e,n):function Fe(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let o=r.parentOffset,l=!o,h=o==r.parent.content.size,u=t.domSelection();return Ge.test(r.parent.textContent)&&u.modify?pt(t,e,()=>{let m=u.getRangeAt(0),M=u.focusNode,b=u.focusOffset,B=u.caretBidiLevel;u.modify("move",n,"character");let I=!(r.depth?t.docView.domAfterPos(r.before()):t.dom).contains(1==u.focusNode.nodeType?u.focusNode:u.focusNode.parentNode)||M==u.focusNode&&b==u.focusOffset;return u.removeAllRanges(),u.addRange(m),null!=B&&(u.caretBidiLevel=B),I}):"left"==n||"backward"==n?l:h}(t,e,n))}(this,n||this.state,e)}destroy(){!this.docView||(function Qn(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ut(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function ti(t,e){!Ft(t,e)&&Be[e.type]&&(t.editable||!(e.type in Re))&&Be[e.type](t,e)}(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelection(){return this.root.getSelection()}}function vn(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let r in n)"class"==r&&(e.class+=" "+n[r]),"style"==r?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&"contenteditable"!=r&&"nodeName"!=r&&(e[r]=String(n[r]))}),[Le.node(0,t.state.doc.content.size,e)]}function wn(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Le.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function _n(t){return!t.someProp("editable",e=>!1===e(t.state))}function An(t){let e=Object.create(null);function n(r){for(let o in r)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=r[o])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function In(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}},5861:(Ee,fe,L)=>{function O(le,K,F,J,W,v,A){try{var Q=le[v](A),de=Q.value}catch(G){return void F(G)}Q.done?K(de):Promise.resolve(de).then(J,W)}function z(le){return function(){var K=this,F=arguments;return new Promise(function(J,W){var v=le.apply(K,F);function A(de){O(v,J,W,A,Q,"next",de)}function Q(de){O(v,J,W,A,Q,"throw",de)}A(void 0)})}}L.d(fe,{Z:()=>z})}}]);